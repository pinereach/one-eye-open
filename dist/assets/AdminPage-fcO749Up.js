import{u as Xe,a as Ze,r as s,b as m,j as t,N as et}from"./index-ClKfCAdh.js";import{M as B,g as tt}from"./marketTypes-2i-psQO1.js";import{C as j,b as v}from"./Card-DWv5ud22.js";import{u as rt,T as at}from"./Toast-OvfMRxDk.js";import{C as ye}from"./ConfirmModal-DHIl6KVQ.js";const ke=3e3;let K=0;function ct(){const{user:w}=Xe(),W=Ze(),{toasts:je,showToast:l,removeToast:ve}=rt(),T=s.useRef(!1),[g,_e]=s.useState([]),[c,I]=s.useState([]),[Ne,we]=s.useState([]),[Y,J]=s.useState(!1),[Ce,P]=s.useState(!1),[Se,U]=s.useState(!1),[p,F]=s.useState(null),[Q,X]=s.useState(!1),[Z,ee]=s.useState(!1),[Me,te]=s.useState({}),[re,ae]=s.useState(!1),[E,se]=s.useState(!1),[ne,le]=s.useState(!1),[C,Ae]=s.useState(""),[S,Re]=s.useState(""),[M,Oe]=s.useState(""),[$,ie]=s.useState(""),[oe,Be]=s.useState("bid"),[L,de]=s.useState(""),[V,ce]=s.useState(""),[f,Te]=s.useState("strike"),[ue,Ie]=s.useState("round_ou"),[q,Pe]=s.useState(""),[me,Ue]=s.useState(1),[D,Fe]=s.useState(""),[z,pe]=s.useState(""),[h,Ee]=s.useState(""),[_,$e]=s.useState("all"),[y,A]=s.useState(""),[G,N]=s.useState(""),[x,R]=s.useState([{user_id:0,guess:""},{user_id:0,guess:""}]),[he,xe]=s.useState(!1),[be,ge]=s.useState(!1);if(s.useEffect(()=>{if(!w?.admin||T.current)return;const e=Date.now();if(e-K<ke)return;T.current=!0,K=e;let r=!1;return J(!0),Promise.all([m.adminGetUsers(),m.getMarkets({cacheBust:!0}),m.getParticipants()]).then(([a,i,d])=>{if(r)return;const n=a.users??[];_e(n),I(i.markets??[]),we((d.participants??[]).map(b=>({id:b.id??b.name,name:b.name})));const u=["jr","jlarkin","chrisharris503@comcast.net","avayouchris@gmail.com","tkjawn"],k=n.filter(b=>!u.includes(b.username.toLowerCase()));k.length>0&&R(k.map(b=>({user_id:b.id,guess:""})))}).catch(()=>{r||(T.current=!1,l("Failed to load admin data","error"))}).finally(()=>{r||J(!1)}),()=>{r=!0,setTimeout(()=>{K=0},ke+500)}},[w?.admin]),w&&!w.admin)return t.jsx(et,{to:"/markets",replace:!0});const Le=c.find(e=>e.market_id===M)?.outcomes??[],o=f==="strike"?ue:"outcome";function H(e){let r=e.market_type||"other";return r==="market_total_birdies"||r==="market_total_pars"||r==="other"&&(e.market_id==="market-total-birdies"||e.market_id==="market_total_birdies"||e.market_id.includes("total-birdies")||e.market_id.includes("total_birdies")?r="market_total_birdies":(e.market_id==="market-total-pars"||e.market_id==="market_total_pars"||e.market_id.includes("total-pars")||e.market_id.includes("total_pars"))&&(r="market_total_pars")),r}const Ve=s.useMemo(()=>{const r=[...new Set(c.map(a=>H(a)))].sort((a,i)=>{const d=B.indexOf(a),n=B.indexOf(i);return(d===-1?B.length:d)-(n===-1?B.length:n)});return[{value:"all",label:"All"},...r.map(a=>({value:a,label:tt(a)}))]},[c]),O=s.useMemo(()=>_==="all"?c:c.filter(e=>H(e)===_),[c,_]);s.useEffect(()=>{if(f!=="outcome")return;!O.some(r=>r.market_id===y)&&y&&(A(""),N(""))},[f,_,O,y]);async function qe(){ge(!0);try{const e=await m.getMarkets({cacheBust:!0});I(e.markets??[]),l(`Markets refreshed (${(e.markets??[]).length} total)`,"success")}catch{l("Failed to refresh markets","error")}finally{ge(!1)}}async function De(){X(!0);try{const{canceled:e}=await m.adminCancelAllOrders();l(`${e} order(s) canceled`,"success")}catch(e){l(e instanceof Error?e.message:"Failed to cancel orders","error")}finally{X(!1),P(!1)}}async function ze(){if(p!=null){ee(!0);try{const{canceled:e}=await m.adminCancelAllOrders({userId:p}),r=g.find(a=>a.id===p);l(`${e} order(s) canceled for ${r?.username??p}`,"success")}catch(e){l(e instanceof Error?e.message:"Failed to cancel orders","error")}finally{ee(!1),U(!1),F(null)}}}async function Ge(e,r){te(a=>({...a,[e]:!0}));try{await m.adminUpdateMarketPause(e,r),I(a=>a.map(i=>i.market_id===e?{...i,trading_paused:r?1:0}:i)),l(r?"Market paused":"Market resumed","success")}catch(a){l(a instanceof Error?a.message:"Failed to update market","error")}finally{te(a=>({...a,[e]:!1}))}}async function He(e){e.preventDefault();const r=C===""?null:Number(C),a=S===""?null:Number(S),i=L.trim()?parseInt(L,10):NaN,d=V.trim()?parseInt(V,10):NaN;if(r==null||!M||!$||Number.isNaN(i)||i<100||i>9900||Number.isNaN(d)||d<1){l("Fill required fields: taker, market, outcome, price (100–9900), contracts (≥1)","error");return}ae(!0);try{await m.adminCreateManualTrade({taker_user_id:r,maker_user_id:a??void 0,market_id:M,outcome_id:$,side:oe,price:i,contract_size:d}),l("Manual trade created","success"),de(""),ce("")}catch(n){l(n instanceof Error?n.message:"Failed to create manual trade","error")}finally{ae(!1)}}function Ke(){const e=new Set(x.map(a=>a.user_id)),r=g.find(a=>!e.has(a.id));r?R(a=>[...a,{user_id:r.id,guess:""}]):l("All users are already in the auction","info")}function We(e){R(r=>r.filter((a,i)=>i!==e))}function Ye(e,r,a){R(i=>i.map((d,n)=>n===e?{...d,[r]:a}:d))}async function Je(e){if(e.preventDefault(),x.length<2){l("At least 2 bids are required","error");return}const r=x.map(n=>n.user_id);if(r.some((n,u)=>n!==0&&r.indexOf(n)!==u)){l("Duplicate user in bids; each user may only appear once","error");return}const i=[];for(let n=0;n<x.length;n++){const u=x[n].user_id,k=x[n].guess.trim()?parseFloat(x[n].guess):NaN;if(!u||Number.isNaN(k)){l(`Bid ${n+1}: select user and enter a numeric guess`,"error");return}i.push({user_id:u,guess:k})}if(o==="round_ou"&&!D){l("Select a participant","error");return}if(o==="birdies"&&!q){l("Select a birdies market","error");return}if(o==="outcome"&&!G){l("Select an outcome","error");return}let d="";if(o==="pars")if(h&&h!=="__new__"){const n=c.filter(u=>u.market_type==="pars"||u.short_name&&u.short_name.toLowerCase().includes("pars"));for(const u of n)if((u.outcomes??[]).find(b=>b.outcome_id===h)){d=u.market_id;break}if(!d){l("Selected line not found","error");return}}else if(h==="__new__"&&z)d=z;else{l("Select a line or choose New line and a market","error");return}xe(!0);try{const n=await m.adminRunRoundOuAuction({auction_type:o,...o==="round_ou"&&{round:me},...o==="round_ou"&&{participant_id:D},...o==="pars"&&d&&{market_id:d},...o==="pars"&&h&&h!=="__new__"&&{outcome_id:h},...o==="birdies"&&{market_id:q},...o==="outcome"&&{outcome_id:G},bids:i});l(`Auction done. Strike: ${n.strike}. ${n.trades_created} trade(s) created.`,"success"),W(`/markets/${n.market_id}`)}catch(n){l(n instanceof Error?n.message:"Failed to run auction","error")}finally{xe(!1)}}async function fe(e){se(!0);try{let r=await m.adminReplayPositions(e?{full_reset:!0}:void 0),a=r.trades_replayed;for(;r.has_more&&r.after_trade_id!=null;)r=await m.adminReplayPositions({after_trade_id:r.after_trade_id}),a+=r.trades_replayed;l(r.message??`Done. ${a} trades replayed.`,"success"),r.trades_skipped!=null&&r.trades_skipped>0&&l(`${r.trades_skipped} trade(s) skipped (missing taker_user_id or taker_side)`,"info")}catch(r){l(r instanceof Error?r.message:"Failed to replay positions","error")}finally{se(!1)}}async function Qe(){le(!0);try{const e=await m.adminRefreshVolume();l(`Volume cache updated for ${e?.updated??0} market(s)`,"success")}catch(e){l(e instanceof Error?e.message:"Failed to refresh volume","error")}finally{le(!1)}}return t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("div",{className:"flex items-center gap-2 sm:gap-4",children:t.jsxs("button",{onClick:()=>W("/markets"),className:"flex items-center gap-2 px-3 sm:px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800 transition touch-manipulation",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),t.jsx("span",{className:"hidden sm:inline",children:"Back"})]})}),t.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Admin"}),t.jsx(j,{children:t.jsxs(v,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Cancel orders"}),t.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[t.jsx("button",{type:"button",onClick:()=>P(!0),disabled:Q,className:"px-3 py-2 text-sm font-medium bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",children:Q?"Canceling…":"Cancel all open orders (all users)"}),t.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"or for user:"}),t.jsxs("select",{value:p??"",onChange:e=>F(e.target.value?Number(e.target.value):null),className:"border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select user"}),g.map(e=>t.jsxs("option",{value:e.id,children:[e.username," (id: ",e.id,")"]},e.id))]}),t.jsx("button",{type:"button",onClick:()=>p!=null&&U(!0),disabled:p==null||Z,className:"px-3 py-2 text-sm font-medium bg-amber-600 text-white rounded-md hover:bg-amber-700 disabled:opacity-50",children:Z?"Canceling…":"Cancel all for this user"})]})]})}),t.jsx(j,{children:t.jsxs(v,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Volume cache"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Recompute 30-day volume per market so list and detail pages show correct volume. Also runs automatically every 4 hours via cron."}),t.jsx("button",{type:"button",onClick:Qe,disabled:ne,className:"px-3 py-2 text-sm font-medium rounded-md bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",children:ne?"Refreshing…":"Refresh volume"})]})}),t.jsx(j,{children:t.jsxs(v,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Ensure portfolio values are zero-sum"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:["Portfolio value (unrealized P&L) should sum to zero. ",t.jsx("strong",{children:"Replay positions"})," recomputes ",t.jsx("code",{className:"text-xs",children:"net_position"})," and ",t.jsx("code",{className:"text-xs",children:"price_basis"})," from trade history. ",t.jsx("strong",{children:"Replay with full reset"})," deletes all position rows, then replays so positions are re-created only from the trade log (clean slate)."]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:()=>fe(!1),disabled:E,className:"px-3 py-1.5 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:E?"Running…":"Replay positions"}),t.jsx("button",{type:"button",onClick:()=>fe(!0),disabled:E,className:"px-3 py-1.5 text-sm font-medium rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50",children:"Replay with full reset"})]})]})}),t.jsx(j,{children:t.jsxs(v,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Pause / resume trading by market"}),Y?t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading markets…"}):t.jsx("ul",{className:"space-y-2",children:c.map(e=>{const r=(e.trading_paused??0)===1,a=Me[e.market_id];return t.jsxs("li",{className:"flex items-center justify-between gap-2 py-2 border-b border-gray-200 dark:border-gray-700 last:border-0",children:[t.jsx("span",{className:"text-sm font-medium truncate",children:e.short_name}),t.jsx("button",{type:"button",onClick:()=>Ge(e.market_id,!r),disabled:a,className:`px-3 py-1.5 text-sm font-medium rounded-md disabled:opacity-50 ${r?"bg-green-600 text-white hover:bg-green-700":"bg-gray-500 text-white hover:bg-gray-600"}`,children:a?"…":r?"Resume":"Pause"})]},e.market_id)})})]})}),t.jsx(j,{children:t.jsxs(v,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Add manual trade"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Record a trade like normal matching: taker is the one who took (placed the crossing order); maker is whose order was hit. Side is the taker's side (bid = buy, ask = sell). Both positions are updated when maker is set."}),t.jsxs("form",{onSubmit:He,className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taker (required)"}),t.jsxs("select",{value:C===""?"":C,onChange:e=>Ae(e.target.value?Number(e.target.value):""),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select taker"}),g.map(e=>t.jsxs("option",{value:e.id,children:[e.username," (id: ",e.id,")"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Maker (optional)"}),t.jsxs("select",{value:S===""?"":String(S),onChange:e=>Re(e.target.value?Number(e.target.value):""),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"None (house / system)"}),g.map(e=>t.jsxs("option",{value:e.id,children:[e.username," (id: ",e.id,")"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market"}),t.jsxs("select",{value:M,onChange:e=>{Oe(e.target.value),ie("")},required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),c.map(e=>t.jsx("option",{value:e.market_id,children:e.short_name},e.market_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Outcome"}),t.jsxs("select",{value:$,onChange:e=>ie(e.target.value),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select outcome"}),Le.map(e=>t.jsx("option",{value:e.outcome_id,children:e.name},e.outcome_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taker side"}),t.jsxs("select",{value:oe,onChange:e=>Be(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"bid",children:"Bid (taker bought)"}),t.jsx("option",{value:"ask",children:"Ask (taker sold)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Price (cents, 100–9900)"}),t.jsx("input",{type:"number",min:100,max:9900,value:L,onChange:e=>de(e.target.value),placeholder:"e.g. 5000",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Contract size"}),t.jsx("input",{type:"number",min:1,value:V,onChange:e=>ce(e.target.value),placeholder:"e.g. 10",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm"})]}),t.jsx("button",{type:"submit",disabled:re,className:"px-3 py-2 text-sm font-medium bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50",children:re?"Creating…":"Add manual trade"})]})]})}),t.jsx(j,{children:t.jsxs(v,{children:[t.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3 flex-wrap",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Auction"}),t.jsx("button",{type:"button",onClick:qe,disabled:be||Y,className:"text-sm px-2 py-1 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",children:be?"Refreshing…":"Refresh markets"})]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:f==="strike"?"Strike from average: enter bids (guess or %). Strike = average; lowest half get short, rest long, all at 50¢.":"Outcome: select market and outcome. Enter each bid as %. Trade price = average of bids; lowest half short, rest long."}),t.jsxs("form",{onSubmit:Je,className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Auction type"}),t.jsxs("select",{value:f,onChange:e=>{const r=e.target.value;Te(r),r==="outcome"&&(A(""),N(""))},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"strike",children:"Strike from average (50¢)"}),t.jsx("option",{value:"outcome",children:"Outcome (average price)"})]})]}),f==="strike"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Strike type"}),t.jsxs("select",{value:ue,onChange:e=>Ie(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"round_ou",children:"Round O/U"}),t.jsx("option",{value:"pars",children:"Pars"}),t.jsx("option",{value:"birdies",children:"Birdies"})]})]}),o==="round_ou"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Round"}),t.jsx("select",{value:me,onChange:e=>Ue(Number(e.target.value)),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[1,2,3,4,5,6].map(e=>t.jsxs("option",{value:e,children:["Round ",e]},e))})]}),o==="round_ou"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Participant"}),t.jsxs("select",{value:D,onChange:e=>Fe(e.target.value),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select participant"}),Ne.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),o==="birdies"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birdies Market"}),t.jsxs("select",{value:q,onChange:e=>Pe(e.target.value),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),c.filter(e=>H(e)==="market_total_birdies").map(e=>t.jsx("option",{value:e.market_id,children:e.short_name??e.market_id},e.market_id))]})]}),f==="outcome"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market type"}),t.jsx("select",{value:_,onChange:e=>{const r=e.target.value;$e(r),(r==="all"?c:c.filter(d=>(d.market_type??"other")===r)).some(d=>d.market_id===y)||(A(""),N(""))},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:Ve.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market"}),t.jsxs("select",{value:y,onChange:e=>{A(e.target.value),N("")},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),O.map(e=>t.jsx("option",{value:e.market_id,children:e.short_name??e.market_id},e.market_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Outcome"}),t.jsxs("select",{value:G,onChange:e=>N(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select outcome"}),(O.find(e=>e.market_id===y)?.outcomes??[]).map(e=>t.jsx("option",{value:e.outcome_id,children:e.name??e.outcome_id},e.outcome_id))]})]})]}),o==="pars"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Line"}),t.jsxs("select",{value:h||"",onChange:e=>{const r=e.target.value;Ee(r),r||pe("")},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select line"}),c.filter(e=>e.market_type==="pars"||e.short_name&&e.short_name.toLowerCase().includes("pars")).flatMap(e=>(e.outcomes??[]).map(r=>({outcome_id:r.outcome_id,market_id:e.market_id,label:r.strike!=null&&r.strike!==""?`O${r.strike}`:r.name??r.outcome_id}))).map(e=>t.jsx("option",{value:e.outcome_id,children:e.label},e.outcome_id)),t.jsx("option",{value:"__new__",children:"— New line (strike from bid average) —"})]})]}),o==="pars"&&h==="__new__"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market (for new line)"}),t.jsxs("select",{value:z,onChange:e=>pe(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),c.filter(e=>e.market_type==="pars"||e.short_name&&e.short_name.toLowerCase().includes("pars")).map(e=>t.jsx("option",{value:e.market_id,children:e.short_name},e.market_id))]})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("label",{className:"block text-sm font-medium",children:"Participants (min 2, remove those not in)"}),t.jsx("button",{type:"button",onClick:Ke,className:"text-sm text-primary-600 dark:text-primary-400 hover:underline",children:"Add"})]}),t.jsx("div",{className:"space-y-2",children:x.map((e,r)=>{const a=g.find(i=>i.id===e.user_id);return t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"flex-1 min-w-[120px] text-sm font-medium text-gray-900 dark:text-gray-100",children:a?.username??`User ${e.user_id}`}),t.jsx("input",{type:"number",step:"any",min:o==="pars"||o==="outcome"?0:void 0,max:o==="pars"||o==="outcome"?100:void 0,value:e.guess,onChange:i=>Ye(r,"guess",i.target.value),placeholder:o==="pars"||o==="outcome"?"Bid %":"Guess",className:"w-20 border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm"}),x.length>2&&t.jsx("button",{type:"button",onClick:()=>We(r),className:"p-1.5 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded","aria-label":"Remove participant",children:"×"})]},r)})})]}),t.jsx("button",{type:"submit",disabled:he,className:"px-3 py-2 text-sm font-medium bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50",children:he?"Running…":"Run auction"})]})]})}),t.jsx(ye,{isOpen:Ce,onClose:()=>P(!1),onConfirm:De,title:"Cancel all open orders",message:"Cancel all open/partial orders for every user? This cannot be undone.",confirmLabel:"Cancel all",variant:"danger"}),t.jsx(ye,{isOpen:Se,onClose:()=>{U(!1),F(null)},onConfirm:ze,title:"Cancel all orders for this user",message:p!=null?`Cancel all open/partial orders for user ${g.find(e=>e.id===p)?.username??p}?`:"",confirmLabel:"Cancel all",variant:"danger"}),t.jsx(at,{toasts:je,removeToast:ve})]})}export{ct as AdminPage};
