import{u as Q,r as c,j as t,N as U,b as S}from"./index-ClKfCAdh.js";import{C as X,a as Z,b as ee}from"./Card-DWv5ud22.js";import{E as te}from"./EmptyState-zZAAoKAW.js";function le(){const{user:w}=Q(),[u,M]=c.useState("all"),[m,D]=c.useState("all"),[K,V]=c.useState([]),[W,E]=c.useState({}),[I,A]=c.useState(!0),[j,T]=c.useState(!1),[N,z]=c.useState(!1),[k,R]=c.useState(!1),[h,y]=c.useState(null),x=["Loop","Boose","Krass","TK","CTH","Avayou","Alex","Huffman","Jon","Tim","Doc","Will"];if(w&&!w.view_scores)return t.jsx(U,{to:"/markets",replace:!0});c.useEffect(()=>{B()},[u,m]),c.useEffect(()=>{S.getHandicaps("all").then(e=>E(("handicapsByYear"in e?e.handicapsByYear:{})??{})).catch(()=>E({}))},[]);async function B(){A(!0);try{const{scores:e}=await S.getScores(u!=="all"?u:void 0,m!=="all"?m:void 0);V(e||[])}catch(e){console.error("Failed to load scores:",e)}finally{A(!1)}}const J=()=>{const e=new Map;return K.forEach(a=>{const r=`${a.course}-${a.year}`;e.has(r)||e.set(r,{course:a.course,year:a.year});const s=e.get(r);s[a.player]=a.score}),e.forEach(a=>{x.forEach(r=>{r in a||(a[r]=null)})}),Array.from(e.values())},$=(e,a)=>W[String(e)]?.[a]??null,C=J(),P=Array.from(new Set(C.map(e=>e.course))).filter(e=>typeof e=="string"),_=Array.from(new Set(C.map(e=>e.year))).filter(e=>typeof e=="number").sort((e,a)=>a-e),i=C.filter(e=>!(u!=="all"&&e.course!==u||m!=="all"&&e.year!==parseInt(m))),q=x.map(e=>{const a=i.map(s=>s[e]).filter(s=>s!=null),r=a.length>0?a.reduce((s,l)=>s+l,0)/a.length:null;return{player:e,avg:r,count:a.length}}),Y=(()=>{const e=new Map;return i.forEach(a=>{x.forEach(r=>{const s=a[r];if(s!=null){const l=a.year;e.has(l)||e.set(l,[]),e.get(l).push(s)}})}),Array.from(e.entries()).map(([a,r])=>({year:a,avg:r.reduce((s,l)=>s+l,0)/r.length,count:r.length})).sort((a,r)=>r.year-a.year)})(),F=(()=>{const e=new Map;return i.forEach(a=>{const r=a.course;x.forEach(s=>{const l=a[s];l!=null&&(e.has(r)||e.set(r,[]),e.get(r).push(l))})}),Array.from(e.entries()).map(([a,r])=>({course:a,avg:r.reduce((s,l)=>s+l,0)/r.length,count:r.length})).sort((a,r)=>a.course.localeCompare(r.course))})(),G=new Date().getFullYear(),v=e=>e<G,H=(e,a,r)=>`${e}-${a}-${r}`,O=async(e,a,r,s)=>{if(a===null||v(a))return;const l=s===""?null:parseInt(s,10);if(!(isNaN(l)&&s!==""))try{await S.updateScoreValue({course:e,year:a,player:r,score:l}),await B()}catch(o){console.error("Failed to update score:",o)}},L=(e,a,r,s,l)=>{if(v(a))return;const o=l==null?"":String(l);if(s===o){y(null);return}O(e,a,r,s),y(null)};return I?t.jsx("div",{className:"text-center py-8",children:"Loading scores..."}):t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Scoring"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Course"}),t.jsxs("select",{value:u,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[t.jsx("option",{value:"all",children:"All Courses"}),P.map(e=>t.jsx("option",{value:String(e),children:e},e))]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Year"}),t.jsxs("select",{value:m,onChange:e=>D(e.target.value),className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px] touch-manipulation",children:[t.jsx("option",{value:"all",children:"All Years"}),_.map(e=>t.jsx("option",{value:e.toString(),children:e},e))]})]})]}),i.length>0&&t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg overflow-hidden",children:[t.jsxs("button",{type:"button",onClick:()=>T(e=>!e),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors","aria-expanded":j,children:[t.jsx("h2",{className:"text-sm font-bold",children:"Average Scores"}),t.jsx("svg",{className:`w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform ${j?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),j&&t.jsx("div",{className:"px-4 pb-4 pt-0",children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:q.filter(e=>e.count>0).sort((e,a)=>(e.avg||0)-(a.avg||0)).map(({player:e,avg:a,count:r})=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e}),t.jsx("div",{className:"text-lg font-semibold",children:a?.toFixed(1)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:["(",r," rounds)"]})]},e))})})]}),i.length>0&&Y.length>0&&t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg overflow-hidden",children:[t.jsxs("button",{type:"button",onClick:()=>z(e=>!e),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors","aria-expanded":N,children:[t.jsx("h2",{className:"text-sm font-bold",children:"Average Scores by Year"}),t.jsx("svg",{className:`w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform ${N?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),N&&t.jsx("div",{className:"px-4 pb-4 pt-0",children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Y.map(({year:e,avg:a,count:r})=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e}),t.jsx("div",{className:"text-lg font-semibold",children:a.toFixed(1)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:["(",r," rounds)"]})]},e))})})]}),i.length>0&&F.length>0&&t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg overflow-hidden",children:[t.jsxs("button",{type:"button",onClick:()=>R(e=>!e),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors","aria-expanded":k,children:[t.jsx("h2",{className:"text-sm font-bold",children:"Average Scores by Course"}),t.jsx("svg",{className:`w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform ${k?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),k&&t.jsx("div",{className:"px-4 pb-4 pt-0",children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:F.map(({course:e,avg:a,count:r})=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e}),t.jsx("div",{className:"text-lg font-semibold",children:a.toFixed(1)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:["(",r," rounds)"]})]},e))})})]}),t.jsx("div",{className:"md:hidden space-y-2",children:i.length===0?t.jsx(te,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),title:"No Data Available",message:"Try adjusting your filters to see more results."}):i.map((e,a)=>{const r=v(e.year);return t.jsxs(X,{className:"overflow-hidden",children:[t.jsx(Z,{className:"py-1.5 px-2 sm:px-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-bold text-sm text-gray-900 dark:text-gray-100",children:e.course}),t.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:e.year})]})}),t.jsx(ee,{className:"py-1 px-2 sm:px-3 pb-2",children:t.jsx("div",{className:"grid grid-cols-4 sm:grid-cols-6 gap-1",children:x.map(s=>{const l=e[s],o=$(e.year,s),p=H(e.course,e.year,s),d=h?.key===p?h.value:l==null?"":String(l),n=d===""?null:parseInt(d,10),f=(n===null||isNaN(n))&&d===""?"text-gray-400 dark:text-gray-500":n!==null&&!isNaN(n)&&n<85?"text-green-600 dark:text-green-400 font-semibold":n!==null&&!isNaN(n)&&n<95?"text-blue-600 dark:text-blue-400":"text-gray-900 dark:text-gray-100";return t.jsxs("div",{className:"flex flex-col items-center py-0.5",children:[t.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 w-full text-center truncate",children:s}),r?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:`text-xs ${l!=null?f:"text-gray-400 dark:text-gray-500"}`,children:l??"—"}),o!=null&&t.jsxs("span",{className:"text-[9px] text-gray-400 dark:text-gray-500",children:["(",o,")"]})]}):t.jsxs(t.Fragment,{children:[t.jsx("input",{type:"number",value:d,onFocus:()=>y({key:p,value:l==null?"":String(l)}),onChange:g=>h?.key===p&&y(b=>b?{...b,value:g.target.value}:null),onBlur:g=>L(e.course,e.year,s,g.target.value,l),className:`w-full max-w-[48px] text-center text-xs border border-gray-300 dark:border-gray-600 rounded px-1 py-1 min-h-0 focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 bg-white dark:bg-gray-700 ${f}`,placeholder:"—",min:"0",max:"200",inputMode:"numeric"}),o!=null&&t.jsxs("span",{className:"text-[9px] text-gray-400 dark:text-gray-500",children:["(",o,")"]})]})]},s)})})})]},`${e.course}-${e.year}-${a}`)})}),t.jsx("div",{className:"hidden md:block overflow-x-auto -mx-3 sm:mx-0",children:t.jsx("div",{className:"inline-block min-w-full align-middle",children:t.jsxs("table",{className:"w-full min-w-[800px] border-collapse text-xs","aria-describedby":"scores-table-caption",children:[t.jsx("caption",{id:"scores-table-caption",className:"sr-only",children:"Scores by course and year. Number under each score is handicap index for that year."}),t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:[t.jsx("th",{className:"py-1 px-1 text-left text-[10px] font-bold text-gray-600 dark:text-gray-400 sticky left-0 bg-gray-50 dark:bg-gray-800 z-10 whitespace-nowrap",children:"Course"}),t.jsx("th",{className:"py-1 px-1 text-center text-[10px] font-bold text-gray-600 dark:text-gray-400 w-10",children:"Year"}),x.map(e=>t.jsx("th",{className:"py-1 px-0.5 text-center text-[10px] font-bold text-gray-600 dark:text-gray-400 min-w-[36px]",children:e},e))]})}),t.jsx("tbody",{children:i.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:x.length+2,className:"py-4 text-center text-gray-500 dark:text-gray-400",children:"No data available for selected filters"})}):i.map((e,a)=>t.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700/50 hover:bg-gray-50/50 dark:hover:bg-gray-800/50",children:[t.jsx("td",{className:"py-0.5 px-1 text-left text-[11px] font-medium sticky left-0 bg-white dark:bg-gray-900 z-10 whitespace-nowrap",children:e.course}),t.jsx("td",{className:"py-0.5 px-1 text-center text-[11px]",children:e.year}),x.map(r=>{const s=e[r],l=$(e.year,r),o=H(e.course,e.year,r),p=v(e.year),d=h?.key===o?h.value:s==null?"":String(s),n=d===""?null:parseInt(d,10),f=(n===null||isNaN(n))&&d===""?"text-gray-400 dark:text-gray-500":n!==null&&!isNaN(n)&&n<85?"text-green-600 dark:text-green-400 font-semibold":n!==null&&!isNaN(n)&&n<95?"text-blue-600 dark:text-blue-400":"text-gray-900 dark:text-gray-100";return t.jsx("td",{className:"py-0.5 px-0.5 text-center align-top",children:p?t.jsxs("div",{className:"flex flex-col items-center leading-tight",children:[t.jsx("span",{className:s!=null?f:"text-gray-400 dark:text-gray-500",children:s??"—"}),l!=null&&t.jsxs("span",{className:"text-[9px] text-gray-400 dark:text-gray-500",children:["(",l,")"]})]}):t.jsxs("div",{className:"flex flex-col items-center gap-0",children:[t.jsx("input",{type:"number",value:d,onFocus:()=>y({key:o,value:s==null?"":String(s)}),onChange:g=>h?.key===o&&y(b=>b?{...b,value:g.target.value}:null),onBlur:g=>L(e.course,e.year,r,g.target.value,s),className:`w-9 text-center text-[11px] border border-gray-300 dark:border-gray-600 rounded px-0.5 py-0.5 min-h-0 ${`focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 bg-white dark:bg-gray-700 ${f}`}`,placeholder:"—",min:"0",max:"200"}),l!=null&&t.jsxs("span",{className:"text-[9px] text-gray-400 dark:text-gray-500",children:["(",l,")"]})]})},r)})]},`${e.course}-${e.year}-${a}`))})]})})})]})}export{le as HistoricalScoringPage};
