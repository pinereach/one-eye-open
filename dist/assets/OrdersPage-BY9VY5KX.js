import{r as l,j as t,b as _,L as B}from"./index-C1dm45FS.js";import{P as X}from"./PullToRefresh-40oAfJLQ.js";import{e as H,f as I}from"./format-CS6GGukx.js";import{C as K,b as Y}from"./Card-CYUyGTvw.js";import{S as Q,a as U,b as V}from"./Skeleton-oBsk8Cmj.js";import{E as W}from"./EmptyState-CpQf5JjL.js";import{u as q,T as G}from"./Toast-DM4HxPFc.js";import{C as M}from"./ConfirmModal-DbZwFmm1.js";import{f as P}from"./index-BAgxTVAR.js";function J({children:N,onSwipeLeft:h,onSwipeRight:k,leftAction:m,rightAction:d,className:p=""}){const[u,f]=l.useState(0),[v,c]=l.useState(!1),x=l.useRef(0),a=l.useRef(0),y=100,g=r=>{x.current=r.touches[0].clientX,a.current=x.current,c(!0)},o=r=>{if(!v)return;a.current=r.touches[0].clientX;const S=a.current-x.current;f(S)},j=()=>{if(!v)return;const r=a.current-x.current;Math.abs(r)>y&&(r>0&&k?k():r<0&&h&&h()),f(0),c(!1)},w=u<-y/2&&m,O=u>y/2&&d;return t.jsxs("div",{className:"relative overflow-hidden",children:[t.jsxs("div",{className:"absolute inset-0 flex",children:[m&&t.jsx("div",{className:`flex-1 bg-red-500 flex items-center justify-end pr-4 transition-opacity ${w?"opacity-100":"opacity-0"}`,children:m}),d&&t.jsx("div",{className:`flex-1 bg-green-500 flex items-center justify-start pl-4 transition-opacity ${O?"opacity-100":"opacity-0"}`,children:d})]}),t.jsx("div",{className:`relative transition-transform touch-manipulation ${p}`,style:{transform:`translateX(${u}px)`},onTouchStart:g,onTouchMove:o,onTouchEnd:j,children:N})]})}function ie(){const[N,h]=l.useState([]),[k,m]=l.useState(!0),[d,p]=l.useState(null),[u,f]=l.useState(!1),{toasts:v,showToast:c,removeToast:x}=q();l.useEffect(()=>{a()},[]);async function a(){m(!0);try{const{orders:e}=await _.getAllOrders(100);h(e)}catch(e){console.error("Failed to load orders:",e),c("Failed to load orders","error")}finally{m(!1)}}async function y(e){h(s=>s.map(b=>b.id===e?{...b,status:"canceled"}:b)),p(null);try{await _.cancelOrder(e),c("Order canceled successfully","success"),await a()}catch(s){console.error("Failed to cancel order:",s),c(s.message||"Failed to cancel order","error"),await a()}}async function g(e){p(e)}const o=N.filter(e=>e.status==="open"||e.status==="partial"),j=N.filter(e=>e.status==="filled"||e.status==="canceled");async function w(){try{const e=o.map(s=>_.cancelOrder(s.id));await Promise.all(e),c("All orders canceled successfully","success"),await a()}catch(e){console.error("Failed to cancel orders:",e),c(e.message||"Failed to cancel all orders","error")}}function O(){f(!0)}const r=e=>{const s=e.side===1,b=s?"SELL ORDER":"BUY ORDER",L=s?"text-red-600 dark:text-red-400":"text-primary-600 dark:text-primary-400",n=e.original_size!==void 0&&e.original_size!==null?e.original_size:e.contract_size||0,R=e.remaining_size!==void 0&&e.remaining_size!==null?e.remaining_size:e.status==="filled"?0:n,C=Math.max(0,n-R),T=e.price?H(e.price):"0.0%",A=s?`Sell ${n} shares for ${T}`:`Buy ${n} shares for ${T}`,E=e.status==="filled"?`${n} of ${n} filled`:C>0&&C<n?`${C.toFixed(4)} of ${n} filled`:`${C} of ${n} filled`,F=e.create_time?P(new Date(e.create_time*1e3),"MM/dd/yy, h:mm:ss a"):"—",$=t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 mb-3 border border-gray-300 dark:border-gray-600",children:[t.jsxs("div",{className:"flex items-center justify-between gap-4 mb-2",children:[t.jsx("div",{className:`font-bold text-sm ${L}`,children:b}),(e.status==="open"||e.status==="partial")&&t.jsx("button",{onClick:D=>{D.stopPropagation(),g(e.id)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-base font-bold p-1 touch-manipulation flex-shrink-0",title:"Cancel order","aria-label":"Cancel order",children:"×"})]}),t.jsxs("div",{className:"flex items-stretch gap-4",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-bold text-sm sm:text-base text-gray-900 dark:text-gray-100 mb-1",children:e.market_name||"N/A"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:e.outcome_name||e.outcome}),t.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:A})]}),t.jsxs("div",{className:"flex flex-col items-end text-right flex-shrink-0",children:[t.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 mb-1",children:E}),t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:F})]})]})]});return e.status==="open"||e.status==="partial"?t.jsx(J,{onSwipeLeft:()=>g(e.id),leftAction:t.jsx("span",{className:"text-white font-medium text-sm",children:"Cancel"}),children:$},e.id):t.jsx("div",{children:$},e.id)},S=e=>t.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.create_time?P(new Date(e.create_time*1e3),"MMM d, yyyy h:mm a"):"—"}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.market_name||"N/A"}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.outcome_name||e.outcome}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center",children:t.jsx("span",{className:`text-xs sm:text-sm font-medium ${e.side===0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:e.side===0?"Buy":"Sell"})}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center font-medium text-xs sm:text-sm",children:e.price?I(e.price):"—"}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-medium",children:e.original_size!==void 0&&e.original_size!==null?e.original_size:e.contract_size||0}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.remaining_size!==void 0&&e.remaining_size!==null?e.remaining_size:e.status==="filled"?0:e.contract_size||0}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("span",{className:`text-xs sm:text-sm px-2 py-1 rounded ${e.status==="filled"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200":e.status==="open"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":e.status==="partial"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:e.status}),e.status==="open"||e.status==="partial"?t.jsx("button",{onClick:()=>g(e.id),className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-1 rounded touch-manipulation",title:"Cancel order","aria-label":"Cancel order",children:"×"}):null]})})]},e.id),i="py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-bold text-gray-600 dark:text-gray-400 sticky top-0 z-10 bg-white dark:bg-gray-900 border-b border-gray-300 dark:border-gray-600",z=(e,s)=>t.jsx("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:t.jsx("div",{className:"inline-block min-w-full align-middle",children:t.jsxs("table",{className:"w-full min-w-[600px] border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[t.jsx("th",{className:i,children:"Time"}),t.jsx("th",{className:i,children:"Market"}),t.jsx("th",{className:i,children:"Outcome"}),t.jsx("th",{className:i,children:"Side"}),t.jsx("th",{className:i,children:"Price"}),t.jsx("th",{className:i,children:"Qty"}),t.jsx("th",{className:i,children:"Remaining"}),t.jsx("th",{className:i,children:"Status"})]})}),t.jsx("tbody",{children:e.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"py-8 text-center text-gray-500 dark:text-gray-400 text-xs sm:text-sm",children:s})}):e.map(S)})]})})});return k?t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(Q,{variant:"text",width:"200px",height:"32px"}),t.jsx("div",{className:"md:hidden space-y-3",children:[1,2,3].map(e=>t.jsx(U,{},e))}),t.jsx("div",{className:"hidden md:block",children:t.jsx(V,{rows:5,cols:8})})]}):t.jsxs(X,{onRefresh:a,children:[t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(G,{toasts:v,removeToast:x}),t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100",children:"Open Orders"}),o.length>0&&t.jsx("button",{onClick:O,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 touch-manipulation transition-colors","aria-label":"Cancel all orders",children:"Cancel All"})]}),t.jsx("div",{className:"md:hidden space-y-3",children:o.length===0?t.jsx(W,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),title:"No Open Orders",message:"You don't have any open orders at the moment. Place an order from a market to get started.",action:t.jsx(B,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):o.map(r)}),t.jsx("div",{className:"hidden md:block",children:z(o,"No open orders")})]}),t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100",children:"Order History"}),t.jsx("div",{className:"md:hidden space-y-3",children:j.length===0?t.jsx(K,{children:t.jsx(Y,{children:t.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 text-sm py-4",children:"No completed orders"})})}):j.map(r)}),t.jsx("div",{className:"hidden md:block",children:z(j,"No completed orders")})]})]}),t.jsx(M,{isOpen:d!=null,onClose:()=>p(null),onConfirm:()=>{d!=null&&y(d)},title:"Cancel order",message:"Are you sure you want to cancel this order?",confirmLabel:"Cancel order",cancelLabel:"Keep",variant:"danger"}),t.jsx(M,{isOpen:u,onClose:()=>f(!1),onConfirm:w,title:"Cancel all orders",message:"Are you sure you want to cancel all open orders?",confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"})]})}export{ie as OrdersPage};
