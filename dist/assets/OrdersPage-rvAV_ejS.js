import{r as l,j as e,b as S,L as B}from"./index-cjRAL4_T.js";import{P as X}from"./PullToRefresh-D08lEk2t.js";import{e as I,f as H}from"./format-CS6GGukx.js";import{C as K,b as Y}from"./Card-QMt2C_OP.js";import{S as Q,a as U,b as V}from"./Skeleton-BaTRoPY9.js";import{E as W}from"./EmptyState-CVaN4PCh.js";import{u as q,T as G}from"./Toast-DctkrO_z.js";import{C as $}from"./ConfirmModal-C55gOaD0.js";import{f as M}from"./index-BAgxTVAR.js";function J({children:g,onSwipeLeft:j,onSwipeRight:b,leftAction:m,rightAction:d,className:N=""}){const[h,p]=l.useState(0),[k,c]=l.useState(!1),x=l.useRef(0),r=l.useRef(0),u=100,f=s=>{x.current=s.touches[0].clientX,r.current=x.current,c(!0)},o=s=>{if(!k)return;r.current=s.touches[0].clientX;const O=r.current-x.current;p(O)},y=()=>{if(!k)return;const s=r.current-x.current;Math.abs(s)>u&&(s>0&&b?b():s<0&&j&&j()),p(0),c(!1)},C=h<-u/2&&m,w=h>u/2&&d;return e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 flex",children:[m&&e.jsx("div",{className:`flex-1 bg-red-500 flex items-center justify-end pr-4 transition-opacity ${C?"opacity-100":"opacity-0"}`,children:m}),d&&e.jsx("div",{className:`flex-1 bg-green-500 flex items-center justify-start pl-4 transition-opacity ${w?"opacity-100":"opacity-0"}`,children:d})]}),e.jsx("div",{className:`relative transition-transform touch-manipulation ${N}`,style:{transform:`translateX(${h}px)`},onTouchStart:f,onTouchMove:o,onTouchEnd:y,children:g})]})}function ie(){const[g,j]=l.useState([]),[b,m]=l.useState(!0),[d,N]=l.useState(null),[h,p]=l.useState(!1),{toasts:k,showToast:c,removeToast:x}=q();l.useEffect(()=>{r()},[]);async function r(){m(!0);try{const{orders:t}=await S.getAllOrders(100);j(t)}catch(t){console.error("Failed to load orders:",t),c("Failed to load orders","error")}finally{m(!1)}}async function u(t){try{await S.cancelOrder(t),c("Order canceled successfully","success"),await r()}catch(a){console.error("Failed to cancel order:",a),c(a.message||"Failed to cancel order","error")}}async function f(t){N(t)}const o=g.filter(t=>t.status==="open"||t.status==="partial"),y=g.filter(t=>t.status==="filled"||t.status==="canceled");async function C(){try{const t=o.map(a=>S.cancelOrder(a.id));await Promise.all(t),c("All orders canceled successfully","success"),await r()}catch(t){console.error("Failed to cancel orders:",t),c(t.message||"Failed to cancel all orders","error")}}function w(){p(!0)}const s=t=>{const a=t.side===1,P=a?"SELL ORDER":"BUY ORDER",L=a?"text-red-600 dark:text-red-400":"text-primary-600 dark:text-primary-400",n=t.original_size!==void 0&&t.original_size!==null?t.original_size:t.contract_size||0,R=t.remaining_size!==void 0&&t.remaining_size!==null?t.remaining_size:t.status==="filled"?0:n,v=Math.max(0,n-R),z=t.price?I(t.price):"0.0%",A=a?`Sell ${n} shares for ${z}`:`Buy ${n} shares for ${z}`,E=t.status==="filled"?`${n} of ${n} filled`:v>0&&v<n?`${v.toFixed(4)} of ${n} filled`:`${v} of ${n} filled`,F=t.create_time?M(new Date(t.create_time*1e3),"MM/dd/yy, h:mm:ss a"):"—",T=e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 mb-3 border border-gray-300 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 mb-2",children:[e.jsx("div",{className:`font-bold text-sm ${L}`,children:P}),(t.status==="open"||t.status==="partial")&&e.jsx("button",{onClick:D=>{D.stopPropagation(),f(t.id)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-base font-bold p-1 touch-manipulation flex-shrink-0",title:"Cancel order","aria-label":"Cancel order",children:"×"})]}),e.jsxs("div",{className:"flex items-stretch gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm sm:text-base text-gray-900 dark:text-gray-100 mb-1",children:t.market_name||"N/A"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:t.outcome_name||t.outcome}),e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:A})]}),e.jsxs("div",{className:"flex flex-col items-end text-right flex-shrink-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 mb-1",children:E}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:F})]})]})]});return t.status==="open"||t.status==="partial"?e.jsx(J,{onSwipeLeft:()=>f(t.id),leftAction:e.jsx("span",{className:"text-white font-medium text-sm",children:"Cancel"}),children:T},t.id):e.jsx("div",{children:T},t.id)},O=t=>e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[e.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:t.create_time?M(new Date(t.create_time*1e3),"MMM d, yyyy h:mm a"):"—"}),e.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:t.market_name||"N/A"}),e.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:t.outcome_name||t.outcome}),e.jsx("td",{className:"py-3 px-3 sm:px-4 text-center",children:e.jsx("span",{className:`text-xs sm:text-sm font-medium ${t.side===0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:t.side===0?"Buy":"Sell"})}),e.jsx("td",{className:"py-3 px-3 sm:px-4 text-center font-medium text-xs sm:text-sm",children:t.price?H(t.price):"—"}),e.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-medium",children:t.original_size!==void 0&&t.original_size!==null?t.original_size:t.contract_size||0}),e.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:t.remaining_size!==void 0&&t.remaining_size!==null?t.remaining_size:t.status==="filled"?0:t.contract_size||0}),e.jsx("td",{className:"py-3 px-3 sm:px-4 text-center",children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:`text-xs sm:text-sm px-2 py-1 rounded ${t.status==="filled"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200":t.status==="open"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":t.status==="partial"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:t.status}),t.status==="open"||t.status==="partial"?e.jsx("button",{onClick:()=>f(t.id),className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-1 rounded touch-manipulation",title:"Cancel order","aria-label":"Cancel order",children:"×"}):null]})})]},t.id),i="py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-bold text-gray-600 dark:text-gray-400 sticky top-0 z-10 bg-white dark:bg-gray-900 border-b border-gray-300 dark:border-gray-600",_=(t,a)=>e.jsx("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"w-full min-w-[600px] border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[e.jsx("th",{className:i,children:"Time"}),e.jsx("th",{className:i,children:"Market"}),e.jsx("th",{className:i,children:"Outcome"}),e.jsx("th",{className:i,children:"Side"}),e.jsx("th",{className:i,children:"Price"}),e.jsx("th",{className:i,children:"Qty"}),e.jsx("th",{className:i,children:"Remaining"}),e.jsx("th",{className:i,children:"Status"})]})}),e.jsx("tbody",{children:t.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"py-8 text-center text-gray-500 dark:text-gray-400 text-xs sm:text-sm",children:a})}):t.map(O)})]})})});return b?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(Q,{variant:"text",width:"200px",height:"32px"}),e.jsx("div",{className:"md:hidden space-y-3",children:[1,2,3].map(t=>e.jsx(U,{},t))}),e.jsx("div",{className:"hidden md:block",children:e.jsx(V,{rows:5,cols:8})})]}):e.jsxs(X,{onRefresh:r,children:[e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(G,{toasts:k,removeToast:x}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100",children:"Open Orders"}),o.length>0&&e.jsx("button",{onClick:w,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 touch-manipulation transition-colors","aria-label":"Cancel all orders",children:"Cancel All"})]}),e.jsx("div",{className:"md:hidden space-y-3",children:o.length===0?e.jsx(W,{icon:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),title:"No Open Orders",message:"You don't have any open orders at the moment. Place an order from a market to get started.",action:e.jsx(B,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):o.map(s)}),e.jsx("div",{className:"hidden md:block",children:_(o,"No open orders")})]}),e.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100",children:"Order History"}),e.jsx("div",{className:"md:hidden space-y-3",children:y.length===0?e.jsx(K,{children:e.jsx(Y,{children:e.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 text-sm py-4",children:"No completed orders"})})}):y.map(s)}),e.jsx("div",{className:"hidden md:block",children:_(y,"No completed orders")})]})]}),e.jsx($,{isOpen:d!=null,onClose:()=>N(null),onConfirm:()=>{d!=null&&u(d)},title:"Cancel order",message:"Are you sure you want to cancel this order?",confirmLabel:"Cancel order",cancelLabel:"Keep",variant:"danger"}),e.jsx($,{isOpen:h,onClose:()=>p(!1),onConfirm:C,title:"Cancel all orders",message:"Are you sure you want to cancel all open orders?",confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"})]})}export{ie as OrdersPage};
