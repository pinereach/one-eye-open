import{u as v,r as x,j as e,N as S,b as L}from"./index-Cw9qrF9s.js";import{C as P,b as $}from"./Card-Cb7rHgJr.js";import{P as C}from"./PullToRefresh-DIK3c_Bu.js";function p(i,r=!1){const h=i/100,g=Math.abs(h).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return r?i>=0?`+$${g}`:`-$${g}`:`$${g}`}const T="shares_traded",D="desc";function R(){const{user:i}=v(),[r,h]=x.useState([]),[y,g]=x.useState(!0),[f,_]=x.useState(null),[s,N]=x.useState(T),[n,j]=x.useState(D),u=x.useMemo(()=>{if(r.length===0)return[];const t=s,d=n==="asc"?1:-1;return[...r].sort((a,c)=>{let o=0;if(t==="username")o=(a.username??"").localeCompare(c.username??"");else{const l=t==="portfolio_value_cents"?a.portfolio_value_cents:t==="trade_count"?a.trade_count:t==="open_orders_count"?a.open_orders_count:a.shares_traded,k=t==="portfolio_value_cents"?c.portfolio_value_cents:t==="trade_count"?c.trade_count:t==="open_orders_count"?c.open_orders_count:c.shares_traded;o=l-k}return o*d})},[r,s,n]);function m(t){s===t?j(d=>d==="asc"?"desc":"asc"):(N(t),j(t==="username"?"asc":"desc"))}async function b(){g(!0),_(null);try{const{leaderboard:t}=await L.adminGetLeaderboard();h(t??[])}catch(t){console.error("Failed to load leaderboard:",t),_(t instanceof Error?t.message:"Failed to load leaderboard")}finally{g(!1)}}return x.useEffect(()=>{i?.admin&&b()},[i?.admin]),i&&!i.admin?e.jsx(S,{to:"/markets",replace:!0}):y&&r.length===0?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Leaderboard"}),e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-14 bg-gray-200 dark:bg-gray-700 rounded-lg"},t))})]}):f?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Leaderboard"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:f})]}):e.jsx(C,{onRefresh:b,children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Leaderboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Per-user stats: trades, open orders, shares traded, portfolio value (P&L). Zero-sum: totals should net to $0."}),e.jsx("div",{className:"md:hidden space-y-3",children:u.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 py-4",children:"No users."}):u.map(t=>e.jsx(P,{children:e.jsxs($,{className:"p-4",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t.username}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Trades"}),e.jsx("span",{className:"text-right font-medium",children:t.trade_count}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Open orders"}),e.jsx("span",{className:"text-right font-medium",children:t.open_orders_count}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Shares traded"}),e.jsx("span",{className:"text-right font-medium",children:t.shares_traded}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Portfolio value"}),e.jsx("span",{className:`text-right font-medium ${t.portfolio_value_cents>0?"text-green-600 dark:text-green-400":t.portfolio_value_cents<0?"text-red-600 dark:text-red-400":""}`,children:p(t.portfolio_value_cents,!0)})]})]})},t.user_id))}),r.length>0&&(()=>{const t=r.reduce((d,a)=>d+a.portfolio_value_cents,0);return e.jsxs("div",{className:"md:hidden rounded-lg border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/80 p-4",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Summary (all participants)"}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-sm",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Trades:"})," ",e.jsx("span",{className:"font-semibold",children:r.reduce((d,a)=>d+a.trade_count,0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Open orders:"})," ",e.jsx("span",{className:"font-semibold",children:r.reduce((d,a)=>d+a.open_orders_count,0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Shares traded:"})," ",e.jsx("span",{className:"font-semibold",children:r.reduce((d,a)=>d+a.shares_traded,0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Portfolio value (net):"})," ",e.jsx("span",{className:`font-semibold ${t>0?"text-green-600 dark:text-green-400":t<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:p(t,!0)})]})]})]})})(),e.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-600",children:e.jsxs("table",{className:"w-full min-w-[600px] border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:[e.jsx("th",{className:"py-3 px-4 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>m("username"),className:"flex items-center gap-1 hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":s==="username"?n==="asc"?"ascending":"descending":void 0,children:["User ",s==="username"&&(n==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>m("trade_count"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":s==="trade_count"?n==="asc"?"ascending":"descending":void 0,children:["Trades ",s==="trade_count"&&(n==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>m("open_orders_count"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":s==="open_orders_count"?n==="asc"?"ascending":"descending":void 0,children:["Open orders ",s==="open_orders_count"&&(n==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>m("shares_traded"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":s==="shares_traded"?n==="asc"?"ascending":"descending":void 0,children:["Shares traded ",s==="shares_traded"&&(n==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>m("portfolio_value_cents"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":s==="portfolio_value_cents"?n==="asc"?"ascending":"descending":void 0,children:["Portfolio value ",s==="portfolio_value_cents"&&(n==="asc"?"↑":"↓")]})})]})}),e.jsx("tbody",{children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-8 text-center text-gray-500 dark:text-gray-400",children:"No users."})}):u.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-gray-900 dark:text-gray-100",children:t.username}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.trade_count}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.open_orders_count}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.shares_traded}),e.jsx("td",{className:`py-3 px-4 text-right font-medium ${t.portfolio_value_cents>0?"text-green-600 dark:text-green-400":t.portfolio_value_cents<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:p(t.portfolio_value_cents,!0)})]},t.user_id))}),r.length>0&&(()=>{const t=r.reduce((o,l)=>o+l.trade_count,0),d=r.reduce((o,l)=>o+l.open_orders_count,0),a=r.reduce((o,l)=>o+l.shares_traded,0),c=r.reduce((o,l)=>o+l.portfolio_value_cents,0);return e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-500 bg-gray-100 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-gray-100",children:"All participants"}),e.jsx("td",{className:"py-3 px-4 text-right",children:t}),e.jsx("td",{className:"py-3 px-4 text-right",children:d}),e.jsx("td",{className:"py-3 px-4 text-right",children:a}),e.jsx("td",{className:`py-3 px-4 text-right ${c>0?"text-green-600 dark:text-green-400":c<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:p(c,!0)})]})})})()]})})]})})}export{R as LeaderboardPage};
