import{u as Xe,a as Ze,r as s,b as m,j as t,N as et}from"./index-BI7Apl7Y.js";import{M as R,g as tt}from"./marketTypes-2i-psQO1.js";import{C as y,b as k}from"./Card-B9dr0X7x.js";import{u as rt,T as at}from"./Toast-BQPUFt-l.js";import{C as fe}from"./ConfirmModal-IXtZuiZ-.js";const ye=3e3;let H=0;function ct(){const{user:_}=Xe(),K=Ze(),{toasts:ke,showToast:l,removeToast:je}=rt(),O=s.useRef(!1),[b,ve]=s.useState([]),[u,B]=s.useState([]),[_e,Ne]=s.useState([]),[W,Y]=s.useState(!1),[we,T]=s.useState(!1),[Ce,I]=s.useState(!1),[p,P]=s.useState(null),[J,Q]=s.useState(!1),[X,Z]=s.useState(!1),[Se,ee]=s.useState({}),[te,re]=s.useState(!1),[U,ae]=s.useState(!1),[se,ne]=s.useState(!1),[N,Me]=s.useState(""),[w,Ae]=s.useState(""),[C,Re]=s.useState(""),[F,le]=s.useState(""),[ie,Oe]=s.useState("bid"),[E,oe]=s.useState(""),[$,de]=s.useState(""),[g,Be]=s.useState("strike"),[ce,Te]=s.useState("round_ou"),[L,Ie]=s.useState(""),[ue,Pe]=s.useState(1),[V,Ue]=s.useState(""),[q,me]=s.useState(""),[h,Fe]=s.useState(""),[j,Ee]=s.useState("all"),[f,S]=s.useState(""),[D,v]=s.useState(""),[x,M]=s.useState([{user_id:0,guess:""},{user_id:0,guess:""}]),[pe,he]=s.useState(!1),[xe,be]=s.useState(!1);if(s.useEffect(()=>{if(!_?.admin||O.current)return;const e=Date.now();if(e-H<ye)return;O.current=!0,H=e;let r=!1;return Y(!0),Promise.all([m.adminGetUsers(),m.getMarkets({cacheBust:!0}),m.getParticipants()]).then(([a,i,d])=>{if(r)return;const n=a.users??[];ve(n),B(i.markets??[]),Ne((d.participants??[]).map(c=>({id:c.id??c.name,name:c.name}))),n.length>0&&M(n.map(c=>({user_id:c.id,guess:""})))}).catch(()=>{r||(O.current=!1,l("Failed to load admin data","error"))}).finally(()=>{r||Y(!1)}),()=>{r=!0,setTimeout(()=>{H=0},ye+500)}},[_?.admin]),_&&!_.admin)return t.jsx(et,{to:"/markets",replace:!0});const $e=u.find(e=>e.market_id===C)?.outcomes??[],o=g==="strike"?ce:"outcome";function z(e){let r=e.market_type||"other";return r==="market_total_birdies"||r==="market_total_pars"||r==="other"&&(e.market_id==="market-total-birdies"||e.market_id==="market_total_birdies"||e.market_id.includes("total-birdies")||e.market_id.includes("total_birdies")?r="market_total_birdies":(e.market_id==="market-total-pars"||e.market_id==="market_total_pars"||e.market_id.includes("total-pars")||e.market_id.includes("total_pars"))&&(r="market_total_pars")),r}const Le=s.useMemo(()=>{const r=[...new Set(u.map(a=>z(a)))].sort((a,i)=>{const d=R.indexOf(a),n=R.indexOf(i);return(d===-1?R.length:d)-(n===-1?R.length:n)});return[{value:"all",label:"All"},...r.map(a=>({value:a,label:tt(a)}))]},[u]),A=s.useMemo(()=>j==="all"?u:u.filter(e=>z(e)===j),[u,j]);s.useEffect(()=>{if(g!=="outcome")return;!A.some(r=>r.market_id===f)&&f&&(S(""),v(""))},[g,j,A,f]);async function Ve(){be(!0);try{const e=await m.getMarkets({cacheBust:!0});B(e.markets??[]),l(`Markets refreshed (${(e.markets??[]).length} total)`,"success")}catch{l("Failed to refresh markets","error")}finally{be(!1)}}async function qe(){Q(!0);try{const{canceled:e}=await m.adminCancelAllOrders();l(`${e} order(s) canceled`,"success")}catch(e){l(e instanceof Error?e.message:"Failed to cancel orders","error")}finally{Q(!1),T(!1)}}async function De(){if(p!=null){Z(!0);try{const{canceled:e}=await m.adminCancelAllOrders(p),r=b.find(a=>a.id===p);l(`${e} order(s) canceled for ${r?.username??p}`,"success")}catch(e){l(e instanceof Error?e.message:"Failed to cancel orders","error")}finally{Z(!1),I(!1),P(null)}}}async function ze(e,r){ee(a=>({...a,[e]:!0}));try{await m.adminUpdateMarketPause(e,r),B(a=>a.map(i=>i.market_id===e?{...i,trading_paused:r?1:0}:i)),l(r?"Market paused":"Market resumed","success")}catch(a){l(a instanceof Error?a.message:"Failed to update market","error")}finally{ee(a=>({...a,[e]:!1}))}}async function Ge(e){e.preventDefault();const r=N===""?null:Number(N),a=w===""?null:Number(w),i=E.trim()?parseInt(E,10):NaN,d=$.trim()?parseInt($,10):NaN;if(r==null||!C||!F||Number.isNaN(i)||i<100||i>9900||Number.isNaN(d)||d<1){l("Fill required fields: taker, market, outcome, price (100–9900), contracts (≥1)","error");return}re(!0);try{await m.adminCreateManualTrade({taker_user_id:r,maker_user_id:a??void 0,market_id:C,outcome_id:F,side:ie,price:i,contract_size:d}),l("Manual trade created","success"),oe(""),de("")}catch(n){l(n instanceof Error?n.message:"Failed to create manual trade","error")}finally{re(!1)}}function He(){const e=new Set(x.map(a=>a.user_id)),r=b.find(a=>!e.has(a.id));r?M(a=>[...a,{user_id:r.id,guess:""}]):l("All users are already in the auction","info")}function Ke(e){M(r=>r.filter((a,i)=>i!==e))}function We(e,r,a){M(i=>i.map((d,n)=>n===e?{...d,[r]:a}:d))}async function Ye(e){if(e.preventDefault(),x.length<2){l("At least 2 bids are required","error");return}const r=x.map(n=>n.user_id);if(r.some((n,c)=>n!==0&&r.indexOf(n)!==c)){l("Duplicate user in bids; each user may only appear once","error");return}const i=[];for(let n=0;n<x.length;n++){const c=x[n].user_id,G=x[n].guess.trim()?parseFloat(x[n].guess):NaN;if(!c||Number.isNaN(G)){l(`Bid ${n+1}: select user and enter a numeric guess`,"error");return}i.push({user_id:c,guess:G})}if(o==="round_ou"&&!V){l("Select a participant","error");return}if(o==="birdies"&&!L){l("Select a birdies market","error");return}if(o==="outcome"&&!D){l("Select an outcome","error");return}let d="";if(o==="pars")if(h&&h!=="__new__"){const n=u.filter(c=>c.market_type==="pars"||c.short_name&&c.short_name.toLowerCase().includes("pars"));for(const c of n)if((c.outcomes??[]).find(Qe=>Qe.outcome_id===h)){d=c.market_id;break}if(!d){l("Selected line not found","error");return}}else if(h==="__new__"&&q)d=q;else{l("Select a line or choose New line and a market","error");return}he(!0);try{const n=await m.adminRunRoundOuAuction({auction_type:o,...o==="round_ou"&&{round:ue},...o==="round_ou"&&{participant_id:V},...o==="pars"&&d&&{market_id:d},...o==="pars"&&h&&h!=="__new__"&&{outcome_id:h},...o==="birdies"&&{market_id:L},...o==="outcome"&&{outcome_id:D},bids:i});l(`Auction done. Strike: ${n.strike}. ${n.trades_created} trade(s) created.`,"success"),K(`/markets/${n.market_id}`)}catch(n){l(n instanceof Error?n.message:"Failed to run auction","error")}finally{he(!1)}}async function ge(e){ae(!0);try{let r=await m.adminReplayPositions(e?{full_reset:!0}:void 0),a=r.trades_replayed;for(;r.has_more&&r.after_trade_id!=null;)r=await m.adminReplayPositions({after_trade_id:r.after_trade_id}),a+=r.trades_replayed;l(r.message??`Done. ${a} trades replayed.`,"success"),r.trades_skipped!=null&&r.trades_skipped>0&&l(`${r.trades_skipped} trade(s) skipped (missing taker_user_id or taker_side)`,"info")}catch(r){l(r instanceof Error?r.message:"Failed to replay positions","error")}finally{ae(!1)}}async function Je(){ne(!0);try{const e=await m.adminRefreshVolume();l(`Volume cache updated for ${e?.updated??0} market(s)`,"success")}catch(e){l(e instanceof Error?e.message:"Failed to refresh volume","error")}finally{ne(!1)}}return t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("div",{className:"flex items-center gap-2 sm:gap-4",children:t.jsxs("button",{onClick:()=>K("/markets"),className:"flex items-center gap-2 px-3 sm:px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800 transition touch-manipulation",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),t.jsx("span",{className:"hidden sm:inline",children:"Back"})]})}),t.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Admin"}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Cancel orders"}),t.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[t.jsx("button",{type:"button",onClick:()=>T(!0),disabled:J,className:"px-3 py-2 text-sm font-medium bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",children:J?"Canceling…":"Cancel all open orders (all users)"}),t.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"or for user:"}),t.jsxs("select",{value:p??"",onChange:e=>P(e.target.value?Number(e.target.value):null),className:"border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select user"}),b.map(e=>t.jsxs("option",{value:e.id,children:[e.username," (id: ",e.id,")"]},e.id))]}),t.jsx("button",{type:"button",onClick:()=>p!=null&&I(!0),disabled:p==null||X,className:"px-3 py-2 text-sm font-medium bg-amber-600 text-white rounded-md hover:bg-amber-700 disabled:opacity-50",children:X?"Canceling…":"Cancel all for this user"})]})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Volume cache"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Recompute 30-day volume per market so list and detail pages show correct volume. Also runs automatically every 4 hours via cron."}),t.jsx("button",{type:"button",onClick:Je,disabled:se,className:"px-3 py-2 text-sm font-medium rounded-md bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",children:se?"Refreshing…":"Refresh volume"})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Ensure portfolio values are zero-sum"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:["Portfolio value (unrealized P&L) should sum to zero. ",t.jsx("strong",{children:"Replay positions"})," recomputes ",t.jsx("code",{className:"text-xs",children:"net_position"})," and ",t.jsx("code",{className:"text-xs",children:"price_basis"})," from trade history. ",t.jsx("strong",{children:"Replay with full reset"})," deletes all position rows, then replays so positions are re-created only from the trade log (clean slate)."]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:()=>ge(!1),disabled:U,className:"px-3 py-1.5 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:U?"Running…":"Replay positions"}),t.jsx("button",{type:"button",onClick:()=>ge(!0),disabled:U,className:"px-3 py-1.5 text-sm font-medium rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50",children:"Replay with full reset"})]})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Pause / resume trading by market"}),W?t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading markets…"}):t.jsx("ul",{className:"space-y-2",children:u.map(e=>{const r=(e.trading_paused??0)===1,a=Se[e.market_id];return t.jsxs("li",{className:"flex items-center justify-between gap-2 py-2 border-b border-gray-200 dark:border-gray-700 last:border-0",children:[t.jsx("span",{className:"text-sm font-medium truncate",children:e.short_name}),t.jsx("button",{type:"button",onClick:()=>ze(e.market_id,!r),disabled:a,className:`px-3 py-1.5 text-sm font-medium rounded-md disabled:opacity-50 ${r?"bg-green-600 text-white hover:bg-green-700":"bg-gray-500 text-white hover:bg-gray-600"}`,children:a?"…":r?"Resume":"Pause"})]},e.market_id)})})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Add manual trade"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Record a trade like normal matching: taker is the one who took (placed the crossing order); maker is whose order was hit. Side is the taker's side (bid = buy, ask = sell). Both positions are updated when maker is set."}),t.jsxs("form",{onSubmit:Ge,className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taker (required)"}),t.jsxs("select",{value:N===""?"":N,onChange:e=>Me(e.target.value?Number(e.target.value):""),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select taker"}),b.map(e=>t.jsxs("option",{value:e.id,children:[e.username," (id: ",e.id,")"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Maker (optional)"}),t.jsxs("select",{value:w===""?"":String(w),onChange:e=>Ae(e.target.value?Number(e.target.value):""),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"None (house / system)"}),b.map(e=>t.jsxs("option",{value:e.id,children:[e.username," (id: ",e.id,")"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market"}),t.jsxs("select",{value:C,onChange:e=>{Re(e.target.value),le("")},required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),u.map(e=>t.jsx("option",{value:e.market_id,children:e.short_name},e.market_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Outcome"}),t.jsxs("select",{value:F,onChange:e=>le(e.target.value),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select outcome"}),$e.map(e=>t.jsx("option",{value:e.outcome_id,children:e.name},e.outcome_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taker side"}),t.jsxs("select",{value:ie,onChange:e=>Oe(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"bid",children:"Bid (taker bought)"}),t.jsx("option",{value:"ask",children:"Ask (taker sold)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Price (cents, 100–9900)"}),t.jsx("input",{type:"number",min:100,max:9900,value:E,onChange:e=>oe(e.target.value),placeholder:"e.g. 5000",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Contract size"}),t.jsx("input",{type:"number",min:1,value:$,onChange:e=>de(e.target.value),placeholder:"e.g. 10",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm"})]}),t.jsx("button",{type:"submit",disabled:te,className:"px-3 py-2 text-sm font-medium bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50",children:te?"Creating…":"Add manual trade"})]})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3 flex-wrap",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Auction"}),t.jsx("button",{type:"button",onClick:Ve,disabled:xe||W,className:"text-sm px-2 py-1 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",children:xe?"Refreshing…":"Refresh markets"})]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:g==="strike"?"Strike from average: enter bids (guess or %). Strike = average; lowest half get short, rest long, all at 50¢.":"Outcome: select market and outcome. Enter each bid as %. Trade price = average of bids; lowest half short, rest long."}),t.jsxs("form",{onSubmit:Ye,className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Auction type"}),t.jsxs("select",{value:g,onChange:e=>{const r=e.target.value;Be(r),r==="outcome"&&(S(""),v(""))},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"strike",children:"Strike from average (50¢)"}),t.jsx("option",{value:"outcome",children:"Outcome (average price)"})]})]}),g==="strike"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Strike type"}),t.jsxs("select",{value:ce,onChange:e=>Te(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"round_ou",children:"Round O/U"}),t.jsx("option",{value:"pars",children:"Pars"}),t.jsx("option",{value:"birdies",children:"Birdies"})]})]}),o==="round_ou"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Round"}),t.jsx("select",{value:ue,onChange:e=>Pe(Number(e.target.value)),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[1,2,3,4,5,6].map(e=>t.jsxs("option",{value:e,children:["Round ",e]},e))})]}),o==="round_ou"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Participant"}),t.jsxs("select",{value:V,onChange:e=>Ue(e.target.value),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select participant"}),_e.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),o==="birdies"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Birdies Market"}),t.jsxs("select",{value:L,onChange:e=>Ie(e.target.value),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),u.filter(e=>z(e)==="market_total_birdies").map(e=>t.jsx("option",{value:e.market_id,children:e.short_name??e.market_id},e.market_id))]})]}),g==="outcome"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market type"}),t.jsx("select",{value:j,onChange:e=>{const r=e.target.value;Ee(r),(r==="all"?u:u.filter(d=>(d.market_type??"other")===r)).some(d=>d.market_id===f)||(S(""),v(""))},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:Le.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market"}),t.jsxs("select",{value:f,onChange:e=>{S(e.target.value),v("")},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),A.map(e=>t.jsx("option",{value:e.market_id,children:e.short_name??e.market_id},e.market_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Outcome"}),t.jsxs("select",{value:D,onChange:e=>v(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select outcome"}),(A.find(e=>e.market_id===f)?.outcomes??[]).map(e=>t.jsx("option",{value:e.outcome_id,children:e.name??e.outcome_id},e.outcome_id))]})]})]}),o==="pars"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Line"}),t.jsxs("select",{value:h||"",onChange:e=>{const r=e.target.value;Fe(r),r||me("")},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select line"}),u.filter(e=>e.market_type==="pars"||e.short_name&&e.short_name.toLowerCase().includes("pars")).flatMap(e=>(e.outcomes??[]).map(r=>({outcome_id:r.outcome_id,market_id:e.market_id,label:r.strike!=null&&r.strike!==""?`O${r.strike}`:r.name??r.outcome_id}))).map(e=>t.jsx("option",{value:e.outcome_id,children:e.label},e.outcome_id)),t.jsx("option",{value:"__new__",children:"— New line (strike from bid average) —"})]})]}),o==="pars"&&h==="__new__"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market (for new line)"}),t.jsxs("select",{value:q,onChange:e=>me(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),u.filter(e=>e.market_type==="pars"||e.short_name&&e.short_name.toLowerCase().includes("pars")).map(e=>t.jsx("option",{value:e.market_id,children:e.short_name},e.market_id))]})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("label",{className:"block text-sm font-medium",children:"Participants (min 2, remove those not in)"}),t.jsx("button",{type:"button",onClick:He,className:"text-sm text-primary-600 dark:text-primary-400 hover:underline",children:"Add"})]}),t.jsx("div",{className:"space-y-2",children:x.map((e,r)=>{const a=b.find(i=>i.id===e.user_id);return t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"flex-1 min-w-[120px] text-sm font-medium text-gray-900 dark:text-gray-100",children:a?.username??`User ${e.user_id}`}),t.jsx("input",{type:"number",step:"any",min:o==="pars"||o==="outcome"?0:void 0,max:o==="pars"||o==="outcome"?100:void 0,value:e.guess,onChange:i=>We(r,"guess",i.target.value),placeholder:o==="pars"||o==="outcome"?"Bid %":"Guess",className:"w-20 border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm"}),x.length>2&&t.jsx("button",{type:"button",onClick:()=>Ke(r),className:"p-1.5 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded","aria-label":"Remove participant",children:"×"})]},r)})})]}),t.jsx("button",{type:"submit",disabled:pe,className:"px-3 py-2 text-sm font-medium bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50",children:pe?"Running…":"Run auction"})]})]})}),t.jsx(fe,{isOpen:we,onClose:()=>T(!1),onConfirm:qe,title:"Cancel all open orders",message:"Cancel all open/partial orders for every user? This cannot be undone.",confirmLabel:"Cancel all",variant:"danger"}),t.jsx(fe,{isOpen:Ce,onClose:()=>{I(!1),P(null)},onConfirm:De,title:"Cancel all orders for this user",message:p!=null?`Cancel all open/partial orders for user ${b.find(e=>e.id===p)?.username??p}?`:"",confirmLabel:"Cancel all",variant:"danger"}),t.jsx(at,{toasts:ke,removeToast:je})]})}export{ct as AdminPage};
