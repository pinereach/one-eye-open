import{u as Je,a as Qe,r as s,b as m,j as t,N as Xe}from"./index-Cc4LMtWK.js";import{M as R,g as Ze}from"./marketTypes-2i-psQO1.js";import{C as y,b as k}from"./Card-BvX_44KL.js";import{u as et,T as tt}from"./Toast-CazhKufv.js";import{C as ge}from"./ConfirmModal-BKpq8_Ly.js";const fe=3e3;let z=0;function it(){const{user:N}=Je(),G=Qe(),{toasts:ye,showToast:l,removeToast:ke}=et(),O=s.useRef(!1),[b,ve]=s.useState([]),[u,B]=s.useState([]),[je,_e]=s.useState([]),[H,K]=s.useState(!1),[Ne,T]=s.useState(!1),[we,P]=s.useState(!1),[p,I]=s.useState(null),[W,Y]=s.useState(!1),[J,Q]=s.useState(!1),[Ce,X]=s.useState({}),[Z,ee]=s.useState(!1),[U,te]=s.useState(!1),[re,ae]=s.useState(!1),[w,Se]=s.useState(""),[C,Me]=s.useState(""),[S,Ae]=s.useState(""),[F,se]=s.useState(""),[ne,Re]=s.useState("bid"),[E,le]=s.useState(""),[$,oe]=s.useState(""),[g,Oe]=s.useState("strike"),[ie,Be]=s.useState("round_ou"),[de,Te]=s.useState(1),[L,Pe]=s.useState(""),[V,ce]=s.useState(""),[h,Ie]=s.useState(""),[v,Ue]=s.useState("all"),[f,M]=s.useState(""),[q,j]=s.useState(""),[x,A]=s.useState([{user_id:0,guess:""},{user_id:0,guess:""}]),[ue,me]=s.useState(!1),[pe,he]=s.useState(!1);if(s.useEffect(()=>{if(!N?.admin||O.current)return;const e=Date.now();if(e-z<fe)return;O.current=!0,z=e;let r=!1;return K(!0),Promise.all([m.adminGetUsers(),m.getMarkets({cacheBust:!0}),m.getParticipants()]).then(([a,o,i])=>{if(r)return;const n=a.users??[];ve(n),B(o.markets??[]),_e((i.participants??[]).map(c=>({id:c.id??c.name,name:c.name}))),n.length>0&&A(n.map(c=>({user_id:c.id,guess:""})))}).catch(()=>{r||(O.current=!1,l("Failed to load admin data","error"))}).finally(()=>{r||K(!1)}),()=>{r=!0,setTimeout(()=>{z=0},fe+500)}},[N?.admin]),N&&!N.admin)return t.jsx(Xe,{to:"/markets",replace:!0});const Fe=u.find(e=>e.market_id===S)?.outcomes??[],d=g==="strike"?ie:"outcome";function xe(e){let r=e.market_type||"other";return r==="market_total_birdies"||r==="market_total_pars"||r==="other"&&(e.market_id==="market-total-birdies"||e.market_id==="market_total_birdies"||e.market_id.includes("total-birdies")||e.market_id.includes("total_birdies")?r="market_total_birdies":(e.market_id==="market-total-pars"||e.market_id==="market_total_pars"||e.market_id.includes("total-pars")||e.market_id.includes("total_pars"))&&(r="market_total_pars")),r}const Ee=s.useMemo(()=>{const r=[...new Set(u.map(a=>xe(a)))].sort((a,o)=>{const i=R.indexOf(a),n=R.indexOf(o);return(i===-1?R.length:i)-(n===-1?R.length:n)});return[{value:"all",label:"All"},...r.map(a=>({value:a,label:Ze(a)}))]},[u]),_=s.useMemo(()=>v==="all"?u:u.filter(e=>xe(e)===v),[u,v]);s.useEffect(()=>{if(g!=="outcome")return;!_.some(r=>r.market_id===f)&&f&&(M(""),j(""))},[g,v,_,f]);async function $e(){he(!0);try{const e=await m.getMarkets({cacheBust:!0});B(e.markets??[]),l(`Markets refreshed (${(e.markets??[]).length} total)`,"success")}catch{l("Failed to refresh markets","error")}finally{he(!1)}}async function Le(){Y(!0);try{const{canceled:e}=await m.adminCancelAllOrders();l(`${e} order(s) canceled`,"success")}catch(e){l(e instanceof Error?e.message:"Failed to cancel orders","error")}finally{Y(!1),T(!1)}}async function Ve(){if(p!=null){Q(!0);try{const{canceled:e}=await m.adminCancelAllOrders(p),r=b.find(a=>a.id===p);l(`${e} order(s) canceled for ${r?.username??p}`,"success")}catch(e){l(e instanceof Error?e.message:"Failed to cancel orders","error")}finally{Q(!1),P(!1),I(null)}}}async function qe(e,r){X(a=>({...a,[e]:!0}));try{await m.adminUpdateMarketPause(e,r),B(a=>a.map(o=>o.market_id===e?{...o,trading_paused:r?1:0}:o)),l(r?"Market paused":"Market resumed","success")}catch(a){l(a instanceof Error?a.message:"Failed to update market","error")}finally{X(a=>({...a,[e]:!1}))}}async function De(e){e.preventDefault();const r=w===""?null:Number(w),a=C===""?null:Number(C),o=E.trim()?parseInt(E,10):NaN,i=$.trim()?parseInt($,10):NaN;if(r==null||!S||!F||Number.isNaN(o)||o<100||o>9900||Number.isNaN(i)||i<1){l("Fill required fields: taker, market, outcome, price (100–9900), contracts (≥1)","error");return}ee(!0);try{await m.adminCreateManualTrade({taker_user_id:r,maker_user_id:a??void 0,market_id:S,outcome_id:F,side:ne,price:o,contract_size:i}),l("Manual trade created","success"),le(""),oe("")}catch(n){l(n instanceof Error?n.message:"Failed to create manual trade","error")}finally{ee(!1)}}function ze(){const e=new Set(x.map(a=>a.user_id)),r=b.find(a=>!e.has(a.id));r?A(a=>[...a,{user_id:r.id,guess:""}]):l("All users are already in the auction","info")}function Ge(e){A(r=>r.filter((a,o)=>o!==e))}function He(e,r,a){A(o=>o.map((i,n)=>n===e?{...i,[r]:a}:i))}async function Ke(e){if(e.preventDefault(),x.length<2){l("At least 2 bids are required","error");return}const r=x.map(n=>n.user_id);if(r.some((n,c)=>n!==0&&r.indexOf(n)!==c)){l("Duplicate user in bids; each user may only appear once","error");return}const o=[];for(let n=0;n<x.length;n++){const c=x[n].user_id,D=x[n].guess.trim()?parseFloat(x[n].guess):NaN;if(!c||Number.isNaN(D)){l(`Bid ${n+1}: select user and enter a numeric guess`,"error");return}o.push({user_id:c,guess:D})}if(d==="round_ou"&&!L){l("Select a participant","error");return}if(d==="outcome"&&!q){l("Select an outcome","error");return}let i="";if(d==="pars")if(h&&h!=="__new__"){const n=u.filter(c=>c.market_type==="pars"||c.short_name&&c.short_name.toLowerCase().includes("pars"));for(const c of n)if((c.outcomes??[]).find(Ye=>Ye.outcome_id===h)){i=c.market_id;break}if(!i){l("Selected line not found","error");return}}else if(h==="__new__"&&V)i=V;else{l("Select a line or choose New line and a market","error");return}me(!0);try{const n=await m.adminRunRoundOuAuction({auction_type:d,...d==="round_ou"&&{round:de},...d==="round_ou"&&{participant_id:L},...d==="pars"&&i&&{market_id:i},...d==="pars"&&h&&h!=="__new__"&&{outcome_id:h},...d==="outcome"&&{outcome_id:q},bids:o});l(`Auction done. Strike: ${n.strike}. ${n.trades_created} trade(s) created.`,"success"),G(`/markets/${n.market_id}`)}catch(n){l(n instanceof Error?n.message:"Failed to run auction","error")}finally{me(!1)}}async function be(e){te(!0);try{let r=await m.adminReplayPositions(e?{full_reset:!0}:void 0),a=r.trades_replayed;for(;r.has_more&&r.after_trade_id!=null;)r=await m.adminReplayPositions({after_trade_id:r.after_trade_id}),a+=r.trades_replayed;l(r.message??`Done. ${a} trades replayed.`,"success"),r.trades_skipped!=null&&r.trades_skipped>0&&l(`${r.trades_skipped} trade(s) skipped (missing taker_user_id or taker_side)`,"info")}catch(r){l(r instanceof Error?r.message:"Failed to replay positions","error")}finally{te(!1)}}async function We(){ae(!0);try{const e=await m.adminRefreshVolume();l(`Volume cache updated for ${e?.updated??0} market(s)`,"success")}catch(e){l(e instanceof Error?e.message:"Failed to refresh volume","error")}finally{ae(!1)}}return t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("div",{className:"flex items-center gap-2 sm:gap-4",children:t.jsxs("button",{onClick:()=>G("/markets"),className:"flex items-center gap-2 px-3 sm:px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800 transition touch-manipulation",children:[t.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),t.jsx("span",{className:"hidden sm:inline",children:"Back"})]})}),t.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Admin"}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Cancel orders"}),t.jsxs("div",{className:"flex flex-wrap gap-3 items-center",children:[t.jsx("button",{type:"button",onClick:()=>T(!0),disabled:W,className:"px-3 py-2 text-sm font-medium bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50",children:W?"Canceling…":"Cancel all open orders (all users)"}),t.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"or for user:"}),t.jsxs("select",{value:p??"",onChange:e=>I(e.target.value?Number(e.target.value):null),className:"border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select user"}),b.map(e=>t.jsxs("option",{value:e.id,children:[e.username," (id: ",e.id,")"]},e.id))]}),t.jsx("button",{type:"button",onClick:()=>p!=null&&P(!0),disabled:p==null||J,className:"px-3 py-2 text-sm font-medium bg-amber-600 text-white rounded-md hover:bg-amber-700 disabled:opacity-50",children:J?"Canceling…":"Cancel all for this user"})]})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Volume cache"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Recompute 30-day volume per market so list and detail pages show correct volume. Also runs automatically every 4 hours via cron."}),t.jsx("button",{type:"button",onClick:We,disabled:re,className:"px-3 py-2 text-sm font-medium rounded-md bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-50",children:re?"Refreshing…":"Refresh volume"})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Ensure portfolio values are zero-sum"}),t.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:["Portfolio value (unrealized P&L) should sum to zero. ",t.jsx("strong",{children:"Replay positions"})," recomputes ",t.jsx("code",{className:"text-xs",children:"net_position"})," and ",t.jsx("code",{className:"text-xs",children:"price_basis"})," from trade history. ",t.jsx("strong",{children:"Replay with full reset"})," deletes all position rows, then replays so positions are re-created only from the trade log (clean slate)."]}),t.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.jsx("button",{type:"button",onClick:()=>be(!1),disabled:U,className:"px-3 py-1.5 text-sm font-medium rounded-md bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50",children:U?"Running…":"Replay positions"}),t.jsx("button",{type:"button",onClick:()=>be(!0),disabled:U,className:"px-3 py-1.5 text-sm font-medium rounded-md bg-blue-500 text-white hover:bg-blue-600 disabled:opacity-50",children:"Replay with full reset"})]})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Pause / resume trading by market"}),H?t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Loading markets…"}):t.jsx("ul",{className:"space-y-2",children:u.map(e=>{const r=(e.trading_paused??0)===1,a=Ce[e.market_id];return t.jsxs("li",{className:"flex items-center justify-between gap-2 py-2 border-b border-gray-200 dark:border-gray-700 last:border-0",children:[t.jsx("span",{className:"text-sm font-medium truncate",children:e.short_name}),t.jsx("button",{type:"button",onClick:()=>qe(e.market_id,!r),disabled:a,className:`px-3 py-1.5 text-sm font-medium rounded-md disabled:opacity-50 ${r?"bg-green-600 text-white hover:bg-green-700":"bg-gray-500 text-white hover:bg-gray-600"}`,children:a?"…":r?"Resume":"Pause"})]},e.market_id)})})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3",children:"Add manual trade"}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Record a trade like normal matching: taker is the one who took (placed the crossing order); maker is whose order was hit. Side is the taker's side (bid = buy, ask = sell). Both positions are updated when maker is set."}),t.jsxs("form",{onSubmit:De,className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taker (required)"}),t.jsxs("select",{value:w===""?"":w,onChange:e=>Se(e.target.value?Number(e.target.value):""),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select taker"}),b.map(e=>t.jsxs("option",{value:e.id,children:[e.username," (id: ",e.id,")"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Maker (optional)"}),t.jsxs("select",{value:C===""?"":String(C),onChange:e=>Me(e.target.value?Number(e.target.value):""),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"None (house / system)"}),b.map(e=>t.jsxs("option",{value:e.id,children:[e.username," (id: ",e.id,")"]},e.id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market"}),t.jsxs("select",{value:S,onChange:e=>{Ae(e.target.value),se("")},required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),u.map(e=>t.jsx("option",{value:e.market_id,children:e.short_name},e.market_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Outcome"}),t.jsxs("select",{value:F,onChange:e=>se(e.target.value),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select outcome"}),Fe.map(e=>t.jsx("option",{value:e.outcome_id,children:e.name},e.outcome_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Taker side"}),t.jsxs("select",{value:ne,onChange:e=>Re(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"bid",children:"Bid (taker bought)"}),t.jsx("option",{value:"ask",children:"Ask (taker sold)"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Price (cents, 100–9900)"}),t.jsx("input",{type:"number",min:100,max:9900,value:E,onChange:e=>le(e.target.value),placeholder:"e.g. 5000",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Contract size"}),t.jsx("input",{type:"number",min:1,value:$,onChange:e=>oe(e.target.value),placeholder:"e.g. 10",className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm"})]}),t.jsx("button",{type:"submit",disabled:Z,className:"px-3 py-2 text-sm font-medium bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50",children:Z?"Creating…":"Add manual trade"})]})]})}),t.jsx(y,{children:t.jsxs(k,{children:[t.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3 flex-wrap",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Auction"}),t.jsx("button",{type:"button",onClick:$e,disabled:pe||H,className:"text-sm px-2 py-1 rounded border border-gray-300 dark:border-gray-600 hover:bg-gray-100 dark:hover:bg-gray-700 disabled:opacity-50",children:pe?"Refreshing…":"Refresh markets"})]}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:g==="strike"?"Strike from average: enter bids (guess or %). Strike = average; lowest half get short, rest long, all at 50¢.":"Outcome: select market and outcome. Enter each bid as %. Trade price = average of bids; lowest half short, rest long."}),t.jsxs("form",{onSubmit:Ke,className:"space-y-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Auction type"}),t.jsxs("select",{value:g,onChange:e=>{const r=e.target.value;Oe(r),r==="outcome"&&(M(""),j(""))},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"strike",children:"Strike from average (50¢)"}),t.jsx("option",{value:"outcome",children:"Outcome (average price)"})]})]}),g==="strike"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Strike type"}),t.jsxs("select",{value:ie,onChange:e=>Be(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"round_ou",children:"Round O/U"}),t.jsx("option",{value:"pars",children:"Pars"})]})]}),d==="round_ou"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Round"}),t.jsx("select",{value:de,onChange:e=>Te(Number(e.target.value)),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[1,2,3,4,5,6].map(e=>t.jsxs("option",{value:e,children:["Round ",e]},e))})]}),d==="round_ou"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Participant"}),t.jsxs("select",{value:L,onChange:e=>Pe(e.target.value),required:!0,className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select participant"}),je.map(e=>t.jsx("option",{value:e.id,children:e.name},e.id))]})]}),g==="outcome"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market type"}),t.jsx("select",{value:v,onChange:e=>{const r=e.target.value;Ue(r),(r==="all"?u:u.filter(i=>(i.market_type??"other")===r)).some(i=>i.market_id===f)||(M(""),j(""))},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:Ee.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market"}),t.jsxs("select",{value:f,onChange:e=>{const r=_.find(a=>a.market_id===e.target.value);console.log("[Auction] Selected market:",e.target.value,"outcomes:",r?.outcomes),M(e.target.value),j("")},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),_.map(e=>t.jsx("option",{value:e.market_id,children:e.short_name??e.market_id},e.market_id))]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Outcome"}),t.jsxs("select",{value:q,onChange:e=>j(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select outcome"}),(_.find(e=>e.market_id===f)?.outcomes??[]).map(e=>t.jsx("option",{value:e.outcome_id,children:e.name??e.outcome_id},e.outcome_id))]})]})]}),d==="pars"&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Line"}),t.jsxs("select",{value:h||"",onChange:e=>{const r=e.target.value;Ie(r),r||ce("")},className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select line"}),u.filter(e=>e.market_type==="pars"||e.short_name&&e.short_name.toLowerCase().includes("pars")).flatMap(e=>(e.outcomes??[]).map(r=>({outcome_id:r.outcome_id,market_id:e.market_id,label:r.strike!=null&&r.strike!==""?`O${r.strike}`:r.name??r.outcome_id}))).map(e=>t.jsx("option",{value:e.outcome_id,children:e.label},e.outcome_id)),t.jsx("option",{value:"__new__",children:"— New line (strike from bid average) —"})]})]}),d==="pars"&&h==="__new__"&&t.jsxs("div",{children:[t.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market (for new line)"}),t.jsxs("select",{value:V,onChange:e=>ce(e.target.value),className:"w-full border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm",children:[t.jsx("option",{value:"",children:"Select market"}),u.filter(e=>e.market_type==="pars"||e.short_name&&e.short_name.toLowerCase().includes("pars")).map(e=>t.jsx("option",{value:e.market_id,children:e.short_name},e.market_id))]})]})]}),t.jsxs("div",{children:[t.jsxs("div",{className:"flex items-center justify-between mb-1",children:[t.jsx("label",{className:"block text-sm font-medium",children:"Participants (min 2, remove those not in)"}),t.jsx("button",{type:"button",onClick:ze,className:"text-sm text-primary-600 dark:text-primary-400 hover:underline",children:"Add"})]}),t.jsx("div",{className:"space-y-2",children:x.map((e,r)=>{const a=b.find(o=>o.id===e.user_id);return t.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[t.jsx("span",{className:"flex-1 min-w-[120px] text-sm font-medium text-gray-900 dark:text-gray-100",children:a?.username??`User ${e.user_id}`}),t.jsx("input",{type:"number",step:"any",min:d==="pars"||d==="outcome"?0:void 0,max:d==="pars"||d==="outcome"?100:void 0,value:e.guess,onChange:o=>He(r,"guess",o.target.value),placeholder:d==="pars"||d==="outcome"?"Bid %":"Guess",className:"w-20 border border-gray-300 dark:border-gray-600 rounded-md px-2 py-1.5 bg-white dark:bg-gray-800 text-sm"}),x.length>2&&t.jsx("button",{type:"button",onClick:()=>Ge(r),className:"p-1.5 text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded","aria-label":"Remove participant",children:"×"})]},r)})})]}),t.jsx("button",{type:"submit",disabled:ue,className:"px-3 py-2 text-sm font-medium bg-primary-600 text-white rounded-md hover:bg-primary-700 disabled:opacity-50",children:ue?"Running…":"Run auction"})]})]})}),t.jsx(ge,{isOpen:Ne,onClose:()=>T(!1),onConfirm:Le,title:"Cancel all open orders",message:"Cancel all open/partial orders for every user? This cannot be undone.",confirmLabel:"Cancel all",variant:"danger"}),t.jsx(ge,{isOpen:we,onClose:()=>{P(!1),I(null)},onConfirm:Ve,title:"Cancel all orders for this user",message:p!=null?`Cancel all open/partial orders for user ${b.find(e=>e.id===p)?.username??p}?`:"",confirmLabel:"Cancel all",variant:"danger"}),t.jsx(tt,{toasts:ye,removeToast:ke})]})}export{it as AdminPage};
