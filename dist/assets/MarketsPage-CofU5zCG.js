import{r as i,b as R,j as e,L as B,c as T}from"./index-1EVfI4dx.js";import{P as E}from"./PullToRefresh-UgsvgPCs.js";function O(s){return s.includes("team-champion")||s.includes("champion")&&!s.includes("individual")?e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"})}):s.includes("individual")&&(s.includes("net")||s.includes("gross"))?e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}):s.includes("round")||s.includes("ou")?e.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M12 4v8M8 8h8"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2.5,d:"M8 16h8"})]}):s.includes("birdies")||s.includes("birdie")?e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 19l9 2-9-18-9 18 9-2zm0 0v-8"})}):s.includes("h2h")||s.includes("matchup")?e.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"6",cy:"12",r:"4",strokeWidth:2}),e.jsx("circle",{cx:"18",cy:"12",r:"4",strokeWidth:2}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v6M10.5 12h3"})]}):s.includes("hole-in-one")||s.includes("hio")?e.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10",strokeWidth:2}),e.jsx("circle",{cx:"12",cy:"12",r:"3",strokeWidth:2})]}):s.includes("eagles")?e.jsxs("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("circle",{cx:"12",cy:"9",r:"2.5",strokeWidth:2}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 11.5v4c0 1.5-.8 2.8-2 3.5-1.2-.7-2-2-2-3.5v-4"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 11c0 0 2-3 4-3s4 3 4 3"})]}):e.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})})}const b="markets_prefer_fresh_at",H=900*1e3;function z(){try{const s=sessionStorage.getItem(b);if(!s)return!1;const o=parseInt(s,10);return Number.isNaN(o)?!1:Date.now()-o<H}catch{return!1}}function F(){try{sessionStorage.setItem(b,String(Date.now()))}catch{}}function P({tripId:s}){const[o,N]=i.useState([]),[L,m]=i.useState(!0),[x,p]=i.useState(!1),[k,u]=i.useState(null),[M,f]=i.useState(0);i.useEffect(()=>{c(!1,z())},[s]);async function c(r=!1,t=!1){const n=t&&o.length>0;!r&&!n&&(m(!0),u(null)),n&&p(!0);try{const{markets:a}=await R.getMarkets(t?{cacheBust:!0}:void 0);N(a??[]),u(null),f(0)}catch(a){console.error("Failed to load markets:",a);const h=a?.message||"Failed to load markets";u(h),!r&&M===0&&setTimeout(()=>{f(1),c(!0,!1)},2e3)}finally{m(!1),p(!1)}}async function g(){await c(!1,!0),F()}function w(r){return r&&{team_champion:"Team",individual_champion:"Individual",matchups:"Matchups",h2h_matchups:"Head-to-Head",round_matchups:"Round Matchups",special_matchups:"Special Matchups",round_ou:"Round Over/Under",total_birdies:"Totals",specials:"Specials",hole_in_one:"Specials"}[r]||"Other"}const l=o.reduce((r,t)=>{const n=t.market_type||"other";return r[n]||(r[n]=[]),r[n].push(t),r},{}),j=["team_champion","individual_champion","matchups","h2h_matchups","round_matchups","special_matchups","round_ou","total_birdies","specials","hole_in_one","other"],v=["market-h2h-matchups","market-round-matchups","market-special-matchups"],_=j.filter(r=>l[r]?.length>0),S=Object.keys(l).filter(r=>!j.includes(r)&&l[r]?.length>0),W=[..._,...S];function C(r,t){return r!=="matchups"||t.length<=1?t:[...t].sort((n,a)=>{const h=v.indexOf(n.market_id),y=v.indexOf(a.market_id);return(h===-1?999:h)-(y===-1?999:y)})}let d;return L&&o.length===0?d=e.jsx("div",{className:"text-center py-8",children:"Loading markets..."}):k&&o.length===0?d=e.jsxs("div",{className:"text-center py-8",children:[e.jsxs("div",{className:"text-red-600 dark:text-red-400 mb-4",children:[e.jsx("p",{className:"font-semibold",children:"Error loading markets"}),e.jsx("p",{className:"text-sm mt-2",children:k})]}),e.jsx("button",{onClick:()=>c(),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Retry"})]}):d=e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[W.map(r=>{const t=C(r,l[r]),n=w(r);return e.jsxs("div",{className:"space-y-2 sm:space-y-3",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100 border-b border-gray-300 dark:border-gray-600 pb-1.5",children:n}),e.jsx("div",{className:"grid gap-2 sm:gap-3",children:t.map(a=>e.jsxs(B,{to:`/markets/${a.market_id}`,className:"flex items-center gap-2 sm:gap-3 p-3 sm:p-4 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-800 hover:border-primary-500 dark:hover:border-primary-400 hover:shadow-md transition-all cursor-pointer touch-manipulation active:bg-gray-100 dark:active:bg-gray-700 active:scale-[0.98]",children:[e.jsx("div",{className:"flex-shrink-0 text-primary-600 dark:text-primary-400",children:e.jsx("div",{className:"w-8 h-8 sm:w-7 sm:h-7",children:O(a.market_id)})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h3",{className:"font-bold text-sm sm:text-base text-gray-900 dark:text-gray-100 truncate",children:a.short_name})}),e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})})]},a.id))})]},r)}),o.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No markets found"})]}),e.jsxs(E,{onRefresh:g,children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-4 sm:mb-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Markets"}),e.jsx("button",{type:"button",onClick:g,disabled:x,className:"p-1.5 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md disabled:opacity-50 transition-colors touch-manipulation",title:"Bypass cache and reload markets","aria-label":"Refresh markets",children:e.jsx("svg",{className:`w-5 h-5 ${x?"animate-spin":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})})})]}),d]})}function $(){const s=T();return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Markets"})}),e.jsx(P,{},s.key)]})}export{$ as MarketsPage};
