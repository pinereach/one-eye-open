import{r as o,j as e,d as Ft,a as It,u as Tt,b as V,S as kt,L as Dt}from"./index-BTwzOfe7.js";import{f as re,a as ie,b as L,c as ft,d as te,e as ze}from"./format-BckxrTVz.js";import{u as Et,T as Rt}from"./Toast-DEpBsUw6.js";import{C as Ue}from"./ConfirmModal-C9Rl68DI.js";import{P as qt}from"./PullToRefresh-Bs-dRHtB.js";import{C as jt,b as vt}from"./Card-D96WZEWZ.js";import{f as Nt}from"./index-BAgxTVAR.js";function Yt({isOpen:N,orders:T,price:z,onClose:m,onCancel:O}){const j=u=>new Date(u*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});return N?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold",children:"Cancel Order"}),e.jsx("button",{onClick:m,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl font-bold",children:"×"})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["You have multiple orders at ",re(z),". Select which one to cancel:"]}),e.jsx("div",{className:"space-y-2",children:T.map(u=>e.jsx("button",{onClick:()=>{O(u.id),m()},className:"w-full text-left p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm sm:text-base",children:[u.contract_size||0," contracts"]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:u.create_time?j(u.create_time):"—"})]}),e.jsx("div",{className:"text-xs sm:text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded ${u.status==="open"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":u.status==="partial"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:u.status})})]})},u.id))}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:m,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:"Cancel"})})]})})}):null}function Fe({bids:N,asks:T,userId:z,onPriceClick:m,onCancelOrder:O}){const[j,u]=o.useState({isOpen:!1,orders:[],price:0}),Z=p=>{const C=new Map;return p.forEach(g=>{const _=g.price||0;C.has(_)||C.set(_,{price:_,totalSize:0,orders:[],userOrders:[]});const c=C.get(_);c.orders.push(g),c.totalSize+=g.contract_size||0,z!==void 0&&g.user_id===z&&c.userOrders.push(g)}),Array.from(C.values()).sort((g,_)=>_.price-g.price)},b=p=>{const C=new Map;return p.forEach(g=>{const _=g.price||0;C.has(_)||C.set(_,{price:_,totalSize:0,orders:[],userOrders:[]});const c=C.get(_);c.orders.push(g),c.totalSize+=g.contract_size||0,z!==void 0&&g.user_id===z&&c.userOrders.push(g)}),Array.from(C.values()).sort((g,_)=>g.price-_.price)},B=Z(N),f=b(T),$=p=>{let C=0;return p.map(g=>(C+=g.totalSize,{...g,cumulative:C}))},D=$(B),se=$(f),H=Math.max(...D.map(p=>p.cumulative),...se.map(p=>p.cumulative),1),le=p=>{const C=p.userOrders.filter(g=>g.status==="open"||g.status==="partial");C.length!==0&&(C.length===1?O&&O(C[0].id):u({isOpen:!0,orders:C,price:p.price}))};return e.jsxs(e.Fragment,{children:[e.jsx(Yt,{isOpen:j.isOpen,orders:j.orders,price:j.price,onClose:()=>u({isOpen:!1,orders:[],price:0}),onCancel:p=>{O&&O(p)}}),e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-sm sm:text-base text-green-600 dark:text-green-400",children:"Yes/Buy"}),e.jsx("div",{className:"space-y-1",children:B.length===0?e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No bids"}):D.map(p=>{const C=p.cumulative/H*100,g=p.userOrders.length>0,_=p.userOrders.filter(v=>v.status==="open"||v.status==="partial"),c=g&&_.length>0,W=_.reduce((v,G)=>v+(G.contract_size??0),0),K=g&&W>0&&p.orders.length>1;return e.jsxs("div",{className:`relative flex items-center justify-between text-xs sm:text-sm p-2 rounded transition-colors touch-manipulation h-12 ${g?"bg-green-100 dark:bg-green-900/40 border-2 border-primary-500 dark:border-primary-400":"bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 cursor-pointer"}`,onClick:()=>!g&&m?.(p.price,"bid"),children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-green-200 dark:bg-green-800/40 rounded opacity-30",style:{width:`${C}%`}}),e.jsxs("div",{className:"relative z-10 flex items-center gap-1 flex-1",children:[g&&e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-primary-600 dark:text-primary-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:v=>{v.stopPropagation(),c&&le(p)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium",children:re(p.price)})]}),e.jsxs("div",{className:"relative z-10 flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[p.totalSize,K&&e.jsxs("span",{className:"text-primary-600 dark:text-primary-400 ml-0.5",children:["(",W," mine)"]})]}),c&&e.jsx("button",{onClick:v=>{v.stopPropagation(),le(p)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-0.5 rounded touch-manipulation",title:_.length>1?`Cancel order (${_.length} at this price)`:"Cancel order","aria-label":"Cancel order",children:"×"})]})]},p.price)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-sm sm:text-base text-red-600 dark:text-red-400",children:"No/Sell"}),e.jsx("div",{className:"space-y-1",children:f.length===0?e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No asks"}):se.map(p=>{const C=p.cumulative/H*100,g=p.userOrders.length>0,_=p.userOrders.filter(v=>v.status==="open"||v.status==="partial"),c=g&&_.length>0,W=_.reduce((v,G)=>v+(G.contract_size??0),0),K=g&&W>0&&p.orders.length>1;return e.jsxs("div",{className:`relative flex items-center justify-between text-xs sm:text-sm p-2 rounded transition-colors touch-manipulation h-12 ${g?"bg-red-100 dark:bg-red-900/40 border-2 border-primary-500 dark:border-primary-400":"bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 cursor-pointer"}`,onClick:()=>!g&&m?.(p.price,"ask"),children:[e.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-200 dark:bg-red-800/40 rounded opacity-30",style:{width:`${C}%`}}),e.jsxs("div",{className:"relative z-10 flex items-center gap-1 flex-1",children:[g&&e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-primary-600 dark:text-primary-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:v=>{v.stopPropagation(),c&&le(p)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium",children:re(p.price)})]}),e.jsxs("div",{className:"relative z-10 flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[p.totalSize,K&&e.jsxs("span",{className:"text-primary-600 dark:text-primary-400 ml-0.5",children:["(",W," mine)"]})]}),c&&e.jsx("button",{onClick:v=>{v.stopPropagation(),le(p)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-0.5 rounded touch-manipulation",title:_.length>1?`Cancel order (${_.length} at this price)`:"Cancel order","aria-label":"Cancel order",children:"×"})]})]},p.price)})})]})]})})]})}const _t='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function Vt({isOpen:N,onClose:T,children:z,title:m}){const O=o.useRef(null),j=o.useRef(null),u=o.useRef(null),Z=o.useCallback(()=>{const b=O.current,B=j.current;if(b&&B){const f=b.getBoundingClientRect(),$=B.getBoundingClientRect();if(f.width>0&&f.height>0)return b;if($.width>0&&$.height>0)return B}return b??B},[]);return o.useEffect(()=>(N?(document.body.style.overflow="hidden",u.current=document.activeElement):(document.body.style.overflow="",u.current&&typeof u.current.focus=="function"&&(u.current.focus(),u.current=null)),()=>{document.body.style.overflow=""}),[N]),o.useEffect(()=>{if(!N)return;const b=B=>{if(B.key==="Escape"){T();return}if(B.key!=="Tab")return;const f=Z();if(!f)return;const $=Array.from(f.querySelectorAll(_t)).filter(H=>!H.hasAttribute("disabled")&&H.offsetParent!=null);if($.length===0)return;const D=$[0],se=$[$.length-1];B.shiftKey?document.activeElement===D&&(B.preventDefault(),se.focus()):document.activeElement===se&&(B.preventDefault(),D.focus())};return document.addEventListener("keydown",b),()=>document.removeEventListener("keydown",b)},[N,T,Z]),o.useEffect(()=>{if(!N)return;const b=Z();if(!b)return;const B=b.querySelector(_t),f=requestAnimationFrame(()=>{B&&B.focus()});return()=>cancelAnimationFrame(f)},[N,Z]),N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:T,"aria-hidden":"true"}),e.jsxs("div",{ref:O,className:"fixed bottom-0 left-0 right-0 z-50 md:hidden bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl max-h-[90vh] overflow-y-auto safe-area-bottom",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-gray-800 pt-2 pb-2 flex justify-center",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),m&&e.jsx("div",{className:"px-3 pb-2 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:m}),e.jsx("button",{onClick:T,className:"p-2 -mr-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 touch-manipulation min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"px-3 pt-3 pb-24",children:z})]}),e.jsx("div",{className:"hidden md:flex fixed inset-0 z-50 items-center justify-center p-4",children:e.jsxs("div",{ref:j,className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",onClick:b=>b.stopPropagation(),role:"dialog","aria-modal":"true",children:[m&&e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:m}),e.jsx("button",{onClick:T,className:"p-2 -mr-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"px-6 py-4",children:z})]})})]}):null}function Ht({tabs:N,activeTab:T,onTabChange:z,className:m=""}){return e.jsx("div",{className:`border-b border-gray-300 dark:border-gray-600 ${m}`,children:e.jsx("div",{className:"flex overflow-x-auto -mx-3 sm:mx-0 px-3 sm:px-0 scrollbar-hide",children:N.map(O=>{const j=T===O.id;return e.jsxs("button",{onClick:()=>z(O.id),className:`
                flex items-center gap-2 px-4 py-3 text-sm font-medium whitespace-nowrap
                border-b-2 transition-colors touch-manipulation min-h-[44px]
                ${j?"border-primary-600 dark:border-primary-400 text-primary-600 dark:text-primary-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:border-gray-300 dark:hover:border-gray-600"}
              `,"aria-selected":j,role:"tab",children:[O.icon&&e.jsx("span",{className:"flex-shrink-0",children:O.icon}),e.jsx("span",{children:O.label})]},O.id)})})})}const wt="(min-width: 768px)";function Wt(){const[N,T]=o.useState(()=>typeof window<"u"?window.matchMedia(wt).matches:!1);return o.useEffect(()=>{const z=window.matchMedia(wt),m=O=>T(O.matches);return T(z.matches),z.addEventListener("change",m),()=>z.removeEventListener("change",m)},[]),N}function er(){const{id:N}=Ft(),T=It(),{toasts:z,showToast:m,removeToast:O}=Et(),{user:j}=Tt(),[u,Z]=o.useState(null),[b,B]=o.useState([]),[f,$]=o.useState(""),[D,se]=o.useState({}),[H,le]=o.useState([]),[p,C]=o.useState([]),[g,_]=o.useState(!0),[c,W]=o.useState("bid"),[K,v]=o.useState(""),[G,ge]=o.useState(""),[_e,he]=o.useState(""),[we,be]=o.useState(""),[Ce,Pe]=o.useState(!1),[Ie,U]=o.useState(null),[ye,ce]=o.useState(!1),[oe,Te]=o.useState(!1),[de,Ct]=o.useState("outcomes"),[Ke,Ge]=o.useState(null),[Se,Xe]=o.useState(!1),[De,Je]=o.useState(null),[Pt,Ze]=o.useState(!1),[St,Ee]=o.useState(!1),[et,tt]=o.useState(!1),[X,ke]=o.useState({}),[rt,Re]=o.useState({}),[st,Ot]=o.useState({}),[q,qe]=o.useState({}),at=Wt(),Ye=o.useRef(null),Ve=o.useRef(0),nt=12e4;function Mt(t,r,n,s){const a=t?.net_position??0,l=t?.price_basis??0,i=100,x=9900;let k=a,y=l;if(r==="bid")if(a<0){const w=Math.min(s,Math.abs(a)),h=s-w;k=a+w,h>0?(k+=h,y=n):k===0&&(y=0)}else k=a+s,y=a>0&&l>0?Math.round((a*l+s*n)/k):n;else if(a>0){const w=Math.min(s,a),h=s-w;k=a-w,h>0?(k-=h,y=n):k===0&&(y=0)}else k=a-s,y=a<0&&l>0?Math.round((Math.abs(a)*l+s*n)/Math.abs(k)):n;return k!==0&&y>0&&(y=Math.max(i,Math.min(x,y))),{net_position:k,price_basis:y}}function Oe(t,r){const n=t.indexOf(" Over ");if(n===-1)return r?t:e.jsx(e.Fragment,{children:t});const s=t.slice(0,n).trim(),a=t.slice(n+6).trim(),l=X[s],i=X[a],x=k=>e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",k,")"]});return r?`${s}${l!=null?` (${l})`:""} Over ${a}${i!=null?` (${i})`:""}`:e.jsxs(e.Fragment,{children:[s,l!=null&&x(l)," Over ",a,i!=null&&x(i)]})}o.useEffect(()=>{N&&Y()},[N]),o.useEffect(()=>{j&&!j.view_market_maker&&c==="market_maker"&&W("bid")},[j?.view_market_maker,c]),o.useEffect(()=>{ye&&Ye.current&&setTimeout(()=>{Ye.current?.focus()},100)},[ye]),o.useEffect(()=>{ye&&N&&Date.now()-Ve.current>=nt&&Y()},[ye,N]),o.useEffect(()=>{const t=()=>{document.visibilityState==="visible"&&N&&Date.now()-Ve.current>=nt&&Y()};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[N]);async function Y(t=!1){if(N){_(!0);try{const r=await V.getMarket(N,t?{cacheBust:!0}:void 0);if(Z(r?.market||null),B(r?.outcomes||[]),se(r?.orderbook||{}),le(r?.trades??[]),C(r?.positions??[]),Ot(r?.lastTradePriceByOutcome??{}),r?.market?.market_id==="market-individual-net-champion"||r?.market?.market_id==="market-h2h-matchups"?V.getHandicaps(2026).then(l=>{const i=("handicaps"in l?l.handicaps:{})??{};Object.keys(i).length>0?ke(i):V.getHandicaps(2025).then(x=>ke(("handicaps"in x?x.handicaps:{})??{})).catch(()=>ke({}))}).catch(()=>ke({})):ke({}),r?.market?.market_id==="market-individual-gross-champion"||r?.market?.market_id==="market-individual-net-champion"?V.getCurrentScores().then(l=>{const i={};for(const x of l.scores??[])i[x.name]={score_gross:x.score_gross,score_net:x.score_net,number_birdies:x.number_birdies};Re(i)}).catch(()=>Re({})):Re({}),r?.market?.market_id?.includes("volatility")||r?.market?.short_name&&r.market.short_name.toLowerCase().includes("volatility")?V.getPlayerVolatility().then(l=>{qe(l?.volatilityByPlayer??{})}).catch(()=>qe({})):qe({}),r.outcomes&&r.outcomes.length>0&&r.orderbook){const i=r.market?.market_id==="market-total-strokes"?[...r.outcomes]:[...r.outcomes].sort((x,k)=>{const y=r.orderbook[x.outcome_id],w=r.orderbook[k.outcome_id],h=y?.bids?.[0],S=y?.asks?.[0],d=w?.bids?.[0],P=w?.asks?.[0],R=h&&S?(h.price+S.price)/2:h?.price||0;return(d&&P?(d.price+P.price)/2:d?.price||0)-R});!f&&i.length>0&&$(i[0].outcome_id)}}catch(r){console.error("Failed to load market:",r),m("Failed to load market data","error")}finally{_(!1),Ve.current=Date.now()}}}async function it(t){if(t.preventDefault(),!N||!f){m("Please select an outcome","error");return}const r=parseInt(G,10);if(isNaN(r)||r<=0){m("Quantity must be at least 1","error");return}if(c==="market_maker"){const l=parseInt(_e,10),i=parseInt(we,10);if(isNaN(l)||l<1||l>99){m("Bid price must be a whole number between $1 and $99","error");return}if(isNaN(i)||i<1||i>99){m("Ask price must be a whole number between $1 and $99","error");return}if(l>=i){m("Bid price must be less than ask price","error");return}Pe(!0);try{await V.placeOrder(N,{outcome_id:f,side:"bid",price:l*100,contract_size:r,tif:"GTC"}),await V.placeOrder(N,{outcome_id:f,side:"ask",price:i*100,contract_size:r,tif:"GTC"}),ge(""),he(""),be(""),m("Bid and ask placed","success"),await new Promise(x=>setTimeout(x,200)),await Y(!0),ce(!1)}catch(x){m(x?.message||"Failed to place orders","error"),await Y(!0),m("Orderbook refreshed – please try again if needed.","info")}finally{Pe(!1)}return}const n=parseInt(K,10);if(isNaN(n)||n<1||n>99){m("Price must be a whole number between $1 and $99","error");return}const s=n*100,a=f&&D?.[f]||null;if(a&&j?.id){if(c==="bid"){if(a.asks.filter(i=>i.user_id===j.id&&(i.status==="open"||i.status==="partial")&&i.price<=s).length>0){m("Cannot place bid: You have existing sell orders at this price or better","error");return}}else if(a.bids.filter(i=>i.user_id===j.id&&(i.status==="open"||i.status==="partial")&&i.price>=s).length>0){m("Cannot place ask: You have existing buy orders at this price or better","error");return}}Pe(!0);try{const l=await V.placeOrder(N,{outcome_id:f,side:c,price:s,contract_size:r,tif:"GTC"});v(""),ge(""),U(null),m("Order placed successfully!","success");const i=l?.order,x=l?.fills??[],k=l?.trades??[],y=f,w=j?.id;if(i&&y&&w!=null){const h=typeof i.id=="string"?parseInt(i.id,10):i.id,S=i.price_cents??i.price??s,d=i.qty_remaining??i.contract_size??i.qty_contracts??r,P=i.status??"open",R=i.side==="ask"?1:0,A={id:h,create_time:i.created_at??Math.floor(Date.now()/1e3),user_id:w,token:"",order_id:h,outcome:y,price:S,status:P,tif:"GTC",side:R,contract_size:d,remaining_size:d};se(xe=>{const Q={...xe},bt=Q[y]??{bids:[],asks:[]},He=[...bt.bids??[]],We=[...bt.asks??[]],ue=R===0?We:He;for(const J of x){const Le=typeof J.maker_order_id=="string"?parseInt(J.maker_order_id,10):J.maker_order_id,ee=J.qty_contracts??J.qty??0,pe=ue.findIndex(yt=>yt.id===Le);if(pe>=0){const Qe=(ue[pe].remaining_size??ue[pe].contract_size??0)-ee;Qe<=0?ue.splice(pe,1):ue.splice(pe,1,{...ue[pe],contract_size:Qe,remaining_size:Qe,status:"partial"})}}if(P==="open"||P==="partial"){const J=R===0?He:We,Le=R===0?J.findIndex(ee=>ee.price<S||ee.price===S&&ee.create_time>A.create_time):J.findIndex(ee=>ee.price>S||ee.price===S&&ee.create_time>A.create_time);Le===-1?J.push(A):J.splice(Le,0,A)}return Q[y]={bids:He,asks:We},Q})}if(k.length>0&&y&&w!=null){let h=null;const S=(p??[]).find(d=>d.outcome===y);S&&(h={net_position:S.net_position,price_basis:S.price_basis});for(const d of k){const P=d.price_cents??d.price??0,R=d.qty_contracts??d.contracts??0;h=Mt(h,c,P,R)}h!=null&&C(d=>{const P=d.findIndex(Q=>Q.outcome===y),R=S??{id:0,user_id:w,outcome:y,create_time:Math.floor(Date.now()/1e3),closed_profit:0,settled_profit:0,net_position:0,price_basis:0,is_settled:0,market_name:u?.short_name,outcome_name:b?.find(Q=>Q.outcome_id===y)?.name,outcome_ticker:b?.find(Q=>Q.outcome_id===y)?.ticker},A=[...d],xe={...R,...h};return P>=0?A.splice(P,1,xe):A.push(xe),A})}if(k.length>0&&y){const h=b?.find(d=>d.outcome_id===y),S=k.map(d=>({id:typeof d.id=="string"?parseInt(d.id,10):d.id,token:d.token??"",price:d.price_cents??d.price??0,contracts:d.qty_contracts??d.contracts??0,create_time:d.created_at??d.create_time??Math.floor(Date.now()/1e3),risk_off_contracts_taker:0,risk_off_contracts_maker:0,risk_off_price_diff_taker:0,risk_off_price_diff_maker:0,outcome:y,outcome_name:h?.name??null,outcome_ticker:h?.ticker??null,side:c==="bid"?0:1,taker_side:c==="bid"?0:1}));le(d=>[...S,...d??[]])}Y(!0)}catch(l){m(l.message||"Failed to place order","error"),Y(!0),m("Orderbook refreshed – please try again if needed.","info")}finally{Pe(!1)}}function lt(t,r){if($(t),W("bid"),r){const n=Math.round(r/100),s=Math.max(1,Math.min(99,n));v(s.toString()),U("price"),setTimeout(()=>U(null),2e3)}ce(!0)}function dt(t,r){if($(t),W("ask"),r){const n=Math.round(r/100),s=Math.max(1,Math.min(99,n));v(s.toString()),U("price"),setTimeout(()=>U(null),2e3)}ce(!0)}function me(t){if(W(t),M){if(t==="bid"&&F){const r=Math.round(F.price/100),n=Math.max(1,Math.min(99,r));v(n.toString())}else if(t==="ask"&&I){const r=Math.round(I.price/100),n=Math.max(1,Math.min(99,r));v(n.toString())}else if(t==="market_maker"&&(F||I)){if(F){const r=Math.max(1,Math.min(99,Math.round(F.price/100)));he(r.toString())}if(I){const r=Math.max(1,Math.min(99,Math.round(I.price/100)));be(r.toString())}}}}const Bt=(()=>{const t=(H||[]).reduce((n,s)=>n+(s.contracts||0),0),r=t*100;return{volume_contracts:t,volume_dollars:r}})(),E=(()=>{const t=parseInt(K,10)||0,r=parseInt(G,10)||0,n=parseInt(_e,10)||0,s=parseInt(we,10)||0;return{totalCost:c==="market_maker"?0:c==="bid"?t*r:r*(100-t),price:t,qty:r,mmBidPrice:n,mmAskPrice:s}})(),M=f&&D?.[f]||null,F=M?.bids?.[0],I=M?.asks?.[0],fe=o.useMemo(()=>{const t=st;if(Object.keys(t).length>0)return t;const r={},n=[...H].sort((s,a)=>a.create_time-s.create_time);for(const s of n){const a=s.outcome??"";a&&r[a]===void 0&&(r[a]=s.price)}return r},[H,st]),ct=b.find(t=>t.outcome_id===f)?.name??"",ae=f?fe[f]:void 0;function ot(t){const r=t.market_name??u?.short_name??"N/A",n=b?.find(a=>a.outcome_id===t.outcome),s=t.outcome_ticker??t.outcome_name??n?.name??n?.ticker??t.outcome;return{marketName:r,outcomeLabel:s}}const Me=(p||[]).reduce((t,r)=>(t[r.outcome]={net_position:r.net_position,price_basis:r.price_basis,closed_profit:r.closed_profit,settled_profit:r.settled_profit},t),{}),Be=o.useMemo(()=>(p||[]).filter(t=>t.net_position!==0||(t.closed_profit??0)!==0||(t.settled_profit??0)!==0),[p]),$e=(t,r)=>`${t>=0?"+":""}${t} @ ${te(r)}`,Ae=t=>t==null?"—":t===0?"E":t>0?`+${t}`:String(t),je=u?.market_id==="market-individual-gross-champion"||u?.market_id==="market-individual-net-champion",ve=u?.market_id?.includes("volatility")||u?.short_name&&u.short_name.toLowerCase().includes("volatility"),$t={"outcome-total-strokes-lt-6499":6500,"outcome-total-strokes-6500-6599":6550,"outcome-total-strokes-6600-6699":6650,"outcome-total-strokes-6700-6799":6750,"outcome-total-strokes-6800-6899":6850,"outcome-total-strokes-gt-6900":6e3},mt=o.useMemo(()=>{if(u?.market_id!=="market-total-strokes"||!b?.length)return null;let t=0,r=0;for(const n of b){const s=$t[n.outcome_id];if(s==null)continue;const a=D?.[n.outcome_id],l=a?.bids?.[0],i=a?.asks?.[0],x=l&&i?(l.price+i.price)/2:l?.price??fe[n.outcome_id]??0;if(x<=0)continue;const k=x/1e4;t+=s*k,r+=k}return r<=0?null:Math.round(t/r)},[u?.market_id,b,D,fe]),xt=(t,r)=>r===null?null:t.net_position<0?(1e4-r)*Math.abs(t.net_position):t.net_position*r,ne=o.useMemo(()=>{if(!j?.id||!(de==="orders"||at))return[];const t=[];for(const r of Object.values(D))for(const n of[...r.bids||[],...r.asks||[]])n.user_id===j.id&&(n.status==="open"||n.status==="partial")&&t.push(n);return t},[de,at,D,j?.id]),Ne=o.useMemo(()=>!j?.id||!M?[]:[...M.bids||[],...M.asks||[]].filter(r=>r.user_id===j.id&&(r.status==="open"||r.status==="partial")),[j?.id,M]);async function At(t){Ge(t);try{await V.cancelOrder(t),m("Order canceled successfully","success"),await Y(!0)}catch(r){console.error("Failed to cancel order:",r),m(r.message||"Failed to cancel order","error")}finally{Ge(null)}}function ut(t){Je(t)}async function Lt(){if(ne.length!==0){Xe(!0);try{for(const t of ne)await V.cancelOrder(t.id);m("All orders in this market canceled","success"),await Y(!0)}catch(t){console.error("Failed to cancel orders:",t),m(t.message||"Failed to cancel some orders","error")}finally{Xe(!1)}}}function pt(){Ze(!0)}async function zt(){if(Ne.length!==0){tt(!0),Ee(!1);try{for(const t of Ne)await V.cancelOrder(t.id);m(`Canceled ${Ne.length} order(s) for this outcome`,"success"),await Y(!0)}catch(t){console.error("Failed to cancel orders for outcome:",t),m(t?.message||"Failed to cancel some orders","error")}finally{tt(!1)}}}function gt(){Ee(!0)}if(g)return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(kt,{variant:"text",width:"200px",height:"32px"}),e.jsx(kt,{variant:"rectangular",height:"400px",className:"rounded-lg"})]});if(!u)return e.jsx("div",{className:"text-center py-8",children:"Market not found"});const ht=(b||[]).length>0?u?.market_id==="market-total-strokes"?[...b||[]]:[...b||[]].sort((t,r)=>{const n=D?.[t.outcome_id],s=D?.[r.outcome_id],a=n?.bids?.[0],l=n?.asks?.[0],i=s?.bids?.[0],x=s?.asks?.[0],k=a&&l?(a.price+l.price)/2:a?.price||0;return(i&&x?(i.price+x.price)/2:i?.price||0)-k}):[];return e.jsx(qt,{onRefresh:Y,children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(Rt,{toasts:z,removeToast:O}),e.jsxs("nav",{className:"flex items-center gap-2 text-sm text-gray-600 dark:text-gray-400","aria-label":"Breadcrumb",children:[e.jsx(Dt,{to:"/markets",className:"hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded",children:"Markets"}),e.jsx("span",{"aria-hidden":"true",children:"/"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate max-w-[200px] sm:max-w-none","aria-current":"page",children:u.short_name})]}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-4",children:e.jsxs("button",{onClick:()=>T("/markets"),className:"flex items-center gap-2 px-3 sm:px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800 transition touch-manipulation focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Markets"}),e.jsx("span",{className:"sm:hidden",children:"Back"})]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-2 sm:mb-3",children:u.short_name}),u.description&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2 sm:mb-3 max-w-2xl",children:u.description}),mt!=null&&e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 sm:mb-4",children:["Forecast: ",mt.toLocaleString()," strokes"]})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(Ht,{tabs:[{id:"outcomes",label:"Outcomes"},{id:"orders",label:"Orders"},{id:"trades",label:"Trades"},{id:"positions",label:"Positions"}],activeTab:de,onTabChange:t=>Ct(t)})}),e.jsxs("div",{className:"md:hidden",children:[de==="outcomes"&&b&&b.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"w-full min-w-[320px] sm:min-w-[640px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[e.jsx("th",{className:"py-1.5 px-2 sm:py-2 sm:px-3 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:"Team"}),je&&e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Current"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Chance"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"No/Sell"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Yes/Buy"})]})}),e.jsx("tbody",{children:ht.map((t,r)=>{const n=D[t.outcome_id],s=n?.bids?.[0],a=n?.asks?.[0],l=s?s.price:null,i=s&&a?(s.price+a.price)/2:l||0,x=i?Math.round(i/1e4*100):0,k=f===t.outcome_id,y=rt[t.name],w=u?.market_id==="market-individual-gross-champion"?Ae(y?.score_gross):Ae(y?.score_net);return e.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer touch-manipulation transition-colors ${k?"bg-primary-50 dark:bg-primary-900/20 border-l-4 border-l-primary-600 dark:border-l-primary-400":""}`,onClick:()=>$(h=>h===t.outcome_id?"":t.outcome_id),children:[e.jsx("td",{className:"py-1.5 px-2 sm:py-2 sm:px-3",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 w-4 sm:w-6 flex-shrink-0",children:r+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100 truncate",children:u?.market_id==="market-h2h-matchups"?Oe(t.name,!1):e.jsxs(e.Fragment,{children:[t.name,u?.market_id==="market-individual-net-champion"&&X[t.name]!=null&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",X[t.name],")"]}),ve&&q[t.name]&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",q[t.name].year," - ",q[t.name].volatility," strokes)"]})]})}),Me[t.outcome_id]&&(()=>{const h=Me[t.outcome_id],{net_position:S,price_basis:d}=h,P=(h.closed_profit??0)+(h.settled_profit??0);if(S===0){if(P!==0){const A=P>=0;return e.jsxs("span",{className:`inline-block mt-0.5 px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-medium ${A?"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/20":"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20"}`,children:[A?"+":"",ie(P)]})}return null}const R=S>0;return e.jsx("span",{className:`inline-block mt-0.5 px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-bold ${R?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:$e(S,d)})})()]})]})}),je&&e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:w})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsxs("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:[x,"%"]})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:h=>{h.stopPropagation(),dt(t.outcome_id,s?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 active:bg-purple-300 dark:active:bg-purple-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[s?L(s.price):"-",s?.contract_size!=null&&s.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",s.contract_size]})]})})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:h=>{h.stopPropagation(),lt(t.outcome_id,a?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 active:bg-blue-300 dark:active:bg-blue-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[a?L(a.price):"-",a?.contract_size!=null&&a.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",a.contract_size]})]})})})]},t.id)})})]})})})}),de==="orders"&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("h2",{className:"text-base font-bold",children:"Your open orders"}),ne.length>0&&e.jsx("button",{type:"button",onClick:pt,disabled:Se,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 disabled:opacity-50",children:Se?"Canceling…":"Cancel all"})]}),ne.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-8 text-center",children:"No open orders in this market. Place orders from the Outcomes tab."}):e.jsx("div",{className:"space-y-2",children:ne.map(t=>{const r=b?.find(l=>l.outcome_id===t.outcome)?.name??t.outcome,n=t.side===0?"Yes/Buy":"No/Sell",s=t.remaining_size??t.contract_size??0,a=Ke===t.id;return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 border border-gray-200 dark:border-gray-600 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate min-w-0 flex-1",children:r}),e.jsx("span",{className:`flex-shrink-0 px-2 py-0.5 rounded text-xs font-bold ${t.side===0?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:n}),e.jsxs("span",{className:"flex-shrink-0 text-gray-600 dark:text-gray-400",children:[L(t.price)," × ",s]}),e.jsx("button",{type:"button",onClick:()=>ut(t.id),disabled:a,title:"Cancel order","aria-label":"Cancel order",className:"flex-shrink-0 px-2 py-1 text-lg font-bold text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded disabled:opacity-50 touch-manipulation",children:"×"})]},t.id)})})]}),de==="trades"&&e.jsx("div",{className:"mt-4",children:g?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3].map(t=>e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"},t))}):H.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-8 text-center",children:"No recent trades"}):e.jsx("div",{className:"space-y-2",children:H.map(t=>{const r=t.taker_side??t.side,n=r===0,s=r===1,a=n?"Buy":s?"Sell":"—",l=n?"bg-green-600 text-white dark:bg-green-500 dark:text-white":s?"bg-red-600 text-white dark:bg-red-500 dark:text-white":"bg-gray-400 text-white dark:bg-gray-500 dark:text-white";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border border-gray-300 dark:border-gray-600 rounded text-sm",children:[e.jsx("span",{className:`flex-shrink-0 px-3 py-1 rounded-md text-sm font-bold uppercase ${l}`,"aria-label":a!=="—"?a:"Unknown side",children:a}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(t.outcome_name??t.outcome_ticker)&&e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.outcome_name??t.outcome_ticker}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 flex-shrink-0",children:[t.contracts," @ ",re(t.price)]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium flex-shrink-0",children:ft(t.price,t.contracts,t.taker_side??t.side??0)})]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs whitespace-nowrap flex-shrink-0",children:t.create_time?Nt(new Date(t.create_time*1e3),"M/d h:mm a"):"—"})]},t.id)})})}),de==="positions"&&e.jsx("div",{className:"mt-4",children:g?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2].map(t=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded-lg"},t))}):Be.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-8 text-center",children:"No positions"}):e.jsx("div",{className:"space-y-3",children:Be.map(t=>{const r=t.net_position!==0,{marketName:n,outcomeLabel:s}=ot(t),a=t.current_price!==null&&t.current_price!==void 0?t.current_price:null,l=t.net_position*t.price_basis,i=r?xt(t,a):null,x=r&&a!==null?t.net_position<0?(t.price_basis-a)*Math.abs(t.net_position):t.net_position*a-l:null,{riskCents:k,toProfitCents:y}=t.net_position<0?{riskCents:(1e4-t.price_basis)*Math.abs(t.net_position),toProfitCents:t.price_basis*Math.abs(t.net_position)}:{riskCents:t.price_basis*t.net_position,toProfitCents:(1e4-t.price_basis)*t.net_position};return e.jsx(jt,{className:"mb-3",children:e.jsxs(vt,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:n}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2",children:s}),r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${t.net_position>0?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:$e(t.net_position,t.price_basis)}),e.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",e.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:te(k)})," | ","To Profit: ",e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:te(y)})]})]}):(()=>{const w=(t.closed_profit??0)+(t.settled_profit??0);if(w!==0){const h=w>=0;return e.jsxs("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-medium ${h?"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/20":"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20"}`,children:[h?"+":"",ie(w)]})}return e.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700/50",children:"—"})})()]}),r&&e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:i!==null?ze(i):ze(l)}),e.jsx("div",{className:`text-sm sm:text-base font-semibold ${x!==null?x>0?"text-green-600 dark:text-green-400":x<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:x!==null?e.jsxs(e.Fragment,{children:[x>0?"↑":x<0?"↓":""," ",re(Math.abs(x))]}):"—"})]})]}),e.jsxs("div",{className:"mt-3 -mx-2 sm:-mx-5 -mb-4 sm:-mb-5 px-2 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap items-center justify-between gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1",children:[e.jsxs("span",{children:["Closed profit: ",e.jsx("span",{className:`font-medium ${(t.closed_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ie(t.closed_profit??0)})]}),e.jsxs("span",{children:["Settled profit: ",e.jsx("span",{className:`font-medium ${(t.settled_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ie(t.settled_profit??0)})]})]}),e.jsxs("div",{className:"text-right shrink-0",children:["Bid: ",t.best_bid!=null?te(t.best_bid):"—"," | Ask: ",t.best_ask!=null?te(t.best_ask):"—"]})]})]})},t.id)})})})]}),e.jsxs("div",{className:"hidden md:block",children:[b&&b.length>0?e.jsx("div",{children:e.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"w-full min-w-[320px] sm:min-w-[640px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[e.jsx("th",{className:"py-1.5 px-2 sm:py-2 sm:px-3 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:"Team"}),je&&e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Current"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Chance"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"No/Sell"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Yes/Buy"})]})}),e.jsx("tbody",{children:ht.map((t,r)=>{const n=D[t.outcome_id],s=n?.bids?.[0],a=n?.asks?.[0],l=s?s.price:null,i=s&&a?(s.price+a.price)/2:l||0,x=i?Math.round(i/1e4*100):0,k=f===t.outcome_id,y=rt[t.name],w=u?.market_id==="market-individual-gross-champion"?Ae(y?.score_gross):Ae(y?.score_net),h=je?5:4,S=(n?.bids??[]).concat(n?.asks??[]).filter(d=>d.user_id===j?.id&&(d.status==="open"||d.status==="partial"));return e.jsxs(o.Fragment,{children:[e.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer touch-manipulation transition-colors ${k?"bg-primary-50 dark:bg-primary-900/20 border-l-4 border-l-primary-600 dark:border-l-primary-400":""}`,onClick:()=>$(d=>d===t.outcome_id?"":t.outcome_id),children:[e.jsx("td",{className:"py-1.5 px-2 sm:py-2 sm:px-3",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 w-4 sm:w-6 flex-shrink-0",children:r+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100 truncate",children:u?.market_id==="market-h2h-matchups"?Oe(t.name,!1):e.jsxs(e.Fragment,{children:[t.name,u?.market_id==="market-individual-net-champion"&&X[t.name]!=null&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",X[t.name],")"]}),ve&&q[t.name]&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",q[t.name].year," - ",q[t.name].volatility," strokes)"]})]})}),Me[t.outcome_id]&&(()=>{const d=Me[t.outcome_id],{net_position:P,price_basis:R}=d,A=(d.closed_profit??0)+(d.settled_profit??0);if(P===0){if(A!==0){const Q=A>=0;return e.jsxs("span",{className:`inline-block mt-0.5 px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-medium ${Q?"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/20":"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20"}`,children:[Q?"+":"",ie(A)]})}return null}const xe=P>0;return e.jsx("span",{className:`inline-block mt-0.5 px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-bold ${xe?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:$e(P,R)})})()]})]})}),je&&e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:w})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsxs("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:[x,"%"]})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:d=>{d.stopPropagation(),dt(t.outcome_id,s?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 active:bg-purple-300 dark:active:bg-purple-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[s?L(s.price):"-",s?.contract_size!=null&&s.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",s.contract_size]})]})})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:d=>{d.stopPropagation(),lt(t.outcome_id,a?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 active:bg-blue-300 dark:active:bg-blue-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[a?L(a.price):"-",a?.contract_size!=null&&a.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",a.contract_size]})]})})})]}),k&&n&&e.jsx("tr",{className:"bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700",children:e.jsx("td",{colSpan:h,className:"p-0 align-top",children:e.jsxs("div",{className:"px-3 py-3 sm:px-4 sm:py-4 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide",children:["Orderbook — ",t.name,ve&&q[t.name]&&e.jsxs(e.Fragment,{children:[" (",q[t.name].year," - ",q[t.name].volatility," strokes)"]}),fe[t.outcome_id]!=null&&e.jsxs(e.Fragment,{children:[" | Last: ",L(fe[t.outcome_id])]})]}),S.length>0&&e.jsx("button",{type:"button",onClick:d=>{d.stopPropagation(),gt()},disabled:et,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 disabled:opacity-50 p-1 rounded touch-manipulation font-bold text-sm leading-none",title:"Cancel all your orders for this outcome","aria-label":"Cancel all your orders for this outcome",children:"Cancel all my orders"})]}),e.jsx("div",{className:"max-h-[280px] overflow-y-auto rounded-lg border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800",children:e.jsx(Fe,{bids:n.bids,asks:n.asks,userId:j?.id,onPriceClick:(d,P)=>{const R=Math.round(d/100),A=Math.max(1,Math.min(99,R));v(A.toString()),W(P),U("price"),setTimeout(()=>U(null),2e3)},onCancelOrder:async d=>{try{await V.cancelOrder(d),m("Order canceled successfully","success"),await Y(!0)}catch(P){console.error("Failed to cancel order:",P),m(P?.message||"Failed to cancel order","error")}}})})]})})})]},t.id)})})]})})})}):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No outcomes available for this market"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-6 mt-6",children:[e.jsxs("div",{className:"min-w-0 max-md:block md:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3 sm:mb-4",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold",children:["Orderbook",f&&ct&&e.jsxs(e.Fragment,{children:[" — ",ct,ae!=null?` | Last: ${L(ae)}`:""]})]}),f&&M&&Ne.length>0&&e.jsx("button",{type:"button",onClick:gt,disabled:et,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 disabled:opacity-50 p-1.5 rounded touch-manipulation font-bold text-lg leading-none",title:"Cancel all your orders for this outcome","aria-label":"Cancel all your orders for this outcome",children:"×"})]}),f&&M?e.jsx(Fe,{bids:M.bids,asks:M.asks,userId:j?.id,onPriceClick:(t,r)=>{const n=Math.round(t/100),s=Math.max(1,Math.min(99,n));v(s.toString()),W(r),U("price"),setTimeout(()=>U(null),2e3)},onCancelOrder:async t=>{try{await V.cancelOrder(t),m("Order canceled successfully","success"),await Y(!0)}catch(r){console.error("Failed to cancel order:",r),m(r.message||"Failed to cancel order","error")}}}):e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"Select an outcome to view orderbook"})]}),e.jsxs("div",{className:"min-w-0 md:col-span-2",children:[e.jsx("button",{onClick:()=>ce(!0),className:`md:hidden fixed bottom-20 right-4 z-30 text-white rounded-full p-4 shadow-lg touch-manipulation min-h-[56px] min-w-[56px] flex items-center justify-center ${c==="ask"?"bg-purple-600 hover:bg-purple-700 active:bg-purple-800":c==="market_maker"?"bg-primary-600 hover:bg-primary-700 active:bg-primary-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,"aria-label":c==="market_maker"?"Place order":c==="ask"?"Place sell order":"Place buy order",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:c==="market_maker"?"Place Order":c==="ask"?"Place Sell Order":"Place Buy Order"}),e.jsxs("form",{onSubmit:it,className:"space-y-3 sm:space-y-4",children:[b&&b.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Outcome"}),e.jsxs("select",{value:f,onChange:t=>$(t.target.value),required:!0,className:"w-full px-3 py-2.5 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 touch-manipulation",children:[e.jsx("option",{value:"",children:"Select an outcome"}),b.map(t=>e.jsx("option",{value:t.outcome_id,children:u?.market_id==="market-h2h-matchups"?Oe(t.name,!0):u?.market_id==="market-individual-net-champion"&&X[t.name]!=null?`${t.name} (${X[t.name]})`:ve&&q[t.name]?`${t.name} (${q[t.name].year} - ${q[t.name].volatility} strokes)`:t.name??t.ticker},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Side"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>me("ask"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-sm sm:text-base min-h-[44px] touch-manipulation ${c==="ask"?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["No/Sell ",F?L(F.price):""]}),e.jsxs("button",{type:"button",onClick:()=>me("bid"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-sm sm:text-base min-h-[44px] touch-manipulation ${c==="bid"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["Yes/Buy ",I?L(I.price):""]}),j?.view_market_maker&&e.jsx("button",{type:"button",onClick:()=>me("market_maker"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-sm sm:text-base min-h-[44px] touch-manipulation ${c==="market_maker"?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:"Market Maker"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Quantity"}),e.jsx("input",{type:"tel",inputMode:"numeric",min:"1",value:G,onChange:t=>ge(t.target.value),required:!0,className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px]"})]}),c==="market_maker"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Bid price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:_e,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&he(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Ask price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:we,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&be(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Price ($)"}),M&&(F||I||ae!=null)&&e.jsx("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-400",children:e.jsxs("span",{children:["Bid: ",F?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:L(F.price)})," × ",F.contract_size??"—"]}):"—"," | ","Ask: ",I?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:L(I.price)})," × ",I.contract_size??"—"]}):"—",ae!=null&&e.jsxs(e.Fragment,{children:[" "," | "," Last: ",e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:L(ae)})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",step:"1",min:"1",max:"99",value:K,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&(v(r),U(null))},required:!0,className:`w-full pl-8 pr-4 py-3 text-base border rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px] ${Ie==="price"?"border-primary-500 ring-2 ring-primary-200 dark:ring-primary-800":"border-gray-300 dark:border-gray-600"}`})]}),Ie==="price"&&e.jsx("div",{className:"text-xs text-primary-600 dark:text-primary-400 mt-1",children:"Auto-filled from table"})]}),f&&M&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>Te(t=>!t),className:"text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1",children:[oe?"Hide orderbook":"View orderbook",e.jsx("svg",{className:`w-4 h-4 transition-transform ${oe?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),oe&&e.jsx("div",{className:"mt-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800/50 max-h-[200px] overflow-y-auto",children:e.jsx(Fe,{bids:M.bids,asks:M.asks,userId:j?.id,onPriceClick:(t,r)=>{const n=Math.round(t/100),s=Math.max(1,Math.min(99,n));v(s.toString()),W(r)},onCancelOrder:async t=>{try{await V.cancelOrder(t),m("Order canceled successfully","success"),await Y(!0)}catch(r){m(r?.message||"Failed to cancel order","error")}}})})]}),c==="market_maker"?E.qty>0&&E.mmBidPrice>0&&E.mmAskPrice>0&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Bid: $",E.mmBidPrice," × ",E.qty,", Ask: $",E.mmAskPrice," × ",E.qty]})}):K&&G&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Estimated Total:"}),e.jsx("span",{className:"text-lg font-semibold",children:re(E.totalCost*100)})]})}),e.jsx("button",{type:"submit",disabled:Ce,className:`w-full text-white font-medium py-3 px-4 rounded-md disabled:opacity-50 min-h-[44px] text-base touch-manipulation ${c==="ask"?"bg-purple-600 hover:bg-purple-700 active:bg-purple-800":c==="market_maker"?"bg-primary-600 hover:bg-primary-700 active:bg-primary-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,children:Ce?"Placing...":c==="market_maker"?"Place both":c==="ask"?"Place Sell Order":"Place Buy Order"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Your open orders"}),ne.length>0&&e.jsx("button",{type:"button",onClick:pt,disabled:Se,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 disabled:opacity-50",children:Se?"Canceling…":"Cancel all"})]}),ne.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No open orders in this market."}):e.jsx("div",{className:"space-y-2",children:ne.map(t=>{const r=b?.find(l=>l.outcome_id===t.outcome)?.name??t.outcome,n=t.side===0?"Yes/Buy":"No/Sell",s=t.remaining_size??t.contract_size??0,a=Ke===t.id;return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 border border-gray-200 dark:border-gray-600 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate min-w-0 flex-1",children:r}),e.jsx("span",{className:`flex-shrink-0 px-2 py-0.5 rounded text-xs font-bold ${t.side===0?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:n}),e.jsxs("span",{className:"flex-shrink-0 text-gray-600 dark:text-gray-400",children:[L(t.price)," × ",s]}),e.jsx("button",{type:"button",onClick:()=>ut(t.id),disabled:a,title:"Cancel order","aria-label":"Cancel order",className:"flex-shrink-0 px-2 py-1 text-lg font-bold text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded disabled:opacity-50",children:"×"})]},t.id)})})]}),Be.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"Your Positions"}),g?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2].map(t=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded-lg"},t))}):e.jsx("div",{className:"space-y-3",children:Be.map(t=>{const r=t.net_position!==0,{marketName:n,outcomeLabel:s}=ot(t),a=t.current_price!==null&&t.current_price!==void 0?t.current_price:null,l=t.net_position*t.price_basis,i=r?xt(t,a):null,x=r&&a!==null?t.net_position<0?(t.price_basis-a)*Math.abs(t.net_position):t.net_position*a-l:null,{riskCents:k,toProfitCents:y}=t.net_position<0?{riskCents:(1e4-t.price_basis)*Math.abs(t.net_position),toProfitCents:t.price_basis*Math.abs(t.net_position)}:{riskCents:t.price_basis*t.net_position,toProfitCents:(1e4-t.price_basis)*t.net_position};return e.jsx(jt,{className:"mb-3",children:e.jsxs(vt,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:n}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2",children:s}),r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${t.net_position>0?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:$e(t.net_position,t.price_basis)}),e.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",e.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:te(k)})," | ","To Profit: ",e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:te(y)})]})]}):(()=>{const w=(t.closed_profit??0)+(t.settled_profit??0);if(w!==0){const h=w>=0;return e.jsxs("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-medium ${h?"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/20":"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20"}`,children:[h?"+":"",ie(w)]})}return e.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700/50",children:"—"})})()]}),r&&e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:i!==null?ze(i):ze(l)}),e.jsx("div",{className:`text-sm sm:text-base font-semibold ${x!==null?x>0?"text-green-600 dark:text-green-400":x<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:x!==null?e.jsxs(e.Fragment,{children:[x>0?"↑":x<0?"↓":""," ",re(Math.abs(x))]}):"—"})]})]}),e.jsxs("div",{className:"mt-3 -mx-2 sm:-mx-5 -mb-4 sm:-mb-5 px-2 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap items-center justify-between gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1",children:[e.jsxs("span",{children:["Closed profit: ",e.jsx("span",{className:`font-medium ${(t.closed_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ie(t.closed_profit??0)})]}),e.jsxs("span",{children:["Settled profit: ",e.jsx("span",{className:`font-medium ${(t.settled_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ie(t.settled_profit??0)})]})]}),e.jsxs("div",{className:"text-right shrink-0",children:["Bid: ",t.best_bid!=null?te(t.best_bid):"—"," | Ask: ",t.best_ask!=null?te(t.best_ask):"—"]})]})]})},t.id)})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"Recent Trades"}),g?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3].map(t=>e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"},t))}):!H||H.length===0?e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No trades yet"}):e.jsx("div",{className:"space-y-2",children:H.map(t=>{const r=t.taker_side??t.side,n=r===0,s=r===1,a=n?"Buy":s?"Sell":"—",l=n?"bg-green-600 text-white dark:bg-green-500 dark:text-white":s?"bg-red-600 text-white dark:bg-red-500 dark:text-white":"bg-gray-400 text-white dark:bg-gray-500 dark:text-white";return e.jsxs("div",{className:"flex items-center gap-3 p-2 sm:p-3 border border-gray-300 dark:border-gray-600 rounded text-xs sm:text-sm",children:[e.jsx("span",{className:`flex-shrink-0 px-3 py-1 rounded-md text-xs sm:text-sm font-bold uppercase ${l}`,"aria-label":a!=="—"?a:"Unknown side",children:a}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(t.outcome_name??t.outcome_ticker)&&e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.outcome_name??t.outcome_ticker}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 flex-shrink-0",children:[t.contracts," @ ",re(t.price)]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium flex-shrink-0",children:ft(t.price,t.contracts,t.taker_side??t.side??0)})]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs whitespace-nowrap flex-shrink-0",children:t.create_time?Nt(new Date(t.create_time*1e3),"M/d h:mm a"):"—"})]},t.id)})})]})]})]}),e.jsx(Vt,{isOpen:ye,onClose:()=>{ce(!1),v(""),ge(""),he(""),be(""),Te(!1)},title:c==="market_maker"?"Place Order":c==="ask"?"Place Sell Order":"Place Buy Order",children:e.jsxs("form",{onSubmit:t=>{it(t),ce(!1)},className:"space-y-4",children:[b&&b.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Outcome"}),e.jsxs("select",{value:f,onChange:t=>$(t.target.value),required:!0,className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 touch-manipulation min-h-[44px]",children:[e.jsx("option",{value:"",children:"Select an outcome"}),b.map(t=>e.jsx("option",{value:t.outcome_id,children:u?.market_id==="market-h2h-matchups"?Oe(t.name,!0):u?.market_id==="market-individual-net-champion"&&X[t.name]!=null?`${t.name} (${X[t.name]})`:ve&&q[t.name]?`${t.name} (${q[t.name].year} - ${q[t.name].volatility} strokes)`:t.name??t.ticker},t.outcome_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Side"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>me("ask"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-base min-h-[44px] touch-manipulation ${c==="ask"?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["No/Sell ",F?L(F.price):""]}),e.jsxs("button",{type:"button",onClick:()=>me("bid"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-base min-h-[44px] touch-manipulation ${c==="bid"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["Yes/Buy ",I?L(I.price):""]}),j?.view_market_maker&&e.jsx("button",{type:"button",onClick:()=>me("market_maker"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-base min-h-[44px] touch-manipulation ${c==="market_maker"?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:"Market Maker"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Quantity"}),e.jsx("input",{ref:Ye,type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:"1",value:G,onChange:t=>ge(t.target.value),required:!0,className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px]",placeholder:"Enter quantity"})]}),c==="market_maker"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Bid price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:_e,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&he(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Ask price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:we,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&be(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Price ($)"}),M&&(F||I||ae!=null)&&e.jsx("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-400",children:e.jsxs("span",{children:["Bid: ",F?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:L(F.price)})," × ",F.contract_size??"—"]}):"—"," | ","Ask: ",I?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:L(I.price)})," × ",I.contract_size??"—"]}):"—",ae!=null&&e.jsxs(e.Fragment,{children:[" "," | "," Last: ",e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:L(ae)})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",step:"1",min:"1",max:"99",value:K,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&(v(r),U(null))},required:!0,className:`w-full pl-8 pr-4 py-3 text-base border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px] ${Ie==="price"?"border-primary-500 ring-2 ring-primary-500":"border-gray-300 dark:border-gray-600"}`,placeholder:"1-99"})]})]}),f&&M&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>Te(t=>!t),className:"text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1",children:[oe?"Hide orderbook":"View orderbook",e.jsx("svg",{className:`w-4 h-4 transition-transform ${oe?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),oe&&e.jsx("div",{className:"mt-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800/50 max-h-[200px] overflow-y-auto",children:e.jsx(Fe,{bids:M.bids,asks:M.asks,userId:j?.id,onPriceClick:(t,r)=>{const n=Math.round(t/100),s=Math.max(1,Math.min(99,n));v(s.toString()),W(r)},onCancelOrder:async t=>{try{await V.cancelOrder(t),m("Order canceled successfully","success"),await Y(!0)}catch(r){m(r?.message||"Failed to cancel order","error")}}})})]}),c==="market_maker"?E.qty>0&&E.mmBidPrice>0&&E.mmAskPrice>0&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Bid: $",E.mmBidPrice," × ",E.qty,", Ask: $",E.mmAskPrice," × ",E.qty]})}):K&&G&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Estimated Total:"}),e.jsx("span",{className:"text-lg font-semibold",children:re(E.totalCost*100)})]})}),e.jsx("button",{type:"submit",disabled:Ce,className:`w-full text-white font-medium py-3 px-4 rounded-md disabled:opacity-50 min-h-[44px] text-base touch-manipulation ${c==="ask"?"bg-purple-600 hover:bg-purple-700 active:bg-purple-800":c==="market_maker"?"bg-primary-600 hover:bg-primary-700 active:bg-primary-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,children:Ce?"Placing...":c==="market_maker"?"Place both":c==="ask"?"Place Sell Order":"Place Buy Order"})]})}),e.jsx(Ue,{isOpen:De!=null,onClose:()=>Je(null),onConfirm:()=>{De!=null&&At(De)},title:"Cancel order",message:"Are you sure you want to cancel this order?",confirmLabel:"Cancel order",cancelLabel:"Keep",variant:"danger"}),e.jsx(Ue,{isOpen:Pt,onClose:()=>Ze(!1),onConfirm:Lt,title:"Cancel all orders",message:"Are you sure you want to cancel all open orders in this market?",confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"}),e.jsx(Ue,{isOpen:St,onClose:()=>Ee(!1),onConfirm:zt,title:"Cancel all orders for this outcome",message:`Cancel all ${Ne.length} open order(s) for this outcome?`,confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"}),e.jsx("div",{className:"flex justify-center pt-4 pb-2 md:pt-6 md:pb-4",children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs sm:text-sm font-medium bg-gray-100 dark:bg-gray-700/80 text-gray-600 dark:text-gray-400 border border-gray-200 dark:border-gray-600",children:[e.jsx("span",{children:"Trading volume"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-200",children:["$",Bt.volume_dollars.toLocaleString()]})]})}),e.jsx("div",{className:"md:hidden h-24"})]})})}export{er as MarketDetail};
