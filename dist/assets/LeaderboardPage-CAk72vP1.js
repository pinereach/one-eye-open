import{u as pe,r as x,j as e,N as ye,b as ue}from"./index--VBg9n5S.js";import{C as H,b as K}from"./Card-CiYZHrUK.js";import{P as he}from"./PullToRefresh-CwRRfJnu.js";import{g as be,M as Y}from"./marketTypes-2i-psQO1.js";function n(k,o=!1){const z=k/100,v=Math.abs(z).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return o?k>=0?`+$${v}`:`-$${v}`:`$${v}`}const fe="shares_traded",ke="desc";function Se(){const{user:k}=pe(),[o,z]=x.useState([]),[m,v]=x.useState(0),[h,J]=x.useState(0),[y,Q]=x.useState(0),[b,V]=x.useState(0),[f,X]=x.useState({}),[P,Z]=x.useState([]),[B,w]=x.useState(0),[O,ee]=x.useState(0),[S,te]=x.useState({}),[C,re]=x.useState({}),[L,se]=x.useState([]),[M,ae]=x.useState([]),[de,E]=x.useState(!0),[A,D]=x.useState(null),[c,ne]=x.useState(fe),[i,F]=x.useState(ke),[U,le]=x.useState(!1),[R,oe]=x.useState({}),[j,I]=x.useState(null),T=x.useMemo(()=>{if(o.length===0)return[];const t=c,a=i==="asc"?1:-1;return[...o].sort((s,r)=>{let d=0;if(t==="username")d=(s.username??"").localeCompare(r.username??"");else{const l=t==="portfolio_value_cents"?s.portfolio_value_cents:t==="closed_profit_cents"?s.closed_profit_cents:t==="settled_profit_cents"?s.settled_profit_cents:t==="trade_count"?s.trade_count:t==="open_orders_count"?s.open_orders_count:s.shares_traded,u=t==="portfolio_value_cents"?r.portfolio_value_cents:t==="closed_profit_cents"?r.closed_profit_cents:t==="settled_profit_cents"?r.settled_profit_cents:t==="trade_count"?r.trade_count:t==="open_orders_count"?r.open_orders_count:r.shares_traded;d=l-u}return d*a})},[o,c,i]),G=x.useMemo(()=>{const t=o.filter(l=>l.settled_profit_cents>0).map(l=>({username:l.username,user_id:l.user_id,cents:l.settled_profit_cents})).sort((l,u)=>u.cents-l.cents),a=o.filter(l=>l.settled_profit_cents<0).map(l=>({username:l.username,user_id:l.user_id,cents:-l.settled_profit_cents})).sort((l,u)=>u.cents-l.cents),s=[];let r=0,d=0;for(;r<t.length&&d<a.length;){const l=Math.min(t[r].cents,a[d].cents);l>0&&s.push({from:a[d].username,fromId:a[d].user_id,to:t[r].username,toId:t[r].user_id,cents:l}),t[r].cents-=l,a[d].cents-=l,t[r].cents===0&&(r+=1),a[d].cents===0&&(d+=1)}return s},[o]);function _(t){c===t?F(a=>a==="asc"?"desc":"asc"):(ne(t),F(t==="username"?"asc":"desc"))}function xe(t){const a=R[String(t)];if(!a)return[];const s=Object.keys(a);return[...Y.filter(d=>s.includes(d)),...s.filter(d=>!Y.includes(d))].filter(d=>{const l=a[d];return l&&(l.trade_count!==0||l.open_orders_count!==0||l.shares_traded!==0||l.portfolio_value_cents!==0||l.closed_profit_cents!==0||l.settled_profit_cents!==0)})}function q(t){const a=xe(t);if(a.length===0)return e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"No activity by market type."});const s=R[String(t)];return e.jsx("div",{className:"overflow-x-auto -mx-2",children:e.jsxs("table",{className:"w-full min-w-[360px] border-collapse text-xs",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600 text-gray-600 dark:text-gray-400",children:[e.jsx("th",{className:"py-1.5 px-2 text-left font-medium",children:"Market type"}),e.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Trades"}),e.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Open"}),e.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Shares"}),e.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Closed"}),e.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Settled"}),e.jsx("th",{className:"py-1.5 px-2 text-right font-medium",children:"Portfolio"})]})}),e.jsx("tbody",{children:a.map(r=>{const d=s[r];return d?e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700",children:[e.jsx("td",{className:"py-1 px-2 text-gray-700 dark:text-gray-300",children:be(r)}),e.jsx("td",{className:"py-1 px-2 text-right",children:d.trade_count}),e.jsx("td",{className:"py-1 px-2 text-right",children:d.open_orders_count}),e.jsx("td",{className:"py-1 px-2 text-right",children:d.shares_traded}),e.jsx("td",{className:`py-1 px-2 text-right ${d.closed_profit_cents>0?"text-green-600 dark:text-green-400":d.closed_profit_cents<0?"text-red-600 dark:text-red-400":""}`,children:n(d.closed_profit_cents,!0)}),e.jsx("td",{className:`py-1 px-2 text-right ${d.settled_profit_cents>0?"text-green-600 dark:text-green-400":d.settled_profit_cents<0?"text-red-600 dark:text-red-400":""}`,children:n(d.settled_profit_cents,!0)}),e.jsx("td",{className:`py-1 px-2 text-right ${d.portfolio_value_cents>0?"text-green-600 dark:text-green-400":d.portfolio_value_cents<0?"text-red-600 dark:text-red-400":""}`,children:n(d.portfolio_value_cents,!0)})]},r):null})})]})})}async function W(){E(!0),D(null);try{const t=await ue.adminGetLeaderboard(),{leaderboard:a,stats_by_market_type:s,unattributed_portfolio_value_cents:r,unattributed_closed_profit_cents:d,unattributed_settled_profit_cents:l,system_total_portfolio_value_cents:u,pnl_by_outcome:N,position_contributions:$,system_total_closed_profit_cents:g,system_total_settled_profit_cents:p,closed_profit_by_outcome:ce,settled_profit_by_outcome:ie,closed_profit_contributions:me,settled_profit_contributions:ge}=t;z(a??[]),oe(s??{}),v(r??0),J(d??0),Q(l??0),V(u??0),X(N??{}),Z($??[]),w(g??0),ee(p??0),te(ce??{}),re(ie??{}),se(me??[]),ae(ge??[])}catch(t){console.error("Failed to load leaderboard:",t),D(t instanceof Error?t.message:"Failed to load leaderboard")}finally{E(!1)}}return x.useEffect(()=>{k?.admin&&W()},[k?.admin]),k&&!k.admin?e.jsx(ye,{to:"/markets",replace:!0}):de&&o.length===0?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Leaderboard"}),e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-14 bg-gray-200 dark:bg-gray-700 rounded-lg"},t))})]}):A?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Leaderboard"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:A})]}):e.jsx(he,{onRefresh:W,children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Leaderboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Per-user stats: trades, open orders, shares traded, closed profit (realized P&L), settled profit, portfolio value (unrealized P&L only). Portfolio value is zero-sum (system total should be $0). Closed and settled profit are separate."}),o.length>0&&e.jsx(H,{children:e.jsxs(K,{className:"p-4",children:[e.jsx("h2",{className:"text-base font-bold text-gray-900 dark:text-gray-100 mb-1",children:"Settle up (settled P&L)"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-3",children:"Fewest payments so everyone is paid. Based on each person's settled profit (positive = owed, negative = owes)."}),G.length===0?e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Everyone is square — no payments needed."}):e.jsx("ul",{className:"space-y-2","aria-label":"Settle-up payments",children:G.map((t,a)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.from}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"pays"}),e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100",children:t.to}),e.jsx("span",{className:"font-semibold text-green-600 dark:text-green-400 ml-1",children:n(t.cents,!1)})]},`${t.fromId}-${t.toId}-${a}`))}),y!==0&&e.jsxs("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-3",children:["Note: Unattributed settled profit is ",n(y,!0)," — not included in the list above."]})]})}),o.length>0&&e.jsxs("div",{className:`rounded-lg border ${b===0?"border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/80":"border-amber-400 dark:border-amber-500 bg-amber-50 dark:bg-amber-900/20"}`,children:[e.jsxs("button",{type:"button",onClick:()=>le(t=>!t),className:"w-full flex items-center justify-between gap-2 p-4 text-left hover:bg-gray-100/80 dark:hover:bg-gray-700/50 rounded-lg transition-colors","aria-expanded":U,children:[e.jsx("span",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide",children:"Debug checks"}),e.jsx("svg",{className:`w-4 h-4 text-gray-500 dark:text-gray-400 flex-shrink-0 transition-transform ${U?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),U&&e.jsxs("div",{className:"px-4 pb-4 pt-0",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Unrealized P&L (portfolio value)"}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-sm",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"System total (sum of all position unrealized P&L):"})," ",e.jsx("span",{className:`font-semibold ${b===0?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:n(b,!0)}),b!==0&&e.jsx("span",{className:"ml-2 text-amber-600 dark:text-amber-400 text-xs",children:"(should be $0 — check trade/position logic)"})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Users + Unattributed (unrealized):"})," ",e.jsx("span",{className:`font-semibold ${o.reduce((t,a)=>t+a.portfolio_value_cents,0)+m===b?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:n(o.reduce((t,a)=>t+a.portfolio_value_cents,0)+m,!0)}),o.reduce((t,a)=>t+a.portfolio_value_cents,0)+m!==b&&e.jsx("span",{className:"ml-2 text-amber-600 dark:text-amber-400 text-xs",children:"(should equal system total)"})]})]}),b!==0&&(Object.keys(f).length>0||P.length>0)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Where the unrealized imbalance comes from"}),Object.keys(f).length>0&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Unrealized P&L by outcome (should be $0 per outcome in zero-sum):"}),e.jsx("ul",{className:"mt-1 space-y-0.5 text-sm font-mono",children:Object.entries(f).filter(([,t])=>t!==0).sort((t,a)=>Math.abs(a[1])-Math.abs(t[1])).map(([t,a])=>e.jsxs("li",{className:a>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:[t,": ",n(a,!0)]},t))})]}),P.length>0&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Top position contributions (user_id, outcome, unrealized P&L):"}),e.jsx("ul",{className:"mt-1 space-y-0.5 text-sm font-mono max-h-40 overflow-y-auto",children:P.slice(0,20).map((t,a)=>e.jsxs("li",{className:t.contribution_cents>0?"text-green-600 dark:text-green-400":t.contribution_cents<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400",children:["user ",t.user_id??"null"," · ",t.outcome,": ",n(t.contribution_cents,!0)]},a))})]})]}),(Object.keys(f).length>0||Object.keys(S).length>0||Object.keys(C).length>0)&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Debug by outcome"}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2",children:"Unrealized should be $0 per outcome (zero-sum). Closed/settled can be non-zero."}),e.jsx("div",{className:"overflow-x-auto max-h-64 overflow-y-auto rounded border border-gray-200 dark:border-gray-600",children:e.jsxs("table",{className:"w-full min-w-[400px] border-collapse text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-100 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-600",children:e.jsxs("tr",{children:[e.jsx("th",{className:"py-1.5 px-2 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:"Outcome"}),e.jsx("th",{className:"py-1.5 px-2 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:"Unrealized"}),e.jsx("th",{className:"py-1.5 px-2 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:"Closed"}),e.jsx("th",{className:"py-1.5 px-2 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:"Settled"})]})}),e.jsx("tbody",{children:(()=>{const t=new Set([...Object.keys(f),...Object.keys(S),...Object.keys(C)]);return Array.from(t).filter(s=>s!=="__closed_profit_offset").sort((s,r)=>{const d=f[s]??0,l=f[r]??0;return Math.abs(l)-Math.abs(d)}).map(s=>{const r=f[s]??0,d=S[s]??0,l=C[s]??0,u=r!==0;return e.jsxs("tr",{className:`border-b border-gray-100 dark:border-gray-700 ${u?"bg-amber-50/50 dark:bg-amber-900/10":""}`,children:[e.jsx("td",{className:"py-1 px-2 font-mono text-xs text-gray-800 dark:text-gray-200 truncate max-w-[200px]",title:s,children:s}),e.jsx("td",{className:`py-1 px-2 text-right font-mono ${r>0?"text-green-600 dark:text-green-400":r<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:n(r,!0)}),e.jsx("td",{className:`py-1 px-2 text-right font-mono ${d>0?"text-green-600 dark:text-green-400":d<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:n(d,!0)}),e.jsx("td",{className:`py-1 px-2 text-right font-mono ${l>0?"text-green-600 dark:text-green-400":l<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:n(l,!0)})]},s)})})()})]})})]}),e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Closed / settled profit"}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-sm mb-2",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"System total closed:"})," ",e.jsx("span",{className:"font-semibold text-gray-700 dark:text-gray-300",children:n(B,!0)}),e.jsx("span",{className:"ml-2 text-gray-500 dark:text-gray-400 text-xs",children:"(per-user realized P&L; total may be non-zero)"})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"System total settled:"})," ",e.jsx("span",{className:`font-semibold ${O===0?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:n(O,!0)}),O!==0&&e.jsx("span",{className:"ml-2 text-amber-600 dark:text-amber-400 text-xs",children:"(should be $0)"})]})]}),B!==0&&(Object.keys(S).length>0||L.length>0)&&e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Closed by outcome (non-zero):"}),e.jsx("ul",{className:"mt-1 space-y-0.5 text-sm font-mono",children:Object.entries(S).filter(([,t])=>t!==0).sort((t,a)=>Math.abs(a[1])-Math.abs(t[1])).map(([t,a])=>e.jsxs("li",{className:a>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:[t,": ",n(a,!0)]},t))}),L.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 block mt-1",children:"Top closed profit contributions:"}),e.jsx("ul",{className:"mt-0.5 space-y-0.5 text-sm font-mono max-h-32 overflow-y-auto",children:L.slice(0,15).map((t,a)=>e.jsxs("li",{className:t.closed_profit_cents>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:["user ",t.user_id??"null"," · ",t.outcome,": ",n(t.closed_profit_cents,!0)]},a))})]})]}),O!==0&&(Object.keys(C).length>0||M.length>0)&&e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Settled by outcome (non-zero):"}),e.jsx("ul",{className:"mt-1 space-y-0.5 text-sm font-mono",children:Object.entries(C).filter(([,t])=>t!==0).sort((t,a)=>Math.abs(a[1])-Math.abs(t[1])).map(([t,a])=>e.jsxs("li",{className:a>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:[t,": ",n(a,!0)]},t))}),M.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-xs text-gray-600 dark:text-gray-400 block mt-1",children:"Top settled profit contributions:"}),e.jsx("ul",{className:"mt-0.5 space-y-0.5 text-sm font-mono max-h-32 overflow-y-auto",children:M.slice(0,15).map((t,a)=>e.jsxs("li",{className:t.settled_profit_cents>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400",children:["user ",t.user_id??"null"," · ",t.outcome,": ",n(t.settled_profit_cents,!0)]},a))})]})]})]})]})]}),e.jsx("div",{className:"md:hidden space-y-3",children:T.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 py-4",children:"No users."}):T.map(t=>e.jsx(H,{children:e.jsxs(K,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100",children:t.username}),e.jsx("button",{type:"button",onClick:()=>I(a=>a===t.user_id?null:t.user_id),className:"text-xs font-medium text-primary-600 dark:text-primary-400 hover:underline","aria-expanded":j===t.user_id,children:j===t.user_id?"Hide by market type":"By market type"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Trades"}),e.jsx("span",{className:"text-right font-medium",children:t.trade_count}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Open orders"}),e.jsx("span",{className:"text-right font-medium",children:t.open_orders_count}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Shares traded"}),e.jsx("span",{className:"text-right font-medium",children:t.shares_traded}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Closed profit"}),e.jsx("span",{className:`text-right font-medium ${t.closed_profit_cents>0?"text-green-600 dark:text-green-400":t.closed_profit_cents<0?"text-red-600 dark:text-red-400":""}`,children:n(t.closed_profit_cents,!0)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Settled profit"}),e.jsx("span",{className:`text-right font-medium ${t.settled_profit_cents>0?"text-green-600 dark:text-green-400":t.settled_profit_cents<0?"text-red-600 dark:text-red-400":""}`,children:n(t.settled_profit_cents,!0)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Unrealized Gain"}),e.jsx("span",{className:`text-right font-medium ${t.portfolio_value_cents>0?"text-green-600 dark:text-green-400":t.portfolio_value_cents<0?"text-red-600 dark:text-red-400":""}`,children:n(t.portfolio_value_cents,!0)})]}),j===t.user_id&&e.jsxs("div",{className:"mt-4 pt-3 border-t border-gray-200 dark:border-gray-600",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Stats by market type"}),q(t.user_id)]})]})},t.user_id))}),o.length>0&&(()=>{const t=o.reduce((s,r)=>s+r.portfolio_value_cents,0),a=t+m;return e.jsxs("div",{className:"md:hidden rounded-lg border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/80 p-4",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Summary (all participants)"}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-sm",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Trades:"})," ",e.jsx("span",{className:"font-semibold",children:o.reduce((s,r)=>s+r.trade_count,0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Open orders:"})," ",e.jsx("span",{className:"font-semibold",children:o.reduce((s,r)=>s+r.open_orders_count,0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Shares traded:"})," ",e.jsx("span",{className:"font-semibold",children:o.reduce((s,r)=>s+r.shares_traded,0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Closed profit (users):"})," ",e.jsx("span",{className:`font-semibold ${o.reduce((s,r)=>s+r.closed_profit_cents,0)>0?"text-green-600 dark:text-green-400":o.reduce((s,r)=>s+r.closed_profit_cents,0)<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:n(o.reduce((s,r)=>s+r.closed_profit_cents,0),!0)})]}),h!==0&&e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Closed profit (system):"})," ",e.jsx("span",{className:`font-semibold ${h>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:n(h,!0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Closed profit total:"})," ",e.jsx("span",{className:`font-semibold ${o.reduce((s,r)=>s+r.closed_profit_cents,0)+h>0?"text-green-600 dark:text-green-400":o.reduce((s,r)=>s+r.closed_profit_cents,0)+h<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:n(o.reduce((s,r)=>s+r.closed_profit_cents,0)+h,!0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Settled profit (users):"})," ",e.jsx("span",{className:`font-semibold ${o.reduce((s,r)=>s+r.settled_profit_cents,0)>0?"text-green-600 dark:text-green-400":o.reduce((s,r)=>s+r.settled_profit_cents,0)<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:n(o.reduce((s,r)=>s+r.settled_profit_cents,0),!0)})]}),y!==0&&e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Settled profit (system):"})," ",e.jsx("span",{className:`font-semibold ${y>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:n(y,!0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Settled profit total:"})," ",e.jsx("span",{className:`font-semibold ${o.reduce((s,r)=>s+r.settled_profit_cents,0)+y===0?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:n(o.reduce((s,r)=>s+r.settled_profit_cents,0)+y,!0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Portfolio (users, unrealized):"})," ",e.jsx("span",{className:`font-semibold ${t>0?"text-green-600 dark:text-green-400":t<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:n(t,!0)})]}),m!==0&&e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Unattributed (unrealized):"})," ",e.jsx("span",{className:`font-semibold ${m>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:n(m,!0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Total (users + unattributed, unrealized):"})," ",e.jsx("span",{className:`font-semibold ${a===0?"text-gray-700 dark:text-gray-300":a>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:n(a,!0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"System total (unrealized; should be $0):"})," ",e.jsx("span",{className:`font-semibold ${b===0?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:n(b,!0)})]})]})]})})(),e.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-600",children:e.jsxs("table",{className:"w-full min-w-[700px] border-collapse","aria-describedby":"leaderboard-caption",children:[e.jsx("caption",{id:"leaderboard-caption",className:"sr-only",children:"Admin leaderboard: per-user stats including trades, open orders, shares traded, closed profit, settled profit, and portfolio value"}),e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:[e.jsx("th",{className:"py-3 px-4 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>_("username"),className:"flex items-center gap-1 hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":c==="username"?i==="asc"?"ascending":"descending":void 0,children:["User ",c==="username"&&(i==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>_("trade_count"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":c==="trade_count"?i==="asc"?"ascending":"descending":void 0,children:["Trades ",c==="trade_count"&&(i==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>_("open_orders_count"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":c==="open_orders_count"?i==="asc"?"ascending":"descending":void 0,children:["Open orders ",c==="open_orders_count"&&(i==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>_("shares_traded"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":c==="shares_traded"?i==="asc"?"ascending":"descending":void 0,children:["Shares traded ",c==="shares_traded"&&(i==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>_("closed_profit_cents"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":c==="closed_profit_cents"?i==="asc"?"ascending":"descending":void 0,children:["Closed profit ",c==="closed_profit_cents"&&(i==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>_("settled_profit_cents"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":c==="settled_profit_cents"?i==="asc"?"ascending":"descending":void 0,children:["Settled profit ",c==="settled_profit_cents"&&(i==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>_("portfolio_value_cents"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":c==="portfolio_value_cents"?i==="asc"?"ascending":"descending":void 0,children:["Unrealized Gain ",c==="portfolio_value_cents"&&(i==="asc"?"↑":"↓")]})})]})}),e.jsx("tbody",{children:T.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"py-8 text-center text-gray-500 dark:text-gray-400",children:"No users."})}):T.flatMap(t=>[e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-gray-900 dark:text-gray-100",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:t.username}),e.jsx("button",{type:"button",onClick:()=>I(a=>a===t.user_id?null:t.user_id),className:"text-xs font-medium text-primary-600 dark:text-primary-400 hover:underline","aria-expanded":j===t.user_id,children:j===t.user_id?"− by market type":"+ by market type"})]})}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.trade_count}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.open_orders_count}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.shares_traded}),e.jsx("td",{className:`py-3 px-4 text-right font-medium ${t.closed_profit_cents>0?"text-green-600 dark:text-green-400":t.closed_profit_cents<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:n(t.closed_profit_cents,!0)}),e.jsx("td",{className:`py-3 px-4 text-right font-medium ${t.settled_profit_cents>0?"text-green-600 dark:text-green-400":t.settled_profit_cents<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:n(t.settled_profit_cents,!0)}),e.jsx("td",{className:`py-3 px-4 text-right font-medium ${t.portfolio_value_cents>0?"text-green-600 dark:text-green-400":t.portfolio_value_cents<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:n(t.portfolio_value_cents,!0)})]},t.user_id),...j===t.user_id?[e.jsx("tr",{className:"border-b border-gray-100 dark:border-gray-700 bg-gray-50/80 dark:bg-gray-800/50",children:e.jsxs("td",{colSpan:7,className:"py-3 px-4",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Stats by market type"}),q(t.user_id)]})},`${t.user_id}-by-type`)]:[]])}),o.length>0&&(()=>{const t=o.reduce((g,p)=>g+p.trade_count,0),a=o.reduce((g,p)=>g+p.open_orders_count,0),s=o.reduce((g,p)=>g+p.shares_traded,0),r=o.reduce((g,p)=>g+p.closed_profit_cents,0),d=o.reduce((g,p)=>g+p.settled_profit_cents,0),l=r+h,u=d+y,N=o.reduce((g,p)=>g+p.portfolio_value_cents,0),$=N+m;return e.jsxs("tfoot",{children:[e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-500 bg-gray-100 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-gray-100",children:"All participants"}),e.jsx("td",{className:"py-3 px-4 text-right",children:t}),e.jsx("td",{className:"py-3 px-4 text-right",children:a}),e.jsx("td",{className:"py-3 px-4 text-right",children:s}),e.jsx("td",{className:`py-3 px-4 text-right ${r>0?"text-green-600 dark:text-green-400":r<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:n(r,!0)}),e.jsx("td",{className:`py-3 px-4 text-right ${d>0?"text-green-600 dark:text-green-400":d<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:n(d,!0)}),e.jsx("td",{className:`py-3 px-4 text-right ${N>0?"text-green-600 dark:text-green-400":N<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:n(N,!0)})]}),(h!==0||y!==0||m!==0)&&e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/80 font-medium",children:[e.jsx("td",{className:"py-2 px-4 text-gray-600 dark:text-gray-400 text-xs",children:"System (no user_id or deleted user)"}),e.jsx("td",{className:"py-2 px-4 text-right",children:"—"}),e.jsx("td",{className:"py-2 px-4 text-right",children:"—"}),e.jsx("td",{className:"py-2 px-4 text-right",children:"—"}),e.jsx("td",{className:`py-2 px-4 text-right ${h>0?"text-green-600 dark:text-green-400":h<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:n(h,!0)}),e.jsx("td",{className:`py-2 px-4 text-right ${y>0?"text-green-600 dark:text-green-400":y<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:n(y,!0)}),e.jsx("td",{className:`py-2 px-4 text-right ${m>0?"text-green-600 dark:text-green-400":m<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:n(m,!0)})]}),e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/80 font-medium",children:[e.jsx("td",{className:"py-2 px-4 text-gray-600 dark:text-gray-400 text-xs",children:"Closed / settled total (closed may be non-zero)"}),e.jsx("td",{colSpan:3,className:"py-2 px-4"}),e.jsx("td",{className:`py-2 px-4 text-right font-semibold ${l>0?"text-green-600 dark:text-green-400":l<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:n(l,!0)}),e.jsx("td",{className:`py-2 px-4 text-right font-semibold ${u===0?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:n(u,!0)}),e.jsx("td",{className:"py-2 px-4"})]}),e.jsxs("tr",{className:"border-t border-gray-300 dark:border-gray-500 bg-gray-100 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-gray-100",children:"Total (users + unattributed, unrealized)"}),e.jsx("td",{colSpan:5,className:"py-3 px-4"}),e.jsx("td",{className:`py-3 px-4 text-right ${$===0?"text-gray-700 dark:text-gray-300":$>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:n($,!0)})]}),e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/80 font-medium",children:[e.jsx("td",{className:"py-2 px-4 text-gray-600 dark:text-gray-400 text-xs",children:"System total (unrealized; all positions; should be $0)"}),e.jsx("td",{colSpan:5,className:"py-2 px-4"}),e.jsx("td",{className:`py-2 px-4 text-right font-semibold ${b===0?"text-green-600 dark:text-green-400":"text-amber-600 dark:text-amber-400"}`,children:n(b,!0)})]})]})})()]})})]})})}export{Se as LeaderboardPage};
