import{u as _,r as s,b as U,j as e,N as C,S as g}from"./index-Am2fm45O.js";import{g as u,a as P}from"./format-BckxrTVz.js";import{f as m}from"./index-BAgxTVAR.js";function L(){const{user:c}=_(),[l,h]=s.useState([]),[f,p]=s.useState(!0),[n,b]=s.useState("all"),[x,j]=s.useState("all");s.useEffect(()=>{c?.admin&&k()},[c?.admin]);async function k(){p(!0);try{const t=await U.adminGetTradesReport();h(t.trades)}catch(t){console.error("Failed to load trades report:",t)}finally{p(!1)}}const N=s.useMemo(()=>{const t=new Map;return l.forEach(a=>t.set(a.user_id,a.username)),Array.from(t.entries()).sort((a,o)=>a[1].localeCompare(o[1]))},[l]),v=s.useMemo(()=>{const t=new Set;return l.forEach(a=>t.add(a.market)),Array.from(t).sort()},[l]),d=s.useMemo(()=>l.filter(t=>!(n!=="all"&&t.user_id!==parseInt(n)||x!=="all"&&t.market!==x)),[l,n,x]),w=()=>{const t=["Time","User","Side","Market","Outcome","Price","Contracts","Settled Price","Settled PNL"],a=d.map(r=>[m(new Date(r.time*1e3),"yyyy-MM-dd HH:mm:ss"),r.username,r.side,r.market,r.outcome,(r.price/100).toFixed(0)+"%",r.contracts.toString(),r.settled_price!=null?(r.settled_price/100).toFixed(0)+"%":"",r.settled_pnl!=null?(r.settled_pnl/100).toFixed(2):""]),o=[t,...a].map(r=>r.map(S=>`"${S}"`).join(",")).join(`
`),M=new Blob([o],{type:"text/csv;charset=utf-8;"}),y=URL.createObjectURL(M),i=document.createElement("a");i.href=y,i.download=`trades-report-${m(new Date,"yyyy-MM-dd-HHmmss")}.csv`,i.click(),URL.revokeObjectURL(y)};return c?.admin?f?e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{variant:"text",width:"200px",height:"32px"}),e.jsx(g,{variant:"rectangular",height:"400px",className:"rounded-lg"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Trades Report"}),e.jsx("button",{onClick:w,className:"px-4 py-2 bg-primary-600 text-white rounded-md hover:bg-primary-700 transition text-sm font-medium",children:"Export CSV"})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"User"}),e.jsxs("select",{value:n,onChange:t=>b(t.target.value),className:"border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1.5 bg-white dark:bg-gray-800 text-sm min-w-[150px]",children:[e.jsx("option",{value:"all",children:"All Users"}),N.map(([t,a])=>e.jsx("option",{value:t,children:a},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Market"}),e.jsxs("select",{value:x,onChange:t=>j(t.target.value),className:"border border-gray-300 dark:border-gray-600 rounded-md px-3 py-1.5 bg-white dark:bg-gray-800 text-sm min-w-[200px]",children:[e.jsx("option",{value:"all",children:"All Markets"}),v.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{className:"flex items-end",children:e.jsxs("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:[d.length," trade",d.length!==1?"s":""]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[900px] text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[e.jsx("th",{className:"py-2 px-2 text-left font-bold text-gray-600 dark:text-gray-400",children:"Time"}),e.jsx("th",{className:"py-2 px-2 text-left font-bold text-gray-600 dark:text-gray-400",children:"User"}),e.jsx("th",{className:"py-2 px-2 text-center font-bold text-gray-600 dark:text-gray-400",children:"Side"}),e.jsx("th",{className:"py-2 px-2 text-left font-bold text-gray-600 dark:text-gray-400",children:"Market"}),e.jsx("th",{className:"py-2 px-2 text-left font-bold text-gray-600 dark:text-gray-400",children:"Outcome"}),e.jsx("th",{className:"py-2 px-2 text-right font-bold text-gray-600 dark:text-gray-400",children:"Price"}),e.jsx("th",{className:"py-2 px-2 text-right font-bold text-gray-600 dark:text-gray-400",children:"Contracts"}),e.jsx("th",{className:"py-2 px-2 text-right font-bold text-gray-600 dark:text-gray-400",children:"Settled"}),e.jsx("th",{className:"py-2 px-2 text-right font-bold text-gray-600 dark:text-gray-400",children:"Settled PNL"})]})}),e.jsx("tbody",{children:d.map((t,a)=>e.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 ${a%2===0?"bg-gray-50 dark:bg-gray-800/50":""}`,children:[e.jsx("td",{className:"py-2 px-2 text-gray-900 dark:text-gray-100 whitespace-nowrap",children:m(new Date(t.time*1e3),"M/d/yy h:mm a")}),e.jsx("td",{className:"py-2 px-2 text-gray-900 dark:text-gray-100",children:t.username}),e.jsx("td",{className:"py-2 px-2 text-center",children:e.jsx("span",{className:`inline-block px-2 py-0.5 rounded text-xs font-bold ${t.side==="Buy"?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:t.side})}),e.jsx("td",{className:"py-2 px-2 text-gray-900 dark:text-gray-100 max-w-[200px] truncate",title:t.market,children:t.market}),e.jsx("td",{className:"py-2 px-2 text-gray-900 dark:text-gray-100 max-w-[200px] truncate",title:t.outcome,children:t.outcome}),e.jsx("td",{className:"py-2 px-2 text-right text-gray-900 dark:text-gray-100",children:u(t.price)}),e.jsx("td",{className:"py-2 px-2 text-right text-gray-900 dark:text-gray-100",children:t.contracts}),e.jsx("td",{className:"py-2 px-2 text-right text-gray-900 dark:text-gray-100",children:t.settled_price!=null?u(t.settled_price):"—"}),e.jsx("td",{className:`py-2 px-2 text-right font-medium ${t.settled_pnl==null?"text-gray-400":t.settled_pnl>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:t.settled_pnl!=null?P(t.settled_pnl):"—"})]},`${t.trade_id}-${t.user_id}`))})]})}),d.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No trades found"})]}):e.jsx(C,{to:"/markets",replace:!0})}export{L as AdminTradesReportPage};
