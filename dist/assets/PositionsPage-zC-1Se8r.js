import{a as $,r as c,b as T,j as t,L as f}from"./index-BsuGSwNh.js";import{P as V}from"./PullToRefresh-CsMYa0-q.js";import{f as b,a as o,d as y}from"./format-Cpou_ref.js";import{C as B,b as E}from"./Card-BiAtB9YM.js";import{E as _}from"./EmptyState-DW2Htejw.js";import{S as O,a as R,b as z}from"./Skeleton-DCdkVozd.js";function q(){const j=$(),[l,N]=c.useState([]),[v,m]=c.useState(!0);c.useEffect(()=>{p()},[]);async function p(){m(!0);try{const{positions:e}=await T.getAllPositions();N(e)}catch(e){console.error("Failed to load positions:",e)}finally{m(!1)}}const d=l.reduce((e,s)=>{let r=0;if(s.net_position!==0){const a=s.current_price!==null&&s.current_price!==void 0?s.current_price:null;if(a!==null){const i=s.net_position*s.price_basis;r=s.net_position<0?(s.price_basis-a)*Math.abs(s.net_position):s.net_position*a-i}}return r+=(s.closed_profit??0)+(s.settled_profit??0),e+r},0),x=l.filter(e=>e.net_position!==0||(e.closed_profit??0)!==0||(e.settled_profit??0)!==0),h=c.useMemo(()=>{const e=l.filter(r=>r.net_position!==0||(r.closed_profit??0)!==0||(r.settled_profit??0)!==0),s={};for(const r of e){const a=r.market_id??r.market_name??"other",i=r.market_name??r.market_id??"Other";s[a]||(s[a]={marketLabel:i,positions:[]}),s[a].positions.push(r)}return Object.entries(s)},[l]),C=(e,s)=>s===null?null:e.net_position<0?(1e4-s)*Math.abs(e.net_position):e.net_position*s,u=e=>{const s=e.net_position!==0,r=e.current_price!==null&&e.current_price!==void 0?e.current_price:null,a=e.net_position*e.price_basis,i=s?C(e,r):null,n=s&&r!==null?e.net_position<0?(e.price_basis-r)*Math.abs(e.net_position):e.net_position*r-a:null,P=()=>{e.market_id&&j(`/markets/${e.market_id}`)},g=e.closed_profit??0,k=e.settled_profit??0,w=e.net_position>0,M=`${e.net_position>=0?"+":""}${e.net_position} @ ${o(e.price_basis)}`,{riskCents:S,toProfitCents:L}=e.net_position<0?{riskCents:(1e4-e.price_basis)*Math.abs(e.net_position),toProfitCents:e.price_basis*Math.abs(e.net_position)}:{riskCents:e.price_basis*e.net_position,toProfitCents:(1e4-e.price_basis)*e.net_position};return t.jsx(B,{className:"mb-3",onClick:e.market_id?P:void 0,hover:!!e.market_id,children:t.jsxs(E,{children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[t.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:e.outcome_name||e.outcome_ticker||e.outcome}),s?t.jsxs(t.Fragment,{children:[t.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${w?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:M}),t.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",t.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:o(S)})," | ","To Profit: ",t.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:o(L)})]})]}):t.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700/50",children:"No Open Position"})]}),s&&t.jsxs("div",{className:"flex flex-col items-end text-right",children:[t.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:i!==null?y(i):y(a)}),t.jsx("div",{className:`text-sm sm:text-base font-semibold ${n!==null?n>0?"text-green-600 dark:text-green-400":n<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:n!==null?t.jsxs(t.Fragment,{children:[n>0?"↑":n<0?"↓":""," ",b(Math.abs(n))]}):"—"})]})]}),t.jsxs("div",{className:"mt-3 -mx-4 sm:-mx-5 -mb-4 sm:-mb-5 px-4 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[t.jsxs("span",{children:["Closed profit: ",t.jsx("span",{className:`font-medium ${g>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:o(g)})]}),t.jsxs("span",{children:["Settled profit: ",t.jsx("span",{className:`font-medium ${k>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:o(k)})]})]})]})},e.id)};return v?t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(O,{variant:"text",width:"200px",height:"32px"}),t.jsx("div",{className:"md:hidden space-y-3",children:[1,2,3].map(e=>t.jsx(R,{},e))}),t.jsx("div",{className:"hidden md:block",children:t.jsx(z,{rows:5,cols:8})})]}):t.jsx(V,{onRefresh:p,children:t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Positions"}),x.length>0&&t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Portfolio value"}),t.jsxs("span",{className:`text-lg sm:text-xl font-bold ${d>0?"text-green-600 dark:text-green-400":d<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:[d>0?"+":"",b(d)]})]}),t.jsx("div",{className:"md:hidden space-y-6",children:x.length===0?t.jsx(_,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),title:"No Positions",message:"You don't have any open positions. Trade on a market to open a position.",action:t.jsx(f,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):h.map(([e,{marketLabel:s,positions:r}])=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-sm font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide sticky top-0 bg-white dark:bg-gray-900 py-1 z-10",children:s}),t.jsx("div",{className:"space-y-3",children:r.map(u)})]},e))}),t.jsx("div",{className:"hidden md:block space-y-6",children:x.length===0?t.jsx(_,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),title:"No Positions",message:"You don't have any open positions. Trade on a market to open a position.",action:t.jsx(f,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):h.map(([e,{marketLabel:s,positions:r}])=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-sm font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide",children:s}),t.jsx("div",{className:"space-y-3",children:r.map(u)})]},e))})]})})}export{q as PositionsPage};
