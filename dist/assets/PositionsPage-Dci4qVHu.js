import{a as D,r as l,b as H,j as t,S as W,e as Y,f as G,L as P}from"./index-CKx9l2zO.js";import{u as I}from"./useMarketTypeFilter-gyeRN_hM.js";import{P as U}from"./PullToRefresh-YDu86OgS.js";import{e as y,a as m,d as c,f as q}from"./format-BckxrTVz.js";import{C as J,b as K}from"./Card-QYGCL2oY.js";import{E as M}from"./EmptyState-D1JBTTbe.js";import"./marketTypes-2i-psQO1.js";function S(p){return p.settled_price!=null||p.is_settled}function ae(){const p=D(),[b,$]=l.useState([]),[T,j]=l.useState(!0),[x,F]=l.useState("all"),_=l.useMemo(()=>b.filter(e=>e.net_position!==0||(e.closed_profit??0)!==0||(e.settled_profit??0)!==0),[b]),{selectedMarketType:N,setSelectedMarketType:L,filteredItems:g,filterOptions:B}=I(_,e=>e.market_type??"other"),a=l.useMemo(()=>x==="all"?g:x==="settled"?g.filter(S):g.filter(e=>!S(e)),[g,x]);l.useEffect(()=>{v()},[]);async function v(){j(!0);try{const{positions:e}=await H.getAllPositions();$(e)}catch(e){console.error("Failed to load positions:",e)}finally{j(!1)}}const h=a.reduce((e,s)=>{if(s.net_position===0||s.settled_price!=null||s.is_settled)return e;const r=s.current_price!==null&&s.current_price!==void 0?s.current_price:null;if(r===null)return e;const i=s.net_position*s.price_basis,k=s.net_position<0?(s.price_basis-r)*Math.abs(s.net_position):s.net_position*r-i;return e+k},0),u=a.reduce((e,s)=>e+(s.closed_profit??0),0),f=a.reduce((e,s)=>e+(s.settled_profit??0),0),w=l.useMemo(()=>{const e={};for(const s of a){const r=s.market_id??s.market_name??"other",i=s.market_name??s.market_id??"Other";e[r]||(e[r]={marketLabel:i,positions:[]}),e[r].positions.push(s)}return Object.entries(e)},[a]),V=(e,s)=>s===null?null:e.net_position<0?(1e4-s)*Math.abs(e.net_position):e.net_position*s,C=e=>{const s=e.net_position!==0,r=e.current_price!==null&&e.current_price!==void 0?e.current_price:null,i=e.net_position*e.price_basis,k=s?V(e,r):null,n=s&&r!==null?e.net_position<0?(e.price_basis-r)*Math.abs(e.net_position):e.net_position*r-i:null,O=()=>{e.market_id&&p(`/markets/${e.market_id}`)},d=e.closed_profit??0,o=e.settled_profit??0,E=e.net_position>0,R=`${e.net_position>=0?"+":""}${e.net_position} @ ${c(e.price_basis)}`,{riskCents:z,toProfitCents:A}=e.net_position<0?{riskCents:(1e4-e.price_basis)*Math.abs(e.net_position),toProfitCents:e.price_basis*Math.abs(e.net_position)}:{riskCents:e.price_basis*e.net_position,toProfitCents:(1e4-e.price_basis)*e.net_position};return t.jsx(J,{className:"mb-3",onClick:e.market_id?O:void 0,hover:!!e.market_id,children:t.jsxs(K,{children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[t.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:e.outcome_name||e.outcome_ticker||e.outcome}),s?t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"inline-flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${E?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:R}),(d!==0||o!==0)&&t.jsxs("span",{className:`text-xs font-medium ${d+o>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[d+o>=0?"+":"",m(d+o)]})]}),t.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",t.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:c(z)})," | ","To Profit: ",t.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:c(A)})]})]}):t.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700/50",children:"No Open Position"})]}),s&&t.jsxs("div",{className:"flex flex-col items-end text-right",children:[t.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:k!==null?y(k):y(i)}),t.jsx("div",{className:`text-sm sm:text-base font-semibold ${n!==null?n>0?"text-green-600 dark:text-green-400":n<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:n!==null?t.jsxs(t.Fragment,{children:[n>0?"↑":n<0?"↓":""," ",q(Math.abs(n))]}):"—"})]})]}),t.jsxs("div",{className:"mt-3 -mx-4 sm:-mx-5 -mb-4 sm:-mb-5 px-4 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap items-center justify-between gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[t.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1",children:[t.jsxs("span",{children:["Closed profit: ",t.jsx("span",{className:`font-medium ${d>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:m(d)})]}),t.jsxs("span",{children:["Settled profit: ",t.jsx("span",{className:`font-medium ${o>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:m(o)})]})]}),t.jsx("div",{className:"text-right shrink-0",children:e.settled_price!=null?`Settled @ ${c(e.settled_price)}`:`Bid: ${e.best_bid!=null?c(e.best_bid):"—"} | Ask: ${e.best_ask!=null?c(e.best_ask):"—"}`})]})]})},e.id)};return T?t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(W,{variant:"text",width:"200px",height:"32px"}),t.jsx("div",{className:"md:hidden space-y-3",children:[1,2,3].map(e=>t.jsx(Y,{},e))}),t.jsx("div",{className:"hidden md:block",children:t.jsx(G,{rows:5,cols:8})})]}):t.jsx(U,{onRefresh:v,children:t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Positions"}),a.length>0&&t.jsxs("div",{className:"flex flex-wrap items-stretch gap-x-6 gap-y-3",children:[t.jsxs("div",{className:"flex flex-1 min-w-[120px] flex-col gap-0.5",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Unrealized Gain"}),t.jsxs("span",{className:`text-lg sm:text-xl font-bold ${h>0?"text-green-600 dark:text-green-400":h<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:[h>0?"+":"",y(h)]})]}),t.jsxs("div",{className:"flex flex-1 min-w-[120px] flex-col gap-0.5",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Closed profit"}),t.jsxs("span",{className:`text-lg sm:text-xl font-bold ${u>0?"text-green-600 dark:text-green-400":u<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:[u>0?"+":"",m(u)]})]}),t.jsxs("div",{className:"flex flex-1 min-w-[120px] flex-col gap-0.5",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Settled profit"}),t.jsxs("span",{className:`text-lg sm:text-xl font-bold ${f>0?"text-green-600 dark:text-green-400":f<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:[f>0?"+":"",m(f)]})]})]}),_.length>0&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"space-y-2",role:"group","aria-label":"Filter by status",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 block",children:"Show"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:["all","settled","unsettled"].map(e=>t.jsx("button",{type:"button",onClick:()=>F(e),"aria-pressed":x===e,className:`min-h-[32px] px-2.5 py-1 rounded-full text-xs font-medium touch-manipulation transition-colors ${x===e?"bg-primary-600 text-white dark:bg-primary-500":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500"}`,children:e==="all"?"Show all":e==="settled"?"Show settled":"Show unsettled"},e))})]}),t.jsxs("div",{className:"space-y-2",role:"group","aria-label":"Filter by market type",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 block",children:"Market type"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:B.map(e=>t.jsx("button",{type:"button",onClick:()=>L(e.value),"aria-pressed":N===e.value,className:`min-h-[32px] px-2.5 py-1 rounded-full text-xs font-medium touch-manipulation transition-colors ${N===e.value?"bg-primary-600 text-white dark:bg-primary-500":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500"}`,children:e.label},e.value))})]})]}),t.jsx("div",{className:"md:hidden space-y-6",children:a.length===0?t.jsx(M,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),title:"No Positions",message:"You don't have any open positions. Trade on a market to open a position.",action:t.jsx(P,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):w.map(([e,{marketLabel:s,positions:r}])=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-sm font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide sticky top-0 bg-white dark:bg-gray-900 py-1 z-10",children:s}),t.jsx("div",{className:"space-y-3",children:r.map(C)})]},e))}),t.jsx("div",{className:"hidden md:block space-y-6",children:a.length===0?t.jsx(M,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),title:"No Positions",message:"You don't have any open positions. Trade on a market to open a position.",action:t.jsx(P,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):w.map(([e,{marketLabel:s,positions:r}])=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-sm font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide",children:s}),t.jsx("div",{className:"space-y-3",children:r.map(C)})]},e))})]})})}export{ae as PositionsPage};
