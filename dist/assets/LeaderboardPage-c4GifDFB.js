import{u as $,r as i,j as e,N as L,b as C}from"./index-0QrnFYTO.js";import{C as T,b as P}from"./Card-Cg82LWCx.js";import{P as U}from"./PullToRefresh-C6bp1aEI.js";function g(m,a=!1){const f=m/100,p=Math.abs(f).toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return a?m>=0?`+$${p}`:`-$${p}`:`$${p}`}const D="shares_traded",E="desc";function R(){const{user:m}=$(),[a,f]=i.useState([]),[l,p]=i.useState(0),[v,b]=i.useState(!0),[j,_]=i.useState(null),[d,S]=i.useState(D),[n,k]=i.useState(E),h=i.useMemo(()=>{if(a.length===0)return[];const t=d,o=n==="asc"?1:-1;return[...a].sort((s,r)=>{let u=0;if(t==="username")u=(s.username??"").localeCompare(r.username??"");else{const c=t==="portfolio_value_cents"?s.portfolio_value_cents:t==="trade_count"?s.trade_count:t==="open_orders_count"?s.open_orders_count:s.shares_traded,x=t==="portfolio_value_cents"?r.portfolio_value_cents:t==="trade_count"?r.trade_count:t==="open_orders_count"?r.open_orders_count:r.shares_traded;u=c-x}return u*o})},[a,d,n]);function y(t){d===t?k(o=>o==="asc"?"desc":"asc"):(S(t),k(t==="username"?"asc":"desc"))}async function N(){b(!0),_(null);try{const{leaderboard:t,unattributed_portfolio_value_cents:o}=await C.adminGetLeaderboard();f(t??[]),p(o??0)}catch(t){console.error("Failed to load leaderboard:",t),_(t instanceof Error?t.message:"Failed to load leaderboard")}finally{b(!1)}}return i.useEffect(()=>{m?.admin&&N()},[m?.admin]),m&&!m.admin?e.jsx(L,{to:"/markets",replace:!0}):v&&a.length===0?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Leaderboard"}),e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3,4,5].map(t=>e.jsx("div",{className:"h-14 bg-gray-200 dark:bg-gray-700 rounded-lg"},t))})]}):j?e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Leaderboard"}),e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:j})]}):e.jsx(U,{onRefresh:N,children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Leaderboard"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Per-user stats: trades, open orders, shares traded, portfolio value (P&L). Zero-sum: totals should net to $0."}),e.jsx("div",{className:"md:hidden space-y-3",children:h.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 py-4",children:"No users."}):h.map(t=>e.jsx(T,{children:e.jsxs(P,{className:"p-4",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100 mb-3",children:t.username}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Trades"}),e.jsx("span",{className:"text-right font-medium",children:t.trade_count}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Open orders"}),e.jsx("span",{className:"text-right font-medium",children:t.open_orders_count}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Shares traded"}),e.jsx("span",{className:"text-right font-medium",children:t.shares_traded}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Portfolio value"}),e.jsx("span",{className:`text-right font-medium ${t.portfolio_value_cents>0?"text-green-600 dark:text-green-400":t.portfolio_value_cents<0?"text-red-600 dark:text-red-400":""}`,children:g(t.portfolio_value_cents,!0)})]})]})},t.user_id))}),a.length>0&&(()=>{const t=a.reduce((s,r)=>s+r.portfolio_value_cents,0),o=t+l;return e.jsxs("div",{className:"md:hidden rounded-lg border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/80 p-4",children:[e.jsx("div",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wide mb-2",children:"Summary (all participants)"}),e.jsxs("div",{className:"flex flex-wrap gap-x-6 gap-y-1 text-sm",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Trades:"})," ",e.jsx("span",{className:"font-semibold",children:a.reduce((s,r)=>s+r.trade_count,0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Open orders:"})," ",e.jsx("span",{className:"font-semibold",children:a.reduce((s,r)=>s+r.open_orders_count,0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Shares traded:"})," ",e.jsx("span",{className:"font-semibold",children:a.reduce((s,r)=>s+r.shares_traded,0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Portfolio (users):"})," ",e.jsx("span",{className:`font-semibold ${t>0?"text-green-600 dark:text-green-400":t<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:g(t,!0)})]}),l!==0&&e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Unattributed:"})," ",e.jsx("span",{className:`font-semibold ${l>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:g(l,!0)})]}),e.jsxs("span",{children:[e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Total:"})," ",e.jsx("span",{className:`font-semibold ${o===0?"text-gray-700 dark:text-gray-300":o>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:g(o,!0)})]})]})]})})(),e.jsx("div",{className:"hidden md:block overflow-x-auto rounded-lg border border-gray-200 dark:border-gray-600",children:e.jsxs("table",{className:"w-full min-w-[600px] border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:[e.jsx("th",{className:"py-3 px-4 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>y("username"),className:"flex items-center gap-1 hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":d==="username"?n==="asc"?"ascending":"descending":void 0,children:["User ",d==="username"&&(n==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>y("trade_count"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":d==="trade_count"?n==="asc"?"ascending":"descending":void 0,children:["Trades ",d==="trade_count"&&(n==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>y("open_orders_count"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":d==="open_orders_count"?n==="asc"?"ascending":"descending":void 0,children:["Open orders ",d==="open_orders_count"&&(n==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>y("shares_traded"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":d==="shares_traded"?n==="asc"?"ascending":"descending":void 0,children:["Shares traded ",d==="shares_traded"&&(n==="asc"?"↑":"↓")]})}),e.jsx("th",{className:"py-3 px-4 text-right text-xs font-bold text-gray-600 dark:text-gray-400",children:e.jsxs("button",{type:"button",onClick:()=>y("portfolio_value_cents"),className:"inline-flex items-center gap-1 ml-auto hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-sort":d==="portfolio_value_cents"?n==="asc"?"ascending":"descending":void 0,children:["Portfolio value ",d==="portfolio_value_cents"&&(n==="asc"?"↑":"↓")]})})]})}),e.jsx("tbody",{children:h.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"py-8 text-center text-gray-500 dark:text-gray-400",children:"No users."})}):h.map(t=>e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:[e.jsx("td",{className:"py-3 px-4 font-medium text-gray-900 dark:text-gray-100",children:t.username}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.trade_count}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.open_orders_count}),e.jsx("td",{className:"py-3 px-4 text-right text-gray-700 dark:text-gray-300",children:t.shares_traded}),e.jsx("td",{className:`py-3 px-4 text-right font-medium ${t.portfolio_value_cents>0?"text-green-600 dark:text-green-400":t.portfolio_value_cents<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:g(t.portfolio_value_cents,!0)})]},t.user_id))}),a.length>0&&(()=>{const t=a.reduce((c,x)=>c+x.trade_count,0),o=a.reduce((c,x)=>c+x.open_orders_count,0),s=a.reduce((c,x)=>c+x.shares_traded,0),r=a.reduce((c,x)=>c+x.portfolio_value_cents,0),u=r+l;return e.jsxs("tfoot",{children:[e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-500 bg-gray-100 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-gray-100",children:"All participants"}),e.jsx("td",{className:"py-3 px-4 text-right",children:t}),e.jsx("td",{className:"py-3 px-4 text-right",children:o}),e.jsx("td",{className:"py-3 px-4 text-right",children:s}),e.jsx("td",{className:`py-3 px-4 text-right ${r>0?"text-green-600 dark:text-green-400":r<0?"text-red-600 dark:text-red-400":"text-gray-700 dark:text-gray-300"}`,children:g(r,!0)})]}),l!==0&&e.jsxs("tr",{className:"border-t border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/80 font-medium",children:[e.jsx("td",{className:"py-2 px-4 text-gray-600 dark:text-gray-400 text-xs",children:"Unattributed (no user_id)"}),e.jsx("td",{colSpan:3,className:"py-2 px-4"}),e.jsx("td",{className:`py-2 px-4 text-right ${l>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:g(l,!0)})]}),e.jsxs("tr",{className:"border-t border-gray-300 dark:border-gray-500 bg-gray-100 dark:bg-gray-800 font-semibold",children:[e.jsx("td",{className:"py-3 px-4 text-gray-900 dark:text-gray-100",children:"Total"}),e.jsx("td",{colSpan:3,className:"py-3 px-4"}),e.jsx("td",{className:`py-3 px-4 text-right ${u===0?"text-gray-700 dark:text-gray-300":u>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:g(u,!0)})]})]})})()]})})]})})}export{R as LeaderboardPage};
