import{r as o,u as $,b as w,j as e,S as A,L as B}from"./index-BKAMN1iK.js";import{f as H}from"./format-BckxrTVz.js";import{E as F}from"./EmptyState-C_BiwEV_.js";import{f as M}from"./index-BAgxTVAR.js";import{P as O}from"./PullToRefresh-w7pjYvpz.js";const J=20,_=["#2563eb","#16a34a","#dc2626","#d97706","#7c3aed","#0d9488","#db2777","#4f46e5","#059669","#ea580c","#0891b2","#c026d3","#e11d48","#0284c7","#65a30d","#9333ea","#0e7490","#c2410c","#0f766e","#be185d","#ca8a04","#1d4ed8","#15803d","#b91c1c"];function U(a){let t=0;for(let s=0;s<a.length;s++)t=(t<<5)-t+a.charCodeAt(s)|0;return Math.abs(t)}function T(a){if(!(!a||a==="—"))return _[U(a)%_.length]}function W(a){const t=Math.floor(Date.now()/1e3-a);if(t<10)return"Just now";if(t<60)return`${t}s ago`;const s=Math.floor(t/60);if(s<60)return`${s}m ago`;const n=Math.floor(s/60);return n<24?`${n}h ago`:M(new Date(a*1e3),"M/d h:mm a")}const Y=o.forwardRef(function({showTitle:t=!0},s){const{user:n}=$(),[u,c]=o.useState([]),[S,f]=o.useState(!0),[m,h]=o.useState(null),d=o.useCallback(async()=>{f(!0);try{const{trades:r}=await w.getTape(J);c(r??[])}catch(r){console.error("Failed to load trade tape:",r),c([])}finally{f(!1)}},[]);if(o.useImperativeHandle(s,()=>({refresh:d}),[d]),o.useEffect(()=>{d()},[d]),S)return e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800/80 shadow-sm p-4",children:[t&&e.jsx("h2",{className:"text-sm font-bold text-gray-600 dark:text-gray-400 mb-3",children:"Trade tape"}),e.jsx("div",{className:"space-y-3",children:[1,2,3,4,5,6,7].map(r=>e.jsx(A,{variant:"rectangular",height:48,className:"rounded"},r))})]});if(u.length===0)return e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800/80 shadow-sm p-6",children:[t&&e.jsx("h2",{className:"text-sm font-bold text-gray-600 dark:text-gray-400 mb-3",children:"Trade tape"}),e.jsx(F,{icon:e.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}),title:"No recent trades",message:"Trades will appear here as they happen across all markets."})]});const R=!t;return e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800/80 shadow-sm overflow-hidden",children:[t&&e.jsx("h2",{className:"text-sm font-bold text-gray-600 dark:text-gray-400 px-4 pt-3 pb-2",children:"Trade tape"}),e.jsx("div",{className:`px-3 sm:px-4 ${R?"py-3":"py-2 max-h-[280px] overflow-y-auto"}`,children:e.jsx("div",{className:"space-y-3",children:u.map(r=>{const x=r.buyer_username??"—",p=r.seller_username??"—",i=(r.taker_side??r.side??0)===0,g=i?x:p,b=i?p:x,y=T(g),k=T(b),v=r.contracts,P=r.outcome_name||r.outcome_ticker||r.outcome||"—",l=r.market_id??"",j=l==="market_total_birdies"?"market-total-birdies":l,C=r.market_short_name||(l==="market_total_birdies"?"Total Birdies (6R)":l)||"—",L=r.create_time?W(r.create_time):"—",D=H(r.price);return e.jsxs("div",{className:"relative group",children:[e.jsxs(B,{to:j?`/markets/${j}`:"#",className:"block py-2.5 px-3 pr-9 rounded border border-transparent hover:border-gray-200 dark:hover:border-gray-600 hover:bg-gray-50/80 dark:hover:bg-gray-700/30 transition-colors touch-manipulation",children:[e.jsxs("div",{className:"text-sm text-gray-900 dark:text-gray-100",children:[e.jsx("span",{className:"font-semibold",style:y?{color:y}:void 0,children:g})," ",i?"bought":"sold"," ",e.jsxs("span",{className:"font-semibold",children:[v," ",v===1?"share":"shares"]})," of ",e.jsx("span",{className:"font-medium",children:P}),i?" from ":" to ",e.jsx("span",{className:"font-semibold",style:k?{color:k}:void 0,children:b})," @ ",e.jsx("span",{className:"font-bold",children:D})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400 mt-0.5",title:r.create_time?M(new Date(r.create_time*1e3),"MMM d, h:mm a"):void 0,children:["on ",C," ",L]})]}),n?.admin&&e.jsx("button",{type:"button",onClick:async N=>{if(N.preventDefault(),N.stopPropagation(),m===null&&window.confirm("Back out this trade? Positions and the crossed order will be reverted.")){h(r.id);try{await w.adminDeleteTrade(r.id),c(E=>E.filter(I=>I.id!==r.id))}catch{h(null)}finally{h(null)}}},disabled:m===r.id,className:"absolute top-1/2 right-2 -translate-y-1/2 w-7 h-7 flex items-center justify-center rounded text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 border border-transparent hover:border-red-200 dark:hover:border-red-800 text-lg font-bold touch-manipulation disabled:opacity-50","aria-label":"Delete trade",children:m===r.id?"…":"×"})]},r.id)})})})]})});function X(){const a=o.useRef(null);return e.jsx(O,{onRefresh:async()=>{await a.current?.refresh()},children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-gray-100",children:"Trade tape"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Recent activity across all markets"})]}),e.jsx(Y,{ref:a,showTitle:!1})]})})}export{X as TapePage};
