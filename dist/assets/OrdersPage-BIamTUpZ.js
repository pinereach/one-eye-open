import{r as a,j as t,b as _,L as Z}from"./index-B-RDvJx5.js";import{P as q}from"./PullToRefresh-CEVNc9ML.js";import{e as J,f as ee}from"./format-Cpou_ref.js";import{C as te,b as se}from"./Card-DyPBdXVl.js";import{S as ae,a as re,b as le}from"./Skeleton-COmK01Uv.js";import{E as ne}from"./EmptyState-CQBRXkLD.js";import{u as ie,T as ce}from"./Toast-XZNtNolK.js";import{C as F}from"./ConfirmModal-DFGB7Udb.js";import{f as B}from"./index-BAgxTVAR.js";function oe({children:h,onSwipeLeft:m,onSwipeRight:C,leftAction:u,rightAction:p,className:b=""}){const[f,j]=a.useState(0),[y,g]=a.useState(!1),i=a.useRef(0),c=a.useRef(0),N=100,w=n=>{i.current=n.touches[0].clientX,c.current=i.current,g(!0)},T=n=>{if(!y)return;c.current=n.touches[0].clientX;const k=c.current-i.current;j(k)},o=()=>{if(!y)return;const n=c.current-i.current;Math.abs(n)>N&&(n>0&&C?C():n<0&&m&&m()),j(0),g(!1)},z=f<-N/2&&u,x=f>N/2&&p;return t.jsxs("div",{className:"relative overflow-hidden",children:[t.jsxs("div",{className:"absolute inset-0 flex",children:[u&&t.jsx("div",{className:`flex-1 bg-red-500 flex items-center justify-end pr-4 transition-opacity ${z?"opacity-100":"opacity-0"}`,children:u}),p&&t.jsx("div",{className:`flex-1 bg-green-500 flex items-center justify-start pl-4 transition-opacity ${x?"opacity-100":"opacity-0"}`,children:p})]}),t.jsx("div",{className:`relative transition-transform touch-manipulation ${b}`,style:{transform:`translateX(${f}px)`},onTouchStart:w,onTouchMove:T,onTouchEnd:o,children:h})]})}const de=30,M=10,D=10;function je(){const[h,m]=a.useState([]),[C,u]=a.useState(!0),[p,b]=a.useState(!1),[f,j]=a.useState(!1),[y,g]=a.useState(D),[i,c]=a.useState(null),[N,w]=a.useState(!1),{toasts:T,showToast:o,removeToast:z}=ie();a.useEffect(()=>{x()},[]);async function x(e=!1){e||u(!0);try{const s=e?h.length:0,r=e?M:de,{orders:S,hasMore:l}=await _.getAllOrders({limit:r,offset:s});e?m(I=>[...I,...S]):(m(S??[]),g(D)),j(l??!1)}catch(s){console.error("Failed to load orders:",s),o("Failed to load orders","error")}finally{u(!1),b(!1)}}async function n(e){m(s=>s.map(r=>r.id===e?{...r,status:"canceled"}:r)),c(null);try{await _.cancelOrder(e),o("Order canceled successfully","success"),await x(!1)}catch(s){console.error("Failed to cancel order:",s),o(s.message||"Failed to cancel order","error"),await x(!1)}}async function k(e){c(e)}const v=h.filter(e=>e.status==="open"||e.status==="partial"),L=h.filter(e=>e.status==="filled"||e.status==="canceled"),$=L.slice(0,y),H=L.length>y||f;async function V(){if(L.length>y){g(e=>e+M);return}if(f){b(!0);try{const{orders:e,hasMore:s}=await _.getAllOrders({limit:M,offset:h.length});m(r=>[...r,...e??[]]),j(s??!1),g(r=>r+M)}catch(e){console.error("Failed to load more orders:",e),o("Failed to load more orders","error")}finally{b(!1)}}}async function X(){try{const e=v.map(s=>_.cancelOrder(s.id));await Promise.all(e),o("All orders canceled successfully","success"),await x(!1)}catch(e){console.error("Failed to cancel orders:",e),o(e.message||"Failed to cancel all orders","error")}}function Y(){w(!0)}const A=e=>{const s=e.side===1,r=s?"SELL ORDER":"BUY ORDER",S=s?"text-red-600 dark:text-red-400":"text-primary-600 dark:text-primary-400",l=e.original_size!==void 0&&e.original_size!==null?e.original_size:e.contract_size||0,I=e.remaining_size!==void 0&&e.remaining_size!==null?e.remaining_size:e.status==="filled"?0:l,O=Math.max(0,l-I),P=e.price?J(e.price):"0.0%",G=s?`Sell ${l} shares for ${P}`:`Buy ${l} shares for ${P}`,Q=e.status==="filled"?`${l} of ${l} filled`:O>0&&O<l?`${O.toFixed(4)} of ${l} filled`:`${O} of ${l} filled`,U=e.create_time?B(new Date(e.create_time*1e3),"MM/dd/yy, h:mm:ss a"):"—",R=t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 mb-3 border border-gray-300 dark:border-gray-600",children:[t.jsxs("div",{className:"flex items-center justify-between gap-4 mb-2",children:[t.jsx("div",{className:`font-bold text-sm ${S}`,children:r}),(e.status==="open"||e.status==="partial")&&t.jsx("button",{onClick:W=>{W.stopPropagation(),k(e.id)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-base font-bold p-1 touch-manipulation flex-shrink-0",title:"Cancel order","aria-label":"Cancel order",children:"×"})]}),t.jsxs("div",{className:"flex items-stretch gap-4",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-bold text-sm sm:text-base text-gray-900 dark:text-gray-100 mb-1",children:e.market_name||"N/A"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:e.outcome_name||e.outcome}),t.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:G})]}),t.jsxs("div",{className:"flex flex-col items-end text-right flex-shrink-0",children:[t.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 mb-1",children:Q}),t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:U})]})]})]});return e.status==="open"||e.status==="partial"?t.jsx(oe,{onSwipeLeft:()=>k(e.id),leftAction:t.jsx("span",{className:"text-white font-medium text-sm",children:"Cancel"}),children:R},e.id):t.jsx("div",{children:R},e.id)},K=e=>t.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.create_time?B(new Date(e.create_time*1e3),"MMM d, yyyy h:mm a"):"—"}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.market_name||"N/A"}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.outcome_name||e.outcome}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center",children:t.jsx("span",{className:`text-xs sm:text-sm font-medium ${e.side===0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:e.side===0?"Buy":"Sell"})}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center font-medium text-xs sm:text-sm",children:e.price?ee(e.price):"—"}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-medium",children:e.original_size!==void 0&&e.original_size!==null?e.original_size:e.contract_size||0}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.remaining_size!==void 0&&e.remaining_size!==null?e.remaining_size:e.status==="filled"?0:e.contract_size||0}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("span",{className:`text-xs sm:text-sm px-2 py-1 rounded ${e.status==="filled"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200":e.status==="open"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":e.status==="partial"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:e.status}),e.status==="open"||e.status==="partial"?t.jsx("button",{onClick:()=>k(e.id),className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-1 rounded touch-manipulation",title:"Cancel order","aria-label":"Cancel order",children:"×"}):null]})})]},e.id),d="py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-bold text-gray-600 dark:text-gray-400 sticky top-0 z-10 bg-white dark:bg-gray-900 border-b border-gray-300 dark:border-gray-600",E=(e,s)=>t.jsx("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:t.jsx("div",{className:"inline-block min-w-full align-middle",children:t.jsxs("table",{className:"w-full min-w-[600px] border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[t.jsx("th",{className:d,children:"Time"}),t.jsx("th",{className:d,children:"Market"}),t.jsx("th",{className:d,children:"Outcome"}),t.jsx("th",{className:d,children:"Side"}),t.jsx("th",{className:d,children:"Price"}),t.jsx("th",{className:d,children:"Qty"}),t.jsx("th",{className:d,children:"Remaining"}),t.jsx("th",{className:d,children:"Status"})]})}),t.jsx("tbody",{children:e.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"py-8 text-center text-gray-500 dark:text-gray-400 text-xs sm:text-sm",children:s})}):e.map(K)})]})})});return C?t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(ae,{variant:"text",width:"200px",height:"32px"}),t.jsx("div",{className:"md:hidden space-y-3",children:[1,2,3].map(e=>t.jsx(re,{},e))}),t.jsx("div",{className:"hidden md:block",children:t.jsx(le,{rows:5,cols:8})})]}):t.jsxs(q,{onRefresh:x,children:[t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(ce,{toasts:T,removeToast:z}),t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100",children:"Open Orders"}),v.length>0&&t.jsx("button",{onClick:Y,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 touch-manipulation transition-colors","aria-label":"Cancel all orders",children:"Cancel All"})]}),t.jsx("div",{className:"md:hidden space-y-3",children:v.length===0?t.jsx(ne,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),title:"No Open Orders",message:"You don't have any open orders at the moment. Place an order from a market to get started.",action:t.jsx(Z,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):v.map(A)}),t.jsx("div",{className:"hidden md:block",children:E(v,"No open orders")})]}),t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100",children:"Order History"}),t.jsx("div",{className:"md:hidden space-y-3",children:$.length===0?t.jsx(te,{children:t.jsx(se,{children:t.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 text-sm py-4",children:"No completed orders"})})}):$.map(A)}),t.jsx("div",{className:"hidden md:block",children:E($,"No completed orders")}),H&&t.jsx("div",{className:"flex justify-center pt-2",children:t.jsx("button",{type:"button",onClick:V,disabled:p,className:"px-4 py-2 text-sm font-medium text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-lg border border-primary-300 dark:border-primary-700 touch-manipulation disabled:opacity-50 transition-colors","aria-label":"Show more orders",children:p?"Loading…":"Show more"})})]})]}),t.jsx(F,{isOpen:i!=null,onClose:()=>c(null),onConfirm:()=>{i!=null&&n(i)},title:"Cancel order",message:"Are you sure you want to cancel this order?",confirmLabel:"Cancel order",cancelLabel:"Keep",variant:"danger"}),t.jsx(F,{isOpen:N,onClose:()=>w(!1),onConfirm:X,title:"Cancel all orders",message:"Are you sure you want to cancel all open orders?",confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"})]})}export{je as OrdersPage};
