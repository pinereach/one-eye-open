import{r as d,j as e,d as _t,a as wt,u as Ct,b as R}from"./index-TzOn1TcA.js";import{f as X,a as U,b as nt,c as ae,d as Pe}from"./format-CS6GGukx.js";import{u as Mt,T as Pt}from"./Toast-CuXoVI4W.js";import{C as De}from"./ConfirmModal-DphLMDIz.js";import{P as Ot}from"./PullToRefresh-DYIJueoN.js";import{S as it}from"./Skeleton-wBVY8AAG.js";import{C as lt,b as ct}from"./Card-CJgNv0A7.js";import{f as dt}from"./index-BAgxTVAR.js";function St({isOpen:j,orders:z,price:$,onClose:o,onCancel:w}){const y=b=>new Date(b*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});return j?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold",children:"Cancel Order"}),e.jsx("button",{onClick:o,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl font-bold",children:"×"})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["You have multiple orders at ",X($),". Select which one to cancel:"]}),e.jsx("div",{className:"space-y-2",children:z.map(b=>e.jsx("button",{onClick:()=>{w(b.id),o()},className:"w-full text-left p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm sm:text-base",children:[b.contract_size||0," contracts"]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:b.create_time?y(b.create_time):"—"})]}),e.jsx("div",{className:"text-xs sm:text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded ${b.status==="open"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":b.status==="partial"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:b.status})})]})},b.id))}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:o,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:"Cancel"})})]})})}):null}function Te({bids:j,asks:z,userId:$,onPriceClick:o,onCancelOrder:w}){const[y,b]=d.useState({isOpen:!1,orders:[],price:0}),Q=x=>{const _=new Map;return x.forEach(u=>{const N=u.price||0;_.has(N)||_.set(N,{price:N,totalSize:0,orders:[],userOrders:[]});const l=_.get(N);l.orders.push(u),l.totalSize+=u.contract_size||0,$!==void 0&&u.user_id===$&&l.userOrders.push(u)}),Array.from(_.values()).sort((u,N)=>N.price-u.price)},h=x=>{const _=new Map;return x.forEach(u=>{const N=u.price||0;_.has(N)||_.set(N,{price:N,totalSize:0,orders:[],userOrders:[]});const l=_.get(N);l.orders.push(u),l.totalSize+=u.contract_size||0,$!==void 0&&u.user_id===$&&l.userOrders.push(u)}),Array.from(_.values()).sort((u,N)=>u.price-N.price)},P=Q(j),f=h(z),O=x=>{let _=0;return x.map(u=>(_+=u.totalSize,{...u,cumulative:_}))},F=O(P),J=O(f),E=Math.max(...F.map(x=>x.cumulative),...J.map(x=>x.cumulative),1),ne=x=>{const _=x.userOrders.filter(u=>u.status==="open"||u.status==="partial");_.length!==0&&(_.length===1?w&&w(_[0].id):b({isOpen:!0,orders:_,price:x.price}))};return e.jsxs(e.Fragment,{children:[e.jsx(St,{isOpen:y.isOpen,orders:y.orders,price:y.price,onClose:()=>b({isOpen:!1,orders:[],price:0}),onCancel:x=>{w&&w(x)}}),e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-sm sm:text-base text-green-600 dark:text-green-400",children:"Yes/Buy"}),e.jsx("div",{className:"space-y-1",children:P.length===0?e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No bids"}):F.map(x=>{const _=x.cumulative/E*100,u=x.userOrders.length>0,N=x.userOrders.filter(k=>k.status==="open"||k.status==="partial"),l=u&&N.length>0,T=N.reduce((k,Y)=>k+(Y.contract_size??0),0),q=u&&T>0&&x.orders.length>1;return e.jsxs("div",{className:`relative flex items-center justify-between text-xs sm:text-sm p-2 rounded transition-colors touch-manipulation min-h-12 max-h-12 h-12 shrink-0 ${u?"bg-green-100 dark:bg-green-900/40 border-2 border-primary-500 dark:border-primary-400":"bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 cursor-pointer"}`,onClick:()=>!u&&o?.(x.price,"bid"),children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-green-200 dark:bg-green-800/40 rounded opacity-30",style:{width:`${_}%`}}),e.jsxs("div",{className:"relative z-10 flex items-center gap-1 flex-1 min-w-0",children:[u&&e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-primary-600 dark:text-primary-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:k=>{k.stopPropagation(),l&&ne(x)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium truncate",children:X(x.price)})]}),e.jsxs("div",{className:"relative z-10 flex items-center gap-2 min-w-0 shrink-0",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 whitespace-nowrap truncate",children:[x.totalSize,q&&e.jsxs("span",{className:"text-primary-600 dark:text-primary-400 ml-0.5",children:["(",T," mine)"]})]}),l&&e.jsx("button",{onClick:k=>{k.stopPropagation(),ne(x)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-0.5 rounded touch-manipulation flex-shrink-0",title:N.length>1?`Cancel order (${N.length} at this price)`:"Cancel order","aria-label":"Cancel order",children:"×"})]})]},x.price)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-sm sm:text-base text-red-600 dark:text-red-400",children:"No/Sell"}),e.jsx("div",{className:"space-y-1",children:f.length===0?e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No asks"}):J.map(x=>{const _=x.cumulative/E*100,u=x.userOrders.length>0,N=x.userOrders.filter(k=>k.status==="open"||k.status==="partial"),l=u&&N.length>0,T=N.reduce((k,Y)=>k+(Y.contract_size??0),0),q=u&&T>0&&x.orders.length>1;return e.jsxs("div",{className:`relative flex items-center justify-between text-xs sm:text-sm p-2 rounded transition-colors touch-manipulation min-h-12 max-h-12 h-12 shrink-0 ${u?"bg-red-100 dark:bg-red-900/40 border-2 border-primary-500 dark:border-primary-400":"bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 cursor-pointer"}`,onClick:()=>!u&&o?.(x.price,"ask"),children:[e.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-200 dark:bg-red-800/40 rounded opacity-30",style:{width:`${_}%`}}),e.jsxs("div",{className:"relative z-10 flex items-center gap-1 flex-1 min-w-0",children:[u&&e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-primary-600 dark:text-primary-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:k=>{k.stopPropagation(),l&&ne(x)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium truncate",children:X(x.price)})]}),e.jsxs("div",{className:"relative z-10 flex items-center gap-2 min-w-0 shrink-0",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 whitespace-nowrap truncate",children:[x.totalSize,q&&e.jsxs("span",{className:"text-primary-600 dark:text-primary-400 ml-0.5",children:["(",T," mine)"]})]}),l&&e.jsx("button",{onClick:k=>{k.stopPropagation(),ne(x)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-0.5 rounded touch-manipulation flex-shrink-0",title:N.length>1?`Cancel order (${N.length} at this price)`:"Cancel order","aria-label":"Cancel order",children:"×"})]})]},x.price)})})]})]})})]})}const ot='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function $t({isOpen:j,onClose:z,children:$,title:o}){const w=d.useRef(null),y=d.useRef(null),b=d.useRef(null),Q=d.useCallback(()=>{const h=w.current,P=y.current;if(h&&P){const f=h.getBoundingClientRect(),O=P.getBoundingClientRect();if(f.width>0&&f.height>0)return h;if(O.width>0&&O.height>0)return P}return h??P},[]);return d.useEffect(()=>(j?(document.body.style.overflow="hidden",b.current=document.activeElement):(document.body.style.overflow="",b.current&&typeof b.current.focus=="function"&&(b.current.focus(),b.current=null)),()=>{document.body.style.overflow=""}),[j]),d.useEffect(()=>{if(!j)return;const h=P=>{if(P.key==="Escape"){z();return}if(P.key!=="Tab")return;const f=Q();if(!f)return;const O=Array.from(f.querySelectorAll(ot)).filter(E=>!E.hasAttribute("disabled")&&E.offsetParent!=null);if(O.length===0)return;const F=O[0],J=O[O.length-1];P.shiftKey?document.activeElement===F&&(P.preventDefault(),J.focus()):document.activeElement===J&&(P.preventDefault(),F.focus())};return document.addEventListener("keydown",h),()=>document.removeEventListener("keydown",h)},[j,z,Q]),d.useEffect(()=>{if(!j)return;const h=Q();if(!h)return;const P=h.querySelector(ot),f=requestAnimationFrame(()=>{P&&P.focus()});return()=>cancelAnimationFrame(f)},[j,Q]),j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:z,"aria-hidden":"true"}),e.jsxs("div",{ref:w,className:"fixed bottom-0 left-0 right-0 z-50 md:hidden bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl max-h-[90vh] overflow-y-auto safe-area-bottom",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-gray-800 pt-2 pb-2 flex justify-center",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),o&&e.jsx("div",{className:"px-4 pb-3 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:o}),e.jsx("button",{onClick:z,className:"p-2 -mr-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 touch-manipulation min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"px-4 pt-4 pb-24",children:$})]}),e.jsx("div",{className:"hidden md:flex fixed inset-0 z-50 items-center justify-center p-4","aria-hidden":"true",children:e.jsxs("div",{ref:y,className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",onClick:h=>h.stopPropagation(),role:"dialog","aria-modal":"true",children:[o&&e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:o}),e.jsx("button",{onClick:z,className:"p-2 -mr-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"px-6 py-4",children:$})]})})]}):null}function Bt({tabs:j,activeTab:z,onTabChange:$,className:o=""}){return e.jsx("div",{className:`border-b border-gray-300 dark:border-gray-600 ${o}`,children:e.jsx("div",{className:"flex overflow-x-auto -mx-3 sm:mx-0 px-3 sm:px-0 scrollbar-hide",children:j.map(w=>{const y=z===w.id;return e.jsxs("button",{onClick:()=>$(w.id),className:`
                flex items-center gap-2 px-4 py-3 text-sm font-medium whitespace-nowrap
                border-b-2 transition-colors touch-manipulation min-h-[44px]
                ${y?"border-primary-600 dark:border-primary-400 text-primary-600 dark:text-primary-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:border-gray-300 dark:hover:border-gray-600"}
              `,"aria-selected":y,role:"tab",children:[w.icon&&e.jsx("span",{className:"flex-shrink-0",children:w.icon}),e.jsx("span",{children:w.label})]},w.id)})})})}const mt="(min-width: 768px)";function At(){const[j,z]=d.useState(()=>typeof window<"u"?window.matchMedia(mt).matches:!1);return d.useEffect(()=>{const $=window.matchMedia(mt),o=w=>z(w.matches);return z($.matches),$.addEventListener("change",o),()=>$.removeEventListener("change",o)},[]),j}function qt(){const{id:j}=_t(),z=wt(),{toasts:$,showToast:o,removeToast:w}=Mt(),{user:y}=Ct(),[b,Q]=d.useState(null),[h,P]=d.useState([]),[f,O]=d.useState(""),[F,J]=d.useState({}),[E,ne]=d.useState([]),[x,_]=d.useState([]),[u,N]=d.useState(!0),[l,T]=d.useState("bid"),[q,k]=d.useState(""),[Y,xe]=d.useState(""),[ye,ue]=d.useState(""),[fe,pe]=d.useState(""),[ke,je]=d.useState(!1),[Oe,V]=d.useState(null),[he,le]=d.useState(!1),[ce,Se]=d.useState(!1),[ie,xt]=d.useState("outcomes"),[Ee,Re]=d.useState(null),[ve,qe]=d.useState(!1),[$e,Ye]=d.useState(null),[ut,He]=d.useState(!1),[pt,Be]=d.useState(!1),[ht,We]=d.useState(!1),[H,ge]=d.useState({}),Ue=At(),Ae=d.useRef(null),ze=d.useRef(0),[Qe,gt]=d.useState(null),Ve=12e4;function bt(t,r,n,s){const a=t?.net_position??0,c=t?.price_basis??0,i=100,p=9900;let g=a,m=c;if(r==="bid")if(a<0){const S=Math.min(s,Math.abs(a)),C=s-S;g=a+S,C>0?(g+=C,m=n):g===0&&(m=0)}else g=a+s,m=a>0&&c>0?Math.round((a*c+s*n)/g):n;else if(a>0){const S=Math.min(s,a),C=s-S;g=a-S,C>0?(g-=C,m=n):g===0&&(m=0)}else g=a-s,m=a<0&&c>0?Math.round((Math.abs(a)*c+s*n)/Math.abs(g)):n;return g!==0&&m>0&&(m=Math.max(i,Math.min(p,m))),{net_position:g,price_basis:m}}function yt(t){const r=Math.floor((Date.now()-t)/1e3);if(r<10)return"just now";if(r<60)return`${r} sec ago`;const n=Math.floor(r/60);return n<60?`${n} min ago`:`${Math.floor(n/60)} hr ago`}function Ne(t,r){const n=t.indexOf(" Over ");if(n===-1)return r?t:e.jsx(e.Fragment,{children:t});const s=t.slice(0,n).trim(),a=t.slice(n+6).trim(),c=H[s],i=H[a],p=g=>e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",g,")"]});return r?`${s}${c!=null?` (${c})`:""} Over ${a}${i!=null?` (${i})`:""}`:e.jsxs(e.Fragment,{children:[s,c!=null&&p(c)," Over ",a,i!=null&&p(i)]})}d.useEffect(()=>{j&&I()},[j]),d.useEffect(()=>{y&&!y.view_market_maker&&l==="market_maker"&&T("bid")},[y?.view_market_maker,l]),d.useEffect(()=>{he&&Ae.current&&setTimeout(()=>{Ae.current?.focus()},100)},[he]),d.useEffect(()=>{he&&j&&Date.now()-ze.current>=Ve&&I()},[he,j]),d.useEffect(()=>{const t=()=>{document.visibilityState==="visible"&&j&&Date.now()-ze.current>=Ve&&I()};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[j]);async function I(t=!1){if(j){N(!0);try{const r=await R.getMarket(j,t?{cacheBust:!0}:void 0);if(Q(r?.market||null),P(r?.outcomes||[]),J(r?.orderbook||{}),ne(r?.trades??[]),_(r?.positions??[]),r?.market?.market_id==="market-individual-net-champion"||r?.market?.market_id==="market-h2h-matchups"?R.getHandicaps(2026).then(s=>{const a=("handicaps"in s?s.handicaps:{})??{};Object.keys(a).length>0?ge(a):R.getHandicaps(2025).then(c=>ge(("handicaps"in c?c.handicaps:{})??{})).catch(()=>ge({}))}).catch(()=>ge({})):ge({}),r.outcomes&&r.outcomes.length>0&&r.orderbook){const s=[...r.outcomes].sort((a,c)=>{const i=r.orderbook[a.outcome_id],p=r.orderbook[c.outcome_id],g=i?.bids?.[0],m=i?.asks?.[0],S=p?.bids?.[0],C=p?.asks?.[0],D=g&&m?(g.price+m.price)/2:g?.price||0;return(S&&C?(S.price+C.price)/2:S?.price||0)-D});!f&&s.length>0&&O(s[0].outcome_id)}}catch(r){console.error("Failed to load market:",r),o("Failed to load market data","error")}finally{N(!1),ze.current=Date.now(),gt(Date.now())}}}async function Ke(t){if(t.preventDefault(),!j||!f){o("Please select an outcome","error");return}const r=parseInt(Y,10);if(isNaN(r)||r<=0){o("Quantity must be at least 1","error");return}if(l==="market_maker"){const c=parseInt(ye,10),i=parseInt(fe,10);if(isNaN(c)||c<1||c>99){o("Bid price must be a whole number between $1 and $99","error");return}if(isNaN(i)||i<1||i>99){o("Ask price must be a whole number between $1 and $99","error");return}if(c>=i){o("Bid price must be less than ask price","error");return}je(!0);try{await R.placeOrder(j,{outcome_id:f,side:"bid",price:c*100,contract_size:r,tif:"GTC"}),await R.placeOrder(j,{outcome_id:f,side:"ask",price:i*100,contract_size:r,tif:"GTC"}),xe(""),ue(""),pe(""),o("Bid and ask placed","success"),await new Promise(p=>setTimeout(p,200)),await I(!0),le(!1)}catch(p){o(p?.message||"Failed to place orders","error"),await I(!0),o("Orderbook refreshed – please try again if needed.","info")}finally{je(!1)}return}const n=parseInt(q,10);if(isNaN(n)||n<1||n>99){o("Price must be a whole number between $1 and $99","error");return}const s=n*100,a=f&&F?.[f]||null;if(a&&y?.id){if(l==="bid"){if(a.asks.filter(i=>i.user_id===y.id&&(i.status==="open"||i.status==="partial")&&i.price<=s).length>0){o("Cannot place bid: You have existing sell orders at this price or better","error");return}}else if(a.bids.filter(i=>i.user_id===y.id&&(i.status==="open"||i.status==="partial")&&i.price>=s).length>0){o("Cannot place ask: You have existing buy orders at this price or better","error");return}}je(!0);try{const c=await R.placeOrder(j,{outcome_id:f,side:l,price:s,contract_size:r,tif:"GTC"});k(""),xe(""),V(null),o("Order placed successfully!","success");const i=c?.order,p=c?.fills??[],g=c?.trades??[],m=f,S=y?.id;if(i&&m&&S!=null){const C=typeof i.id=="string"?parseInt(i.id,10):i.id,D=i.price_cents??i.price??s,v=i.qty_remaining??i.contract_size??i.qty_contracts??r,te=i.status??"open",re=i.side==="ask"?1:0,se={id:C,create_time:i.created_at??Math.floor(Date.now()/1e3),user_id:S,token:"",order_id:C,outcome:m,price:D,status:te,tif:"GTC",side:re,contract_size:v,remaining_size:v};J(Ce=>{const K={...Ce},st=K[m]??{bids:[],asks:[]},Le=[...st.bids??[]],Ie=[...st.asks??[]],oe=re===0?Ie:Le;for(const W of p){const Me=typeof W.maker_order_id=="string"?parseInt(W.maker_order_id,10):W.maker_order_id,G=W.qty_contracts??W.qty??0,me=oe.findIndex(at=>at.id===Me);if(me>=0){const Fe=(oe[me].remaining_size??oe[me].contract_size??0)-G;Fe<=0?oe.splice(me,1):oe.splice(me,1,{...oe[me],contract_size:Fe,remaining_size:Fe,status:"partial"})}}if(te==="open"||te==="partial"){const W=re===0?Le:Ie,Me=re===0?W.findIndex(G=>G.price<D||G.price===D&&G.create_time>se.create_time):W.findIndex(G=>G.price>D||G.price===D&&G.create_time>se.create_time);Me===-1?W.push(se):W.splice(Me,0,se)}return K[m]={bids:Le,asks:Ie},K})}if(g.length>0&&m&&S!=null){let C=null;const D=(x??[]).find(v=>v.outcome===m);D&&(C={net_position:D.net_position,price_basis:D.price_basis});for(const v of g){const te=v.price_cents??v.price??0,re=v.qty_contracts??v.contracts??0;C=bt(C,l,te,re)}C!=null&&_(v=>{const te=v.findIndex(K=>K.outcome===m),re=D??{id:0,user_id:S,outcome:m,create_time:Math.floor(Date.now()/1e3),closed_profit:0,settled_profit:0,net_position:0,price_basis:0,is_settled:0,market_name:b?.short_name,outcome_name:h?.find(K=>K.outcome_id===m)?.name,outcome_ticker:h?.find(K=>K.outcome_id===m)?.ticker},se=[...v],Ce={...re,...C};return te>=0?se.splice(te,1,Ce):se.push(Ce),se})}if(g.length>0&&m){const C=h?.find(v=>v.outcome_id===m),D=g.map(v=>({id:typeof v.id=="string"?parseInt(v.id,10):v.id,token:v.token??"",price:v.price_cents??v.price??0,contracts:v.qty_contracts??v.contracts??0,create_time:v.created_at??v.create_time??Math.floor(Date.now()/1e3),risk_off_contracts:0,risk_off_price_diff:0,outcome:m,outcome_name:C?.name??null,outcome_ticker:C?.ticker??null,side:l==="bid"?0:1,taker_side:l==="bid"?0:1}));ne(v=>[...D,...v??[]])}I(!0)}catch(c){o(c.message||"Failed to place order","error"),I(!0),o("Orderbook refreshed – please try again if needed.","info")}finally{je(!1)}}function Ge(t,r){if(O(t),T("bid"),r){const n=Math.round(r/100),s=Math.max(1,Math.min(99,n));k(s.toString()),V("price"),setTimeout(()=>V(null),2e3)}le(!0)}function Xe(t,r){if(O(t),T("ask"),r){const n=Math.round(r/100),s=Math.max(1,Math.min(99,n));k(s.toString()),V("price"),setTimeout(()=>V(null),2e3)}le(!0)}function de(t){if(T(t),M){if(t==="bid"&&B){const r=Math.round(B.price/100),n=Math.max(1,Math.min(99,r));k(n.toString())}else if(t==="ask"&&A){const r=Math.round(A.price/100),n=Math.max(1,Math.min(99,r));k(n.toString())}else if(t==="market_maker"&&(B||A)){if(B){const r=Math.max(1,Math.min(99,Math.round(B.price/100)));ue(r.toString())}if(A){const r=Math.max(1,Math.min(99,Math.round(A.price/100)));pe(r.toString())}}}}const ft=(()=>{const t=(E||[]).reduce((n,s)=>n+(s.contracts||0),0),r=t*200;return{volume_contracts:t,volume_dollars:r}})(),L=(()=>{const t=parseInt(q,10)||0,r=parseInt(Y,10)||0,n=parseInt(ye,10)||0,s=parseInt(fe,10)||0;return{totalCost:l==="market_maker"?0:l==="bid"?t*r:r*(100-t),price:t,qty:r,mmBidPrice:n,mmAskPrice:s}})(),M=f&&F?.[f]||null,B=M?.bids?.[0],A=M?.asks?.[0];function Je(t){const r=t.market_name??b?.short_name??"N/A",n=h?.find(a=>a.outcome_id===t.outcome),s=t.outcome_ticker??t.outcome_name??n?.name??n?.ticker??t.outcome;return{marketName:r,outcomeLabel:s}}const Z=(x||[]).reduce((t,r)=>(t[r.outcome]={net_position:r.net_position,price_basis:r.price_basis},t),{}),_e=d.useMemo(()=>(x||[]).filter(t=>t.net_position!==0||(t.closed_profit??0)!==0||(t.settled_profit??0)!==0),[x]),we=(t,r)=>{const n=t>=0?"+":"",s=(r/100).toFixed(1);return`${n}${t} @ $${s}`},Ze=(t,r)=>r===null?null:t.net_position<0?(1e4-r)*Math.abs(t.net_position):t.net_position*r,ee=d.useMemo(()=>{if(!y?.id||!(ie==="orders"||Ue))return[];const t=[];for(const r of Object.values(F))for(const n of[...r.bids||[],...r.asks||[]])n.user_id===y.id&&(n.status==="open"||n.status==="partial")&&t.push(n);return t},[ie,Ue,F,y?.id]),be=d.useMemo(()=>!y?.id||!M?[]:[...M.bids||[],...M.asks||[]].filter(r=>r.user_id===y.id&&(r.status==="open"||r.status==="partial")),[y?.id,M]);async function kt(t){Re(t);try{await R.cancelOrder(t),o("Order canceled successfully","success"),await I(!0)}catch(r){console.error("Failed to cancel order:",r),o(r.message||"Failed to cancel order","error")}finally{Re(null)}}function et(t){Ye(t)}async function jt(){if(ee.length!==0){qe(!0);try{for(const t of ee)await R.cancelOrder(t.id);o("All orders in this market canceled","success"),await I(!0)}catch(t){console.error("Failed to cancel orders:",t),o(t.message||"Failed to cancel some orders","error")}finally{qe(!1)}}}function tt(){He(!0)}async function vt(){if(be.length!==0){We(!0),Be(!1);try{for(const t of be)await R.cancelOrder(t.id);o(`Canceled ${be.length} order(s) for this outcome`,"success"),await I(!0)}catch(t){console.error("Failed to cancel orders for outcome:",t),o(t?.message||"Failed to cancel some orders","error")}finally{We(!1)}}}function Nt(){Be(!0)}if(u)return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(it,{variant:"text",width:"200px",height:"32px"}),e.jsx(it,{variant:"rectangular",height:"400px",className:"rounded-lg"})]});if(!b)return e.jsx("div",{className:"text-center py-8",children:"Market not found"});const rt=(h||[]).length>0?[...h||[]].sort((t,r)=>{const n=F?.[t.outcome_id],s=F?.[r.outcome_id],a=n?.bids?.[0],c=n?.asks?.[0],i=s?.bids?.[0],p=s?.asks?.[0],g=a&&c?(a.price+c.price)/2:a?.price||0;return(i&&p?(i.price+p.price)/2:i?.price||0)-g}):[];return e.jsx(Ot,{onRefresh:I,children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(Pt,{toasts:$,removeToast:w}),e.jsx("div",{className:"flex items-center gap-2 sm:gap-4",children:e.jsxs("button",{onClick:()=>z("/markets"),className:"flex items-center gap-2 px-3 sm:px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800 transition touch-manipulation",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Markets"}),e.jsx("span",{className:"sm:hidden",children:"Back"})]})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-3 sm:mb-4",children:b.short_name}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-1 gap-3 sm:gap-4 mb-4 sm:mb-6",children:e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 sm:p-4 rounded-lg",children:[e.jsx("div",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Trading Volume"}),e.jsxs("div",{className:"text-sm sm:text-lg font-semibold",children:["$",ft.volume_dollars.toLocaleString()]})]})}),Qe!=null&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-gray-500 dark:text-gray-400 mb-2",children:[e.jsxs("span",{children:["Updated ",yt(Qe)]}),e.jsx("button",{type:"button",onClick:()=>I(),className:"text-primary-600 dark:text-primary-400 hover:underline font-medium",children:"Refresh"})]})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(Bt,{tabs:[{id:"outcomes",label:"Outcomes"},{id:"orders",label:"Orders"},{id:"trades",label:"Trades"},{id:"positions",label:"Positions"}],activeTab:ie,onTabChange:t=>xt(t)})}),e.jsxs("div",{className:"md:hidden",children:[ie==="outcomes"&&h&&h.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"w-full min-w-[320px] sm:min-w-[640px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[e.jsx("th",{className:"py-1.5 px-2 sm:py-2 sm:px-3 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:"Team"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Chance"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"No/Sell"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Yes/Buy"})]})}),e.jsx("tbody",{children:rt.map((t,r)=>{const n=F[t.outcome_id],s=n?.bids?.[0],a=n?.asks?.[0],c=s?s.price:null,i=s&&a?(s.price+a.price)/2:c||0,p=i?Math.round(i/1e4*100):0,g=f===t.outcome_id;return e.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer touch-manipulation transition-colors ${g?"bg-primary-50 dark:bg-primary-900/20 border-l-4 border-l-primary-600 dark:border-l-primary-400":""}`,onClick:()=>O(t.outcome_id),children:[e.jsx("td",{className:"py-1.5 px-2 sm:py-2 sm:px-3",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 w-4 sm:w-6 flex-shrink-0",children:r+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100 truncate",children:b?.market_id==="market-h2h-matchups"?Ne(t.name,!1):e.jsxs(e.Fragment,{children:[t.name,b?.market_id==="market-individual-net-champion"&&H[t.name]!=null&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",H[t.name],")"]})]})}),Z[t.outcome_id]&&(()=>{const{net_position:m}=Z[t.outcome_id],S=m>0;return e.jsx("span",{className:`inline-block mt-0.5 px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-bold ${S?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:we(Z[t.outcome_id].net_position,Z[t.outcome_id].price_basis)})})()]})]})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsxs("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:[p,"%"]})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:m=>{m.stopPropagation(),Xe(t.outcome_id,s?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 active:bg-purple-300 dark:active:bg-purple-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[s?U(s.price):"-",s?.contract_size!=null&&s.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",s.contract_size]})]})})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:m=>{m.stopPropagation(),Ge(t.outcome_id,a?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 active:bg-blue-300 dark:active:bg-blue-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[a?U(a.price):"-",a?.contract_size!=null&&a.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",a.contract_size]})]})})})]},t.id)})})]})})})}),ie==="orders"&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("h2",{className:"text-base font-bold",children:"Your open orders"}),ee.length>0&&e.jsx("button",{type:"button",onClick:tt,disabled:ve,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 disabled:opacity-50",children:ve?"Canceling…":"Cancel all"})]}),ee.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-8 text-center",children:"No open orders in this market. Place orders from the Outcomes tab."}):e.jsx("div",{className:"space-y-2",children:ee.map(t=>{const r=h?.find(c=>c.outcome_id===t.outcome)?.name??t.outcome,n=t.side===0?"Yes/Buy":"No/Sell",s=t.remaining_size??t.contract_size??0,a=Ee===t.id;return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 border border-gray-200 dark:border-gray-600 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate min-w-0 flex-1",children:r}),e.jsx("span",{className:`flex-shrink-0 px-2 py-0.5 rounded text-xs font-bold ${t.side===0?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:n}),e.jsxs("span",{className:"flex-shrink-0 text-gray-600 dark:text-gray-400",children:[U(t.price)," × ",s]}),e.jsx("button",{type:"button",onClick:()=>et(t.id),disabled:a,title:"Cancel order","aria-label":"Cancel order",className:"flex-shrink-0 px-2 py-1 text-lg font-bold text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded disabled:opacity-50 touch-manipulation",children:"×"})]},t.id)})})]}),ie==="trades"&&e.jsx("div",{className:"mt-4",children:u?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3].map(t=>e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"},t))}):E.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-8 text-center",children:"No recent trades"}):e.jsx("div",{className:"space-y-2",children:E.map(t=>{const r=t.taker_side??t.side,n=r===0,s=r===1,a=n?"Buy":s?"Sell":"—",c=n?"bg-green-600 text-white dark:bg-green-500 dark:text-white":s?"bg-red-600 text-white dark:bg-red-500 dark:text-white":"bg-gray-400 text-white dark:bg-gray-500 dark:text-white";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border border-gray-300 dark:border-gray-600 rounded text-sm",children:[e.jsx("span",{className:`flex-shrink-0 px-3 py-1 rounded-md text-sm font-bold uppercase ${c}`,"aria-label":a!=="—"?a:"Unknown side",children:a}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[t.outcome_ticker&&e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.outcome_ticker}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 flex-shrink-0",children:[t.contracts," @ ",X(t.price)]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium flex-shrink-0",children:nt(t.price,t.contracts,t.taker_side??t.side??0)})]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs whitespace-nowrap flex-shrink-0",children:t.create_time?dt(new Date(t.create_time*1e3),"M/d h:mm a"):"—"})]},t.id)})})}),ie==="positions"&&e.jsx("div",{className:"mt-4",children:u?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2].map(t=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded-lg"},t))}):_e.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-8 text-center",children:"No positions"}):e.jsx("div",{className:"space-y-3",children:_e.map(t=>{const r=t.net_position!==0,{marketName:n,outcomeLabel:s}=Je(t),a=t.current_price!==null&&t.current_price!==void 0?t.current_price:null,c=t.net_position*t.price_basis,i=r?Ze(t,a):null,p=r&&a!==null?t.net_position<0?(t.price_basis-a)*Math.abs(t.net_position):t.net_position*a-c:null,{riskCents:g,toProfitCents:m}=t.net_position<0?{riskCents:(1e4-t.price_basis)*Math.abs(t.net_position),toProfitCents:t.price_basis*Math.abs(t.net_position)}:{riskCents:t.price_basis*t.net_position,toProfitCents:(1e4-t.price_basis)*t.net_position};return e.jsx(lt,{className:"mb-3",children:e.jsxs(ct,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:n}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2",children:s}),r&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${t.net_position>0?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:we(t.net_position,t.price_basis)}),e.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",e.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:ae(g)})," | ","To Profit: ",e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:ae(m)})]})]})]}),r&&e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:i!==null?Pe(i):Pe(c)}),e.jsx("div",{className:`text-sm sm:text-base font-semibold ${p!==null?p>0?"text-green-600 dark:text-green-400":p<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:p!==null?e.jsxs(e.Fragment,{children:[p>0?"↑":p<0?"↓":""," ",X(Math.abs(p))]}):"—"})]})]}),t.closed_profit!=null&&t.closed_profit!==0||t.settled_profit!=null&&t.settled_profit!==0?e.jsxs("div",{className:"mt-3 -mx-4 sm:-mx-5 -mb-4 sm:-mb-5 px-4 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Closed profit: ",e.jsx("span",{className:`font-medium ${(t.closed_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ae(t.closed_profit??0)})]}),e.jsxs("span",{children:["Settled profit: ",e.jsx("span",{className:`font-medium ${(t.settled_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ae(t.settled_profit??0)})]})]}):null]})},t.id)})})})]}),e.jsxs("div",{className:"hidden md:block",children:[h&&h.length>0?e.jsx("div",{children:e.jsx("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"w-full min-w-[320px] sm:min-w-[640px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[e.jsx("th",{className:"py-1.5 px-2 sm:py-2 sm:px-3 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:"Team"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Chance"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"No/Sell"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Yes/Buy"})]})}),e.jsx("tbody",{children:rt.map((t,r)=>{const n=F[t.outcome_id],s=n?.bids?.[0],a=n?.asks?.[0],c=s?s.price:null,i=s&&a?(s.price+a.price)/2:c||0,p=i?Math.round(i/1e4*100):0,g=f===t.outcome_id;return e.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer touch-manipulation transition-colors ${g?"bg-primary-50 dark:bg-primary-900/20 border-l-4 border-l-primary-600 dark:border-l-primary-400":""}`,onClick:()=>O(t.outcome_id),children:[e.jsx("td",{className:"py-1.5 px-2 sm:py-2 sm:px-3",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 w-4 sm:w-6 flex-shrink-0",children:r+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100 truncate",children:b?.market_id==="market-h2h-matchups"?Ne(t.name,!1):e.jsxs(e.Fragment,{children:[t.name,b?.market_id==="market-individual-net-champion"&&H[t.name]!=null&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",H[t.name],")"]})]})}),Z[t.outcome_id]&&(()=>{const{net_position:m}=Z[t.outcome_id],S=m>0;return e.jsx("span",{className:`inline-block mt-0.5 px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-bold ${S?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:we(Z[t.outcome_id].net_position,Z[t.outcome_id].price_basis)})})()]})]})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsxs("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:[p,"%"]})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:m=>{m.stopPropagation(),Xe(t.outcome_id,s?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 active:bg-purple-300 dark:active:bg-purple-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[s?U(s.price):"-",s?.contract_size!=null&&s.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",s.contract_size]})]})})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsxs("button",{onClick:m=>{m.stopPropagation(),Ge(t.outcome_id,a?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 active:bg-blue-300 dark:active:bg-blue-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[a?U(a.price):"-",a?.contract_size!=null&&a.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",a.contract_size]})]})})})]},t.id)})})]})})})}):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No outcomes available for this market"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-6 mt-6",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3 sm:mb-4",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Orderbook"}),f&&M&&be.length>0&&e.jsx("button",{type:"button",onClick:Nt,disabled:ht,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 disabled:opacity-50 p-1.5 rounded touch-manipulation font-bold text-lg leading-none",title:"Cancel all your orders for this outcome","aria-label":"Cancel all your orders for this outcome",children:"×"})]}),f&&M?e.jsx(Te,{bids:M.bids,asks:M.asks,userId:y?.id,onPriceClick:(t,r)=>{const n=Math.round(t/100),s=Math.max(1,Math.min(99,n));k(s.toString()),T(r),V("price"),setTimeout(()=>V(null),2e3)},onCancelOrder:async t=>{try{await R.cancelOrder(t),o("Order canceled successfully","success"),await I(!0)}catch(r){console.error("Failed to cancel order:",r),o(r.message||"Failed to cancel order","error")}}}):e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"Select an outcome to view orderbook"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("button",{onClick:()=>le(!0),className:`md:hidden fixed bottom-20 right-4 z-30 text-white rounded-full p-4 shadow-lg touch-manipulation min-h-[56px] min-w-[56px] flex items-center justify-center ${l==="ask"?"bg-purple-600 hover:bg-purple-700 active:bg-purple-800":l==="market_maker"?"bg-primary-600 hover:bg-primary-700 active:bg-primary-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,"aria-label":l==="market_maker"?"Place order":l==="ask"?"Place sell order":"Place buy order",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:l==="market_maker"?"Place Order":l==="ask"?"Place Sell Order":"Place Buy Order"}),e.jsxs("form",{onSubmit:Ke,className:"space-y-3 sm:space-y-4",children:[h&&h.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Outcome"}),e.jsxs("select",{value:f,onChange:t=>O(t.target.value),required:!0,className:"w-full px-3 py-2.5 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 touch-manipulation",children:[e.jsx("option",{value:"",children:"Select an outcome"}),h.map(t=>e.jsx("option",{value:t.outcome_id,children:b?.market_id==="market-h2h-matchups"?Ne(t.name,!0):b?.market_id==="market-individual-net-champion"&&H[t.name]!=null?`${t.name} (${H[t.name]})`:t.name??t.ticker},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Side"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>de("ask"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-sm sm:text-base min-h-[44px] touch-manipulation ${l==="ask"?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["No/Sell ",B?`$${Math.round(B.price/100)}`:""]}),e.jsxs("button",{type:"button",onClick:()=>de("bid"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-sm sm:text-base min-h-[44px] touch-manipulation ${l==="bid"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["Yes/Buy ",A?`$${Math.round(A.price/100)}`:""]}),y?.view_market_maker&&e.jsx("button",{type:"button",onClick:()=>de("market_maker"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-sm sm:text-base min-h-[44px] touch-manipulation ${l==="market_maker"?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:"Market Maker"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Quantity"}),e.jsx("input",{type:"tel",inputMode:"numeric",min:"1",value:Y,onChange:t=>xe(t.target.value),required:!0,className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px]"})]}),l==="market_maker"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Bid price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:ye,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&ue(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Ask price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:fe,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&pe(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Price ($)"}),M&&(B||A)&&e.jsx("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-400",children:e.jsxs("span",{children:["Bid: ",B?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:U(B.price)})," × ",B.contract_size??"—"]}):"—"," | ","Ask: ",A?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:U(A.price)})," × ",A.contract_size??"—"]}):"—"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",step:"1",min:"1",max:"99",value:q,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&(k(r),V(null))},required:!0,className:`w-full pl-8 pr-4 py-3 text-base border rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px] ${Oe==="price"?"border-primary-500 ring-2 ring-primary-200 dark:ring-primary-800":"border-gray-300 dark:border-gray-600"}`})]}),Oe==="price"&&e.jsx("div",{className:"text-xs text-primary-600 dark:text-primary-400 mt-1",children:"Auto-filled from table"})]}),f&&M&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>Se(t=>!t),className:"text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1",children:[ce?"Hide orderbook":"View orderbook",e.jsx("svg",{className:`w-4 h-4 transition-transform ${ce?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),ce&&e.jsx("div",{className:"mt-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800/50 max-h-[200px] overflow-y-auto",children:e.jsx(Te,{bids:M.bids,asks:M.asks,userId:y?.id,onPriceClick:(t,r)=>{const n=Math.round(t/100),s=Math.max(1,Math.min(99,n));k(s.toString()),T(r)},onCancelOrder:async t=>{try{await R.cancelOrder(t),o("Order canceled successfully","success"),await I(!0)}catch(r){o(r?.message||"Failed to cancel order","error")}}})})]}),l==="market_maker"?L.qty>0&&L.mmBidPrice>0&&L.mmAskPrice>0&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Bid: $",L.mmBidPrice," × ",L.qty,", Ask: $",L.mmAskPrice," × ",L.qty]})}):q&&Y&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Estimated Total:"}),e.jsx("span",{className:"text-lg font-semibold",children:X(L.totalCost*100)})]})}),e.jsx("button",{type:"submit",disabled:ke,className:`w-full text-white font-medium py-3 px-4 rounded-md disabled:opacity-50 min-h-[44px] text-base touch-manipulation ${l==="ask"?"bg-purple-600 hover:bg-purple-700 active:bg-purple-800":l==="market_maker"?"bg-primary-600 hover:bg-primary-700 active:bg-primary-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,children:ke?"Placing...":l==="market_maker"?"Place both":l==="ask"?"Place Sell Order":"Place Buy Order"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Your open orders"}),ee.length>0&&e.jsx("button",{type:"button",onClick:tt,disabled:ve,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 disabled:opacity-50",children:ve?"Canceling…":"Cancel all"})]}),ee.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No open orders in this market."}):e.jsx("div",{className:"space-y-2",children:ee.map(t=>{const r=h?.find(c=>c.outcome_id===t.outcome)?.name??t.outcome,n=t.side===0?"Yes/Buy":"No/Sell",s=t.remaining_size??t.contract_size??0,a=Ee===t.id;return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 border border-gray-200 dark:border-gray-600 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate min-w-0 flex-1",children:r}),e.jsx("span",{className:`flex-shrink-0 px-2 py-0.5 rounded text-xs font-bold ${t.side===0?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:n}),e.jsxs("span",{className:"flex-shrink-0 text-gray-600 dark:text-gray-400",children:[U(t.price)," × ",s]}),e.jsx("button",{type:"button",onClick:()=>et(t.id),disabled:a,title:"Cancel order","aria-label":"Cancel order",className:"flex-shrink-0 px-2 py-1 text-lg font-bold text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded disabled:opacity-50",children:"×"})]},t.id)})})]}),_e.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"Your Positions"}),u?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2].map(t=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded-lg"},t))}):e.jsx("div",{className:"space-y-3",children:_e.map(t=>{const r=t.net_position!==0,{marketName:n,outcomeLabel:s}=Je(t),a=t.current_price!==null&&t.current_price!==void 0?t.current_price:null,c=t.net_position*t.price_basis,i=r?Ze(t,a):null,p=r&&a!==null?t.net_position<0?(t.price_basis-a)*Math.abs(t.net_position):t.net_position*a-c:null,{riskCents:g,toProfitCents:m}=t.net_position<0?{riskCents:(1e4-t.price_basis)*Math.abs(t.net_position),toProfitCents:t.price_basis*Math.abs(t.net_position)}:{riskCents:t.price_basis*t.net_position,toProfitCents:(1e4-t.price_basis)*t.net_position};return e.jsx(lt,{className:"mb-3",children:e.jsxs(ct,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:n}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2",children:s}),r&&e.jsxs(e.Fragment,{children:[e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${t.net_position>0?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:we(t.net_position,t.price_basis)}),e.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",e.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:ae(g)})," | ","To Profit: ",e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:ae(m)})]})]})]}),r&&e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:i!==null?Pe(i):Pe(c)}),e.jsx("div",{className:`text-sm sm:text-base font-semibold ${p!==null?p>0?"text-green-600 dark:text-green-400":p<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:p!==null?e.jsxs(e.Fragment,{children:[p>0?"↑":p<0?"↓":""," ",X(Math.abs(p))]}):"—"})]})]}),t.closed_profit!=null&&t.closed_profit!==0||t.settled_profit!=null&&t.settled_profit!==0?e.jsxs("div",{className:"mt-3 -mx-4 sm:-mx-5 -mb-4 sm:-mb-5 px-4 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{children:["Closed profit: ",e.jsx("span",{className:`font-medium ${(t.closed_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ae(t.closed_profit??0)})]}),e.jsxs("span",{children:["Settled profit: ",e.jsx("span",{className:`font-medium ${(t.settled_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:ae(t.settled_profit??0)})]})]}):null]})},t.id)})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"Recent Trades"}),u?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3].map(t=>e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"},t))}):!E||E.length===0?e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No trades yet"}):e.jsx("div",{className:"space-y-2",children:E.map(t=>{const r=t.taker_side??t.side,n=r===0,s=r===1,a=n?"Buy":s?"Sell":"—",c=n?"bg-green-600 text-white dark:bg-green-500 dark:text-white":s?"bg-red-600 text-white dark:bg-red-500 dark:text-white":"bg-gray-400 text-white dark:bg-gray-500 dark:text-white";return e.jsxs("div",{className:"flex items-center gap-3 p-2 sm:p-3 border border-gray-300 dark:border-gray-600 rounded text-xs sm:text-sm",children:[e.jsx("span",{className:`flex-shrink-0 px-3 py-1 rounded-md text-xs sm:text-sm font-bold uppercase ${c}`,"aria-label":a!=="—"?a:"Unknown side",children:a}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[t.outcome_ticker&&e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.outcome_ticker}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 flex-shrink-0",children:[t.contracts," @ ",X(t.price)]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium flex-shrink-0",children:nt(t.price,t.contracts,t.taker_side??t.side??0)})]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs whitespace-nowrap flex-shrink-0",children:t.create_time?dt(new Date(t.create_time*1e3),"M/d h:mm a"):"—"})]},t.id)})})]})]})]}),e.jsx($t,{isOpen:he,onClose:()=>{le(!1),k(""),xe(""),ue(""),pe(""),Se(!1)},title:l==="market_maker"?"Place Order":l==="ask"?"Place Sell Order":"Place Buy Order",children:e.jsxs("form",{onSubmit:t=>{Ke(t),le(!1)},className:"space-y-4",children:[h&&h.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Outcome"}),e.jsxs("select",{value:f,onChange:t=>O(t.target.value),required:!0,className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 touch-manipulation min-h-[44px]",children:[e.jsx("option",{value:"",children:"Select an outcome"}),h.map(t=>e.jsx("option",{value:t.outcome_id,children:b?.market_id==="market-h2h-matchups"?Ne(t.name,!0):b?.market_id==="market-individual-net-champion"&&H[t.name]!=null?`${t.name} (${H[t.name]})`:t.name??t.ticker},t.outcome_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Side"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>de("ask"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-base min-h-[44px] touch-manipulation ${l==="ask"?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["No/Sell ",B?`$${Math.round(B.price/100)}`:""]}),e.jsxs("button",{type:"button",onClick:()=>de("bid"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-base min-h-[44px] touch-manipulation ${l==="bid"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["Yes/Buy ",A?`$${Math.round(A.price/100)}`:""]}),y?.view_market_maker&&e.jsx("button",{type:"button",onClick:()=>de("market_maker"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-base min-h-[44px] touch-manipulation ${l==="market_maker"?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:"Market Maker"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Quantity"}),e.jsx("input",{ref:Ae,type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:"1",value:Y,onChange:t=>xe(t.target.value),required:!0,className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px]",placeholder:"Enter quantity"})]}),l==="market_maker"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Bid price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:ye,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&ue(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Ask price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:fe,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&pe(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Price ($)"}),M&&(B||A)&&e.jsx("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-400",children:e.jsxs("span",{children:["Bid: ",B?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:U(B.price)})," × ",B.contract_size??"—"]}):"—"," | ","Ask: ",A?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:U(A.price)})," × ",A.contract_size??"—"]}):"—"]})}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",step:"1",min:"1",max:"99",value:q,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&(k(r),V(null))},required:!0,className:`w-full pl-8 pr-4 py-3 text-base border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px] ${Oe==="price"?"border-primary-500 ring-2 ring-primary-500":"border-gray-300 dark:border-gray-600"}`,placeholder:"1-99"})]})]}),f&&M&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>Se(t=>!t),className:"text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1",children:[ce?"Hide orderbook":"View orderbook",e.jsx("svg",{className:`w-4 h-4 transition-transform ${ce?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),ce&&e.jsx("div",{className:"mt-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800/50 max-h-[200px] overflow-y-auto",children:e.jsx(Te,{bids:M.bids,asks:M.asks,userId:y?.id,onPriceClick:(t,r)=>{const n=Math.round(t/100),s=Math.max(1,Math.min(99,n));k(s.toString()),T(r)},onCancelOrder:async t=>{try{await R.cancelOrder(t),o("Order canceled successfully","success"),await I(!0)}catch(r){o(r?.message||"Failed to cancel order","error")}}})})]}),l==="market_maker"?L.qty>0&&L.mmBidPrice>0&&L.mmAskPrice>0&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Bid: $",L.mmBidPrice," × ",L.qty,", Ask: $",L.mmAskPrice," × ",L.qty]})}):q&&Y&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Estimated Total:"}),e.jsx("span",{className:"text-lg font-semibold",children:X(L.totalCost*100)})]})}),e.jsx("button",{type:"submit",disabled:ke,className:`w-full text-white font-medium py-3 px-4 rounded-md disabled:opacity-50 min-h-[44px] text-base touch-manipulation ${l==="ask"?"bg-purple-600 hover:bg-purple-700 active:bg-purple-800":l==="market_maker"?"bg-primary-600 hover:bg-primary-700 active:bg-primary-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,children:ke?"Placing...":l==="market_maker"?"Place both":l==="ask"?"Place Sell Order":"Place Buy Order"})]})}),e.jsx(De,{isOpen:$e!=null,onClose:()=>Ye(null),onConfirm:()=>{$e!=null&&kt($e)},title:"Cancel order",message:"Are you sure you want to cancel this order?",confirmLabel:"Cancel order",cancelLabel:"Keep",variant:"danger"}),e.jsx(De,{isOpen:ut,onClose:()=>He(!1),onConfirm:jt,title:"Cancel all orders",message:"Are you sure you want to cancel all open orders in this market?",confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"}),e.jsx(De,{isOpen:pt,onClose:()=>Be(!1),onConfirm:vt,title:"Cancel all orders for this outcome",message:`Cancel all ${be.length} open order(s) for this outcome?`,confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"}),e.jsx("div",{className:"md:hidden h-24"})]})})}export{qt as MarketDetail};
