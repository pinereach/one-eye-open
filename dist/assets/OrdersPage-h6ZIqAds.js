import{r,j as t,b as M,S as te,e as se,f as ae,L as re}from"./index-BI7Apl7Y.js";import{u as le}from"./useMarketTypeFilter-aWuPTr1i.js";import{P as ne}from"./PullToRefresh-DwZH6x_1.js";import{g as ie,f as ce}from"./format-BckxrTVz.js";import{C as oe,b as de}from"./Card-B9dr0X7x.js";import{E as me}from"./EmptyState-DGlOXlGk.js";import{u as xe,T as he}from"./Toast-BQPUFt-l.js";import{C as D}from"./ConfirmModal-IXtZuiZ-.js";import{f as H}from"./index-BAgxTVAR.js";import"./marketTypes-2i-psQO1.js";function ue({children:x,onSwipeLeft:m,onSwipeRight:w,leftAction:h,rightAction:u,className:b=""}){const[p,j]=r.useState(0),[f,y]=r.useState(!1),i=r.useRef(0),c=r.useRef(0),k=100,C=n=>{i.current=n.touches[0].clientX,c.current=i.current,y(!0)},S=n=>{if(!f)return;c.current=n.touches[0].clientX;const o=c.current-i.current;j(o)},z=()=>{if(!f)return;const n=c.current-i.current;Math.abs(n)>k&&(n>0&&w?w():n<0&&m&&m()),j(0),y(!1)},O=p<-k/2&&h,$=p>k/2&&u;return t.jsxs("div",{className:"relative overflow-hidden",children:[t.jsxs("div",{className:"absolute inset-0 flex",children:[h&&t.jsx("div",{className:`flex-1 bg-red-500 flex items-center justify-end pr-4 transition-opacity ${O?"opacity-100":"opacity-0"}`,children:h}),u&&t.jsx("div",{className:`flex-1 bg-green-500 flex items-center justify-start pl-4 transition-opacity ${$?"opacity-100":"opacity-0"}`,children:u})]}),t.jsx("div",{className:`relative transition-transform touch-manipulation ${b}`,style:{transform:`translateX(${p}px)`},onTouchStart:C,onTouchMove:S,onTouchEnd:z,children:x})]})}const pe=30,T=10,V=10;function Se(){const[x,m]=r.useState([]),[w,h]=r.useState(!0),[u,b]=r.useState(!1),[p,j]=r.useState(!1),[f,y]=r.useState(V),[i,c]=r.useState(null),[k,C]=r.useState(!1),{selectedMarketType:S,setSelectedMarketType:z,filteredItems:O,filterOptions:$}=le(x,e=>e.market_type??"other"),{toasts:n,showToast:o,removeToast:X}=xe();r.useEffect(()=>{N()},[]);async function N(e=!1){e||h(!0);try{const s=e?x.length:0,a=e?T:pe,{orders:g,hasMore:l}=await M.getAllOrders({limit:a,offset:s});e?m(E=>[...E,...g]):(m(g??[]),y(V)),j(l??!1)}catch(s){console.error("Failed to load orders:",s),o("Failed to load orders","error")}finally{h(!1),b(!1)}}async function Y(e){m(s=>s.map(a=>a.id===e?{...a,status:"canceled"}:a)),c(null);try{await M.cancelOrder(e),o("Order canceled successfully","success"),await N(!1)}catch(s){console.error("Failed to cancel order:",s),o(s.message||"Failed to cancel order","error"),await N(!1)}}async function L(e){c(e)}const v=O.filter(e=>e.status==="open"||e.status==="partial"),I=O.filter(e=>e.status==="filled"||e.status==="canceled"),A=I.slice(0,f),K=I.length>f||p;async function G(){if(I.length>f){y(e=>e+T);return}if(p){b(!0);try{const{orders:e,hasMore:s}=await M.getAllOrders({limit:T,offset:x.length});m(a=>[...a,...e??[]]),j(s??!1),y(a=>a+T)}catch(e){console.error("Failed to load more orders:",e),o("Failed to load more orders","error")}finally{b(!1)}}}async function Q(){try{const e=v.map(s=>M.cancelOrder(s.id));await Promise.all(e),o("All orders canceled successfully","success"),await N(!1)}catch(e){console.error("Failed to cancel orders:",e),o(e.message||"Failed to cancel all orders","error")}}function U(){C(!0)}const P=e=>{const s=e.side===1,a=s?"SELL ORDER":"BUY ORDER",g=s?"text-red-600 dark:text-red-400":"text-primary-600 dark:text-primary-400",l=e.original_size!==void 0&&e.original_size!==null?e.original_size:e.contract_size||0,E=e.remaining_size!==void 0&&e.remaining_size!==null?e.remaining_size:e.status==="filled"?0:l,_=Math.max(0,l-E),F=e.price?ie(e.price):"0.0%",Z=s?`Sell ${l} shares for ${F}`:`Buy ${l} shares for ${F}`,q=e.status==="filled"?`${l} of ${l} filled`:_>0&&_<l?`${_.toFixed(4)} of ${l} filled`:`${_} of ${l} filled`,J=e.create_time?H(new Date(e.create_time*1e3),"MM/dd/yy, h:mm:ss a"):"—",B=t.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 mb-3 border border-gray-300 dark:border-gray-600",children:[t.jsxs("div",{className:"flex items-center justify-between gap-4 mb-2",children:[t.jsx("div",{className:`font-bold text-sm ${g}`,children:a}),(e.status==="open"||e.status==="partial")&&t.jsx("button",{onClick:ee=>{ee.stopPropagation(),L(e.id)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-base font-bold p-1 touch-manipulation flex-shrink-0 rounded focus:outline-none focus:ring-2 focus:ring-primary-500",title:"Cancel order","aria-label":"Cancel order",children:"×"})]}),t.jsxs("div",{className:"flex items-stretch gap-4",children:[t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h3",{className:"font-bold text-sm sm:text-base text-gray-900 dark:text-gray-100 mb-1",children:e.market_name||"N/A"}),t.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:e.outcome_name||e.outcome}),t.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100",children:Z})]}),t.jsxs("div",{className:"flex flex-col items-end text-right flex-shrink-0",children:[t.jsx("p",{className:"text-sm text-gray-900 dark:text-gray-100 mb-1",children:q}),t.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:J})]})]})]});return e.status==="open"||e.status==="partial"?t.jsx(ue,{onSwipeLeft:()=>L(e.id),leftAction:t.jsx("span",{className:"text-white font-medium text-sm",children:"Cancel"}),children:B},e.id):t.jsx("div",{children:B},e.id)},W=e=>t.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700",children:[t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.create_time?H(new Date(e.create_time*1e3),"MMM d, yyyy h:mm a"):"—"}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.market_name||"N/A"}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.outcome_name||e.outcome}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center",children:t.jsx("span",{className:`text-xs sm:text-sm font-medium ${e.side===0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:e.side===0?"Buy":"Sell"})}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center font-medium text-xs sm:text-sm",children:e.price?ce(e.price):"—"}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-medium",children:e.original_size!==void 0&&e.original_size!==null?e.original_size:e.contract_size||0}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm",children:e.remaining_size!==void 0&&e.remaining_size!==null?e.remaining_size:e.status==="filled"?0:e.contract_size||0}),t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center",children:t.jsxs("div",{className:"flex items-center justify-center gap-2",children:[t.jsx("span",{className:`text-xs sm:text-sm px-2 py-1 rounded ${e.status==="filled"?"bg-green-100 dark:bg-green-900/30 text-green-800 dark:text-green-200":e.status==="open"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":e.status==="partial"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:e.status}),e.status==="open"||e.status==="partial"?t.jsx("button",{onClick:()=>L(e.id),className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-1 rounded touch-manipulation focus:outline-none focus:ring-2 focus:ring-primary-500",title:"Cancel order","aria-label":"Cancel order",children:"×"}):null]})})]},e.id),d="py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-bold text-gray-600 dark:text-gray-400 sticky top-0 z-10 bg-white dark:bg-gray-900 border-b border-gray-300 dark:border-gray-600",R=(e,s,a,g)=>t.jsx("div",{className:"overflow-x-auto -mx-3 sm:mx-0",children:t.jsx("div",{className:"inline-block min-w-full align-middle",children:t.jsxs("table",{className:"w-full min-w-[600px] border-collapse","aria-describedby":a,children:[t.jsx("caption",{id:a,className:"sr-only",children:g}),t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[t.jsx("th",{className:d,children:"Time"}),t.jsx("th",{className:d,children:"Market"}),t.jsx("th",{className:d,children:"Outcome"}),t.jsx("th",{className:d,children:"Side"}),t.jsx("th",{className:d,children:"Price"}),t.jsx("th",{className:d,children:"Qty"}),t.jsx("th",{className:d,children:"Remaining"}),t.jsx("th",{className:d,children:"Status"})]})}),t.jsx("tbody",{children:e.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:8,className:"py-8 text-center text-gray-500 dark:text-gray-400 text-xs sm:text-sm",children:s})}):e.map(W)})]})})});return w?t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(te,{variant:"text",width:"200px",height:"32px"}),t.jsx("div",{className:"md:hidden space-y-3",children:[1,2,3].map(e=>t.jsx(se,{},e))}),t.jsx("div",{className:"hidden md:block",children:t.jsx(ae,{rows:5,cols:8})})]}):t.jsxs(ne,{onRefresh:N,children:[t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(he,{toasts:n,removeToast:X}),x.length>0&&t.jsxs("div",{className:"space-y-2",role:"group","aria-label":"Filter by market type",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 block",children:"Market type"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:$.map(e=>t.jsx("button",{type:"button",onClick:()=>z(e.value),"aria-pressed":S===e.value,className:`min-h-[32px] px-2.5 py-1 rounded-full text-xs font-medium touch-manipulation transition-colors ${S===e.value?"bg-primary-600 text-white dark:bg-primary-500":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500"}`,children:e.label},e.value))})]}),t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100",children:"Open Orders"}),v.length>0&&t.jsx("button",{onClick:U,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 touch-manipulation transition-colors","aria-label":"Cancel all orders",children:"Cancel All"})]}),t.jsx("div",{className:"md:hidden space-y-3",children:v.length===0?t.jsx(me,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"})}),title:"No Open Orders",message:"You don't have any open orders at the moment. Place an order from a market to get started.",action:t.jsx(re,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):v.map(P)}),t.jsx("div",{className:"hidden md:block",children:R(v,"No open orders","orders-open-caption","Open orders")})]}),t.jsxs("div",{className:"space-y-3 sm:space-y-4",children:[t.jsx("h2",{className:"text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100",children:"Order History"}),t.jsx("div",{className:"md:hidden space-y-3",children:A.length===0?t.jsx(oe,{children:t.jsx(de,{children:t.jsx("p",{className:"text-center text-gray-500 dark:text-gray-400 text-sm py-4",children:"No completed orders"})})}):A.map(P)}),t.jsx("div",{className:"hidden md:block",children:R(A,"No completed orders","orders-history-caption","Order history")}),K&&t.jsx("div",{className:"flex justify-center pt-2",children:t.jsx("button",{type:"button",onClick:G,disabled:u,className:"px-4 py-2 text-sm font-medium text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded-lg border border-primary-300 dark:border-primary-700 touch-manipulation disabled:opacity-50 transition-colors","aria-label":"Show more orders",children:u?"Loading…":"Show more"})})]})]}),t.jsx(D,{isOpen:i!=null,onClose:()=>c(null),onConfirm:()=>{i!=null&&Y(i)},title:"Cancel order",message:"Are you sure you want to cancel this order?",confirmLabel:"Cancel order",cancelLabel:"Keep",variant:"danger"}),t.jsx(D,{isOpen:k,onClose:()=>C(!1),onConfirm:Q,title:"Cancel all orders",message:"Are you sure you want to cancel all open orders?",confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"})]})}export{Se as OrdersPage};
