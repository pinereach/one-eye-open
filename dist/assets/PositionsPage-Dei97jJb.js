import{a as S,r as c,b as L,j as t,L as g}from"./index-C1dm45FS.js";import{P as T}from"./PullToRefresh-40oAfJLQ.js";import{f as k,c as d,d as b}from"./format-CS6GGukx.js";import{C as V,b as B}from"./Card-CYUyGTvw.js";import{E as _}from"./EmptyState-CpQf5JjL.js";import{S as E,a as A,b as F}from"./Skeleton-oBsk8Cmj.js";function O(){const j=S(),[x,y]=c.useState([]),[v,m]=c.useState(!0);c.useEffect(()=>{h()},[]);async function h(){m(!0);try{const{positions:e}=await L.getAllPositions();y(e)}catch(e){console.error("Failed to load positions:",e)}finally{m(!1)}}const i=x.reduce((e,s)=>{let r=0;if(s.net_position!==0){const n=s.current_price!==null&&s.current_price!==void 0?s.current_price:null;if(n!==null){const o=s.net_position*s.price_basis;r=s.net_position<0?(s.price_basis-n)*Math.abs(s.net_position):s.net_position*n-o}}return r+=(s.closed_profit??0)+(s.settled_profit??0),e+r},0),l=x.filter(e=>e.net_position!==0||(e.closed_profit??0)!==0||(e.settled_profit??0)!==0),N=(e,s)=>s===null?null:e.net_position<0?(1e4-s)*Math.abs(e.net_position):e.net_position*s,p=e=>{const s=e.net_position!==0,r=e.current_price!==null&&e.current_price!==void 0?e.current_price:null,n=e.net_position*e.price_basis,o=s?N(e,r):null,a=s&&r!==null?e.net_position<0?(e.price_basis-r)*Math.abs(e.net_position):e.net_position*r-n:null,C=()=>{e.market_id&&j(`/markets/${e.market_id}`)},u=e.closed_profit??0,f=e.settled_profit??0,P=e.net_position>0,w=`${e.net_position>=0?"+":""}${e.net_position} @ $${(e.price_basis/100).toFixed(1)}`,{riskCents:M,toProfitCents:$}=e.net_position<0?{riskCents:(1e4-e.price_basis)*Math.abs(e.net_position),toProfitCents:e.price_basis*Math.abs(e.net_position)}:{riskCents:e.price_basis*e.net_position,toProfitCents:(1e4-e.price_basis)*e.net_position};return t.jsx(V,{className:"mb-3",onClick:e.market_id?C:void 0,hover:!!e.market_id,children:t.jsxs(B,{children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[t.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:e.outcome_name||e.outcome_ticker||e.outcome}),t.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2",children:e.market_name||"N/A"}),s&&t.jsxs(t.Fragment,{children:[t.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${P?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:w}),t.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",t.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:d(M)})," | ","To Profit: ",t.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:d($)})]})]})]}),s&&t.jsxs("div",{className:"flex flex-col items-end text-right",children:[t.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:o!==null?b(o):b(n)}),t.jsx("div",{className:`text-sm sm:text-base font-semibold ${a!==null?a>0?"text-green-600 dark:text-green-400":a<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:a!==null?t.jsxs(t.Fragment,{children:[a>0?"↑":a<0?"↓":""," ",k(Math.abs(a))]}):"—"})]})]}),t.jsxs("div",{className:"mt-3 -mx-4 sm:-mx-5 -mb-4 sm:-mb-5 px-4 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[t.jsxs("span",{children:["Closed profit: ",t.jsx("span",{className:`font-medium ${u>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:d(u)})]}),t.jsxs("span",{children:["Settled profit: ",t.jsx("span",{className:`font-medium ${f>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:d(f)})]})]})]})},e.id)};return v?t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(E,{variant:"text",width:"200px",height:"32px"}),t.jsx("div",{className:"md:hidden space-y-3",children:[1,2,3].map(e=>t.jsx(A,{},e))}),t.jsx("div",{className:"hidden md:block",children:t.jsx(F,{rows:5,cols:8})})]}):t.jsx(T,{onRefresh:h,children:t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Positions"}),l.length>0&&t.jsxs("div",{className:"flex flex-col gap-0.5",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Portfolio value"}),t.jsxs("span",{className:`text-lg sm:text-xl font-bold ${i>0?"text-green-600 dark:text-green-400":i<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:[i>0?"+":"",k(i)]})]}),t.jsx("div",{className:"md:hidden space-y-3",children:l.length===0?t.jsx(_,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),title:"No Positions",message:"You don't have any open positions. Trade on a market to open a position.",action:t.jsx(g,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):l.map(p)}),t.jsx("div",{className:"hidden md:block space-y-3",children:l.length===0?t.jsx(_,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),title:"No Positions",message:"You don't have any open positions. Trade on a market to open a position.",action:t.jsx(g,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):l.map(p)})]})})}export{O as PositionsPage};
