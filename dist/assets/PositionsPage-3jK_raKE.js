import{a as E,r as o,b as R,j as t,S as z,e as A,f as H,L as v}from"./index-B3XxyNti.js";import{u as W}from"./useMarketTypeFilter-Cr1Vuji6.js";import{P as Y}from"./PullToRefresh-C_CF9m5O.js";import{e as k,a as x,d as c,f as D}from"./format-BckxrTVz.js";import{C as G,b as I}from"./Card-CgWny1CJ.js";import{E as C}from"./EmptyState-CFBPZpvA.js";import"./marketTypes-2i-psQO1.js";function ee(){const P=E(),[u,w]=o.useState([]),[M,f]=o.useState(!0),y=o.useMemo(()=>u.filter(e=>e.net_position!==0||(e.closed_profit??0)!==0||(e.settled_profit??0)!==0),[u]),{selectedMarketType:b,setSelectedMarketType:$,filteredItems:a,filterOptions:S}=W(y,e=>e.market_type??"other");o.useEffect(()=>{j()},[]);async function j(){f(!0);try{const{positions:e}=await R.getAllPositions();w(e)}catch(e){console.error("Failed to load positions:",e)}finally{f(!1)}}const m=a.reduce((e,s)=>{if(s.net_position===0||s.settled_price!=null||s.is_settled)return e;const r=s.current_price!==null&&s.current_price!==void 0?s.current_price:null;if(r===null)return e;const l=s.net_position*s.price_basis,h=s.net_position<0?(s.price_basis-r)*Math.abs(s.net_position):s.net_position*r-l;return e+h},0),p=a.reduce((e,s)=>e+(s.closed_profit??0),0),g=a.reduce((e,s)=>e+(s.settled_profit??0),0),_=o.useMemo(()=>{const e={};for(const s of a){const r=s.market_id??s.market_name??"other",l=s.market_name??s.market_id??"Other";e[r]||(e[r]={marketLabel:l,positions:[]}),e[r].positions.push(s)}return Object.entries(e)},[a]),T=(e,s)=>s===null?null:e.net_position<0?(1e4-s)*Math.abs(e.net_position):e.net_position*s,N=e=>{const s=e.net_position!==0,r=e.current_price!==null&&e.current_price!==void 0?e.current_price:null,l=e.net_position*e.price_basis,h=s?T(e,r):null,n=s&&r!==null?e.net_position<0?(e.price_basis-r)*Math.abs(e.net_position):e.net_position*r-l:null,L=()=>{e.market_id&&P(`/markets/${e.market_id}`)},i=e.closed_profit??0,d=e.settled_profit??0,B=e.net_position>0,V=`${e.net_position>=0?"+":""}${e.net_position} @ ${c(e.price_basis)}`,{riskCents:F,toProfitCents:O}=e.net_position<0?{riskCents:(1e4-e.price_basis)*Math.abs(e.net_position),toProfitCents:e.price_basis*Math.abs(e.net_position)}:{riskCents:e.price_basis*e.net_position,toProfitCents:(1e4-e.price_basis)*e.net_position};return t.jsx(G,{className:"mb-3",onClick:e.market_id?L:void 0,hover:!!e.market_id,children:t.jsxs(I,{children:[t.jsxs("div",{className:"flex items-start justify-between",children:[t.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[t.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:e.outcome_name||e.outcome_ticker||e.outcome}),s?t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"inline-flex items-center gap-2 flex-wrap",children:[t.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${B?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:V}),(i!==0||d!==0)&&t.jsxs("span",{className:`text-xs font-medium ${i+d>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[i+d>=0?"+":"",x(i+d)]})]}),t.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",t.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:c(F)})," | ","To Profit: ",t.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:c(O)})]})]}):t.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700/50",children:"No Open Position"})]}),s&&t.jsxs("div",{className:"flex flex-col items-end text-right",children:[t.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:h!==null?k(h):k(l)}),t.jsx("div",{className:`text-sm sm:text-base font-semibold ${n!==null?n>0?"text-green-600 dark:text-green-400":n<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:n!==null?t.jsxs(t.Fragment,{children:[n>0?"↑":n<0?"↓":""," ",D(Math.abs(n))]}):"—"})]})]}),t.jsxs("div",{className:"mt-3 -mx-4 sm:-mx-5 -mb-4 sm:-mb-5 px-4 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap items-center justify-between gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[t.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1",children:[t.jsxs("span",{children:["Closed profit: ",t.jsx("span",{className:`font-medium ${i>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:x(i)})]}),t.jsxs("span",{children:["Settled profit: ",t.jsx("span",{className:`font-medium ${d>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:x(d)})]})]}),t.jsx("div",{className:"text-right shrink-0",children:e.settled_price!=null?`Settled @ ${c(e.settled_price)}`:`Bid: ${e.best_bid!=null?c(e.best_bid):"—"} | Ask: ${e.best_ask!=null?c(e.best_ask):"—"}`})]})]})},e.id)};return M?t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx(z,{variant:"text",width:"200px",height:"32px"}),t.jsx("div",{className:"md:hidden space-y-3",children:[1,2,3].map(e=>t.jsx(A,{},e))}),t.jsx("div",{className:"hidden md:block",children:t.jsx(H,{rows:5,cols:8})})]}):t.jsx(Y,{onRefresh:j,children:t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Positions"}),a.length>0&&t.jsxs("div",{className:"flex flex-wrap items-stretch gap-x-6 gap-y-3",children:[t.jsxs("div",{className:"flex flex-1 min-w-[120px] flex-col gap-0.5",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Unrealized Gain"}),t.jsxs("span",{className:`text-lg sm:text-xl font-bold ${m>0?"text-green-600 dark:text-green-400":m<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:[m>0?"+":"",k(m)]})]}),t.jsxs("div",{className:"flex flex-1 min-w-[120px] flex-col gap-0.5",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Closed profit"}),t.jsxs("span",{className:`text-lg sm:text-xl font-bold ${p>0?"text-green-600 dark:text-green-400":p<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:[p>0?"+":"",x(p)]})]}),t.jsxs("div",{className:"flex flex-1 min-w-[120px] flex-col gap-0.5",children:[t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Settled profit"}),t.jsxs("span",{className:`text-lg sm:text-xl font-bold ${g>0?"text-green-600 dark:text-green-400":g<0?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-gray-100"}`,children:[g>0?"+":"",x(g)]})]})]}),y.length>0&&t.jsxs("div",{className:"space-y-2",role:"group","aria-label":"Filter by market type",children:[t.jsx("span",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 block",children:"Market type"}),t.jsx("div",{className:"flex flex-wrap gap-2",children:S.map(e=>t.jsx("button",{type:"button",onClick:()=>$(e.value),"aria-pressed":b===e.value,className:`min-h-[32px] px-2.5 py-1 rounded-full text-xs font-medium touch-manipulation transition-colors ${b===e.value?"bg-primary-600 text-white dark:bg-primary-500":"bg-gray-200 text-gray-700 hover:bg-gray-300 dark:bg-gray-600 dark:text-gray-200 dark:hover:bg-gray-500"}`,children:e.label},e.value))})]}),t.jsx("div",{className:"md:hidden space-y-6",children:a.length===0?t.jsx(C,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),title:"No Positions",message:"You don't have any open positions. Trade on a market to open a position.",action:t.jsx(v,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):_.map(([e,{marketLabel:s,positions:r}])=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-sm font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide sticky top-0 bg-white dark:bg-gray-900 py-1 z-10",children:s}),t.jsx("div",{className:"space-y-3",children:r.map(N)})]},e))}),t.jsx("div",{className:"hidden md:block space-y-6",children:a.length===0?t.jsx(C,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),title:"No Positions",message:"You don't have any open positions. Trade on a market to open a position.",action:t.jsx(v,{to:"/markets",className:"text-primary-600 dark:text-primary-400 font-medium hover:underline",children:"Browse markets"})}):_.map(([e,{marketLabel:s,positions:r}])=>t.jsxs("div",{className:"space-y-2",children:[t.jsx("h2",{className:"text-sm font-bold text-gray-600 dark:text-gray-400 uppercase tracking-wide",children:s}),t.jsx("div",{className:"space-y-3",children:r.map(N)})]},e))})]})})}export{ee as PositionsPage};
