import{u as G,r as c,j as t,N as Q,b as N}from"./index-ctqCthlT.js";import{C as U,a as X,b as Z}from"./Card-DlpZWXVl.js";import{E as ee}from"./EmptyState-htKDusG6.js";function se(){const{user:S}=G(),[u,F]=c.useState("all"),[m,M]=c.useState("all"),[D,K]=c.useState([]),[V,C]=c.useState({}),[W,w]=c.useState(!0),[f,I]=c.useState(!1),[b,T]=c.useState(!1),[v,z]=c.useState(!1),[y,h]=c.useState(null),x=["Loop","Boose","Krass","TK","CTH","Avayou","Alex","Huffman","Jon","Tim","Doc","Will"];if(S&&!S.view_scores)return t.jsx(Q,{to:"/markets",replace:!0});c.useEffect(()=>{E()},[u,m]),c.useEffect(()=>{N.getHandicaps("all").then(e=>C(("handicapsByYear"in e?e.handicapsByYear:{})??{})).catch(()=>C({}))},[]);async function E(){w(!0);try{const{scores:e}=await N.getScores(u!=="all"?u:void 0,m!=="all"?m:void 0);K(e||[])}catch(e){console.error("Failed to load scores:",e)}finally{w(!1)}}const O=()=>{const e=new Map;return D.forEach(a=>{const r=`${a.course}-${a.year}`;e.has(r)||e.set(r,{course:a.course,year:a.year});const s=e.get(r);s[a.player]=a.score}),e.forEach(a=>{x.forEach(r=>{r in a||(a[r]=null)})}),Array.from(e.values())},A=(e,a)=>V[String(e)]?.[a]??null,j=O(),R=Array.from(new Set(j.map(e=>e.course))).filter(e=>typeof e=="string"),J=Array.from(new Set(j.map(e=>e.year))).filter(e=>typeof e=="number").sort((e,a)=>a-e),d=j.filter(e=>!(u!=="all"&&e.course!==u||m!=="all"&&e.year!==parseInt(m))),P=x.map(e=>{const a=d.map(s=>s[e]).filter(s=>s!=null),r=a.length>0?a.reduce((s,l)=>s+l,0)/a.length:null;return{player:e,avg:r,count:a.length}}),B=(()=>{const e=new Map;return d.forEach(a=>{x.forEach(r=>{const s=a[r];if(s!=null){const l=a.year;e.has(l)||e.set(l,[]),e.get(l).push(s)}})}),Array.from(e.entries()).map(([a,r])=>({year:a,avg:r.reduce((s,l)=>s+l,0)/r.length,count:r.length})).sort((a,r)=>r.year-a.year)})(),Y=(()=>{const e=new Map;return d.forEach(a=>{const r=a.course;x.forEach(s=>{const l=a[s];l!=null&&(e.has(r)||e.set(r,[]),e.get(r).push(l))})}),Array.from(e.entries()).map(([a,r])=>({course:a,avg:r.reduce((s,l)=>s+l,0)/r.length,count:r.length})).sort((a,r)=>a.course.localeCompare(r.course))})(),_=new Date().getFullYear(),g=e=>e<_,$=(e,a,r)=>`${e}-${a}-${r}`,q=async(e,a,r,s)=>{if(a===null||g(a))return;const l=s===""?null:parseInt(s,10);if(!(isNaN(l)&&s!==""))try{await N.updateScoreValue({course:e,year:a,player:r,score:l}),await E()}catch(o){console.error("Failed to update score:",o)}},H=(e,a,r,s,l)=>{if(g(a))return;const o=l==null?"":String(l);if(s===o){h(null);return}q(e,a,r,s),h(null)};return W?t.jsx("div",{className:"text-center py-8",children:"Loading scores..."}):t.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[t.jsx("h1",{className:"text-xl sm:text-2xl font-bold",children:"Scoring"}),t.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 sm:gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Course"}),t.jsxs("select",{value:u,onChange:e=>F(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:[t.jsx("option",{value:"all",children:"All Courses"}),R.map(e=>t.jsx("option",{value:String(e),children:e},e))]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Year"}),t.jsxs("select",{value:m,onChange:e=>M(e.target.value),className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px] touch-manipulation",children:[t.jsx("option",{value:"all",children:"All Years"}),J.map(e=>t.jsx("option",{value:e.toString(),children:e},e))]})]})]}),d.length>0&&t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg overflow-hidden",children:[t.jsxs("button",{type:"button",onClick:()=>I(e=>!e),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors","aria-expanded":f,children:[t.jsx("h2",{className:"text-sm font-bold",children:"Average Scores"}),t.jsx("svg",{className:`w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform ${f?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),f&&t.jsx("div",{className:"px-4 pb-4 pt-0",children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:P.filter(e=>e.count>0).sort((e,a)=>(e.avg||0)-(a.avg||0)).map(({player:e,avg:a,count:r})=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e}),t.jsx("div",{className:"text-lg font-semibold",children:a?.toFixed(1)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:["(",r," rounds)"]})]},e))})})]}),d.length>0&&B.length>0&&t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg overflow-hidden",children:[t.jsxs("button",{type:"button",onClick:()=>T(e=>!e),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors","aria-expanded":b,children:[t.jsx("h2",{className:"text-sm font-bold",children:"Average Scores by Year"}),t.jsx("svg",{className:`w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform ${b?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),b&&t.jsx("div",{className:"px-4 pb-4 pt-0",children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:B.map(({year:e,avg:a,count:r})=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e}),t.jsx("div",{className:"text-lg font-semibold",children:a.toFixed(1)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:["(",r," rounds)"]})]},e))})})]}),d.length>0&&Y.length>0&&t.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800 rounded-lg overflow-hidden",children:[t.jsxs("button",{type:"button",onClick:()=>z(e=>!e),className:"w-full flex items-center justify-between p-4 text-left hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors","aria-expanded":v,children:[t.jsx("h2",{className:"text-sm font-bold",children:"Average Scores by Course"}),t.jsx("svg",{className:`w-5 h-5 text-gray-500 dark:text-gray-400 transition-transform ${v?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":!0,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),v&&t.jsx("div",{className:"px-4 pb-4 pt-0",children:t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:Y.map(({course:e,avg:a,count:r})=>t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:e}),t.jsx("div",{className:"text-lg font-semibold",children:a.toFixed(1)}),t.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-500",children:["(",r," rounds)"]})]},e))})})]}),t.jsx("div",{className:"md:hidden space-y-4",children:d.length===0?t.jsx(ee,{icon:t.jsx("svg",{className:"w-16 h-16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),title:"No Data Available",message:"Try adjusting your filters to see more results."}):d.map((e,a)=>t.jsxs(U,{children:[t.jsx(X,{children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsx("h3",{className:"font-bold text-base text-gray-900 dark:text-gray-100",children:e.course}),t.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.year})]})}),t.jsx(Z,{children:t.jsx("div",{className:"grid grid-cols-2 gap-3",children:x.map(r=>{const s=e[r],l=A(e.year,r),o=$(e.course,e.year,r),i=y?.key===o?y.value:s==null?"":String(s);return t.jsxs("div",{className:"flex flex-col items-center",children:[t.jsx("label",{className:"text-xs text-gray-600 dark:text-gray-400 mb-1 w-full text-center",children:r}),t.jsx("input",{type:"number",value:i,readOnly:g(e.year),onFocus:()=>!g(e.year)&&h({key:o,value:s==null?"":String(s)}),onChange:n=>y?.key===o&&h(p=>p?{...p,value:n.target.value}:null),onBlur:n=>H(e.course,e.year,r,n.target.value,s),className:`w-full text-center text-sm border border-gray-300 dark:border-gray-600 rounded px-2 py-2 min-h-[44px] ${g(e.year)?"bg-gray-100 dark:bg-gray-800 cursor-not-allowed text-gray-500 dark:text-gray-400":"focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 "+(s==null&&i===""?"text-gray-400 dark:text-gray-600":(()=>{const n=i===""?null:parseInt(i,10);return n!==null&&!isNaN(n)&&n<85?"text-green-600 dark:text-green-400 font-semibold":n!==null&&!isNaN(n)&&n<95?"text-blue-600 dark:text-blue-400":"text-gray-900 dark:text-gray-100"})())}`,placeholder:"—",min:"0",max:"200",inputMode:"numeric"}),l!=null&&t.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 text-center w-full mt-0.5",title:"Handicap index",children:l})]},r)})})})]},`${e.course}-${e.year}-${a}`))}),t.jsx("div",{className:"hidden md:block overflow-x-auto -mx-3 sm:mx-0",children:t.jsx("div",{className:"inline-block min-w-full align-middle",children:t.jsxs("table",{className:"w-full min-w-[1000px] border-collapse","aria-describedby":"scores-table-caption",children:[t.jsx("caption",{id:"scores-table-caption",className:"sr-only",children:"Scores by course and year. Number under each score is handicap index for that year."}),t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800",children:[t.jsx("th",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-bold text-gray-600 dark:text-gray-400 sticky left-0 bg-gray-50 dark:bg-gray-800 z-10",children:"Course"}),t.jsx("th",{className:"py-3 px-2 sm:px-3 text-center text-xs sm:text-sm font-bold text-gray-600 dark:text-gray-400",children:"Year"}),x.map(e=>t.jsx("th",{className:"py-3 px-2 sm:px-3 text-center text-xs sm:text-sm font-bold text-gray-600 dark:text-gray-400 min-w-[60px]",children:e},e))]})}),t.jsx("tbody",{children:d.length===0?t.jsx("tr",{children:t.jsx("td",{colSpan:x.length+2,className:"py-8 text-center text-gray-500 dark:text-gray-400",children:"No data available for selected filters"})}):d.map((e,a)=>t.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800",children:[t.jsx("td",{className:"py-3 px-3 sm:px-4 text-center text-xs sm:text-sm font-medium sticky left-0 bg-white dark:bg-gray-900 z-10",children:e.course}),t.jsx("td",{className:"py-3 px-2 sm:px-3 text-center text-xs sm:text-sm",children:e.year}),x.map(r=>{const s=e[r],l=A(e.year,r),o=$(e.course,e.year,r),i=y?.key===o?y.value:s==null?"":String(s),n=i===""?null:parseInt(i,10),p=(n===null||isNaN(n))&&i===""?"text-gray-400 dark:text-gray-600":n!==null&&!isNaN(n)&&n<85?"text-green-600 dark:text-green-400 font-semibold":n!==null&&!isNaN(n)&&n<95?"text-blue-600 dark:text-blue-400":"text-gray-900 dark:text-gray-100";return t.jsx("td",{className:"py-1 px-1 sm:py-2 sm:px-2 text-center align-top",children:t.jsxs("div",{className:"flex flex-col items-center gap-0.5",children:[t.jsx("input",{type:"number",value:i,readOnly:g(e.year),onFocus:()=>!g(e.year)&&h({key:o,value:s==null?"":String(s)}),onChange:k=>y?.key===o&&h(L=>L?{...L,value:k.target.value}:null),onBlur:k=>H(e.course,e.year,r,k.target.value,s),className:`w-full text-center text-sm sm:text-base border border-gray-300 dark:border-gray-600 rounded px-2 py-2 min-h-[44px] ${g(e.year)?"bg-gray-100 dark:bg-gray-800 cursor-not-allowed text-gray-500 dark:text-gray-400":`focus:border-primary-500 focus:outline-none focus:ring-1 focus:ring-primary-500 bg-white dark:bg-gray-700 ${p}`}`,placeholder:"—",min:"0",max:"200"}),l!=null&&t.jsx("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 text-center w-full",title:"Handicap index",children:l})]})},r)})]},`${e.course}-${e.year}-${a}`))})]})})})]})}export{se as HistoricalScoringPage};
