import{r as c,j as e,d as Gt,a as Xt,u as Jt,b as W,S as Ot,L as Zt}from"./index-TZG4_3K7.js";import{f as ae,a as U,b as z,c as $t,d as J,e as Ee}from"./format-BckxrTVz.js";import{u as er,T as tr}from"./Toast-B2PSxfcT.js";import{C as qe}from"./ConfirmModal-BcQTNnnT.js";import{P as rr}from"./PullToRefresh-6Syv5odM.js";import{C as Bt,b as At}from"./Card-D6-vXBHv.js";import{f as Lt}from"./index-BAgxTVAR.js";function sr({isOpen:C,orders:E,price:I,onClose:p,onCancel:O}){const k=m=>new Date(m*1e3).toLocaleString("en-US",{month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0});return C?e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[80vh] overflow-y-auto",children:e.jsxs("div",{className:"p-4 sm:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg sm:text-xl font-bold",children:"Cancel Order"}),e.jsx("button",{onClick:p,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-xl font-bold",children:"×"})]}),e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["You have multiple orders at ",ae(I),". Select which one to cancel:"]}),e.jsx("div",{className:"space-y-2",children:E.map(m=>e.jsx("button",{onClick:()=>{O(m.id),p()},className:"w-full text-left p-3 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"font-medium text-sm sm:text-base",children:[m.contract_size||0," contracts"]}),e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:m.create_time?k(m.create_time):"—"})]}),e.jsx("div",{className:"text-xs sm:text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded ${m.status==="open"?"bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200":m.status==="partial"?"bg-yellow-100 dark:bg-yellow-900/30 text-yellow-800 dark:text-yellow-200":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:m.status})})]})},m.id))}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:p,className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md",children:"Cancel"})})]})})}):null}function Ye({bids:C,asks:E,userId:I,onPriceClick:p,onCancelOrder:O}){const[k,m]=c.useState({isOpen:!1,orders:[],price:0}),re=g=>{const M=new Map;return g.forEach(b=>{const S=b.price||0;M.has(S)||M.set(S,{price:S,totalSize:0,orders:[],userOrders:[]});const u=M.get(S);u.orders.push(b),u.totalSize+=b.contract_size||0,I!==void 0&&b.user_id===I&&u.userOrders.push(b)}),Array.from(M.values()).sort((b,S)=>S.price-b.price)},x=g=>{const M=new Map;return g.forEach(b=>{const S=b.price||0;M.has(S)||M.set(S,{price:S,totalSize:0,orders:[],userOrders:[]});const u=M.get(S);u.orders.push(b),u.totalSize+=b.contract_size||0,I!==void 0&&b.user_id===I&&u.userOrders.push(b)}),Array.from(M.values()).sort((b,S)=>b.price-S.price)},A=re(C),f=x(E),L=g=>{let M=0;return g.map(b=>(M+=b.totalSize,{...b,cumulative:M}))},F=L(A),ne=L(f),H=Math.max(...F.map(g=>g.cumulative),...ne.map(g=>g.cumulative),1),de=g=>{const M=g.userOrders.filter(b=>b.status==="open"||b.status==="partial");M.length!==0&&(M.length===1?O&&O(M[0].id):m({isOpen:!0,orders:M,price:g.price}))};return e.jsxs(e.Fragment,{children:[e.jsx(sr,{isOpen:k.isOpen,orders:k.orders,price:k.price,onClose:()=>m({isOpen:!1,orders:[],price:0}),onCancel:g=>{O&&O(g)}}),e.jsx("div",{children:e.jsxs("div",{className:"grid grid-cols-2 gap-3 sm:gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-sm sm:text-base text-green-600 dark:text-green-400",children:"Yes/Buy"}),e.jsx("div",{className:"space-y-1",children:A.length===0?e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No bids"}):F.map(g=>{const M=g.cumulative/H*100,b=g.userOrders.length>0,S=g.userOrders.filter(v=>v.status==="open"||v.status==="partial"),u=b&&S.length>0,K=S.reduce((v,ee)=>v+(ee.contract_size??0),0),Z=b&&K>0&&g.orders.length>1;return e.jsxs("div",{className:`relative flex items-center justify-between text-xs sm:text-sm p-2 rounded transition-colors touch-manipulation h-12 ${b?"bg-green-100 dark:bg-green-900/40 border-2 border-primary-500 dark:border-primary-400":"bg-green-50 dark:bg-green-900/20 hover:bg-green-100 dark:hover:bg-green-900/30 cursor-pointer"}`,onClick:()=>!b&&p?.(g.price,"bid"),children:[e.jsx("div",{className:"absolute left-0 top-0 bottom-0 bg-green-200 dark:bg-green-800/40 rounded opacity-30",style:{width:`${M}%`}}),e.jsxs("div",{className:"relative z-10 flex items-center gap-1 flex-1",children:[b&&e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-primary-600 dark:text-primary-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:v=>{v.stopPropagation(),u&&de(g)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium",children:ae(g.price)})]}),e.jsxs("div",{className:"relative z-10 flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[g.totalSize,Z&&e.jsxs("span",{className:"text-primary-600 dark:text-primary-400 ml-0.5",children:["(",K," mine)"]})]}),u&&e.jsx("button",{onClick:v=>{v.stopPropagation(),de(g)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-0.5 rounded touch-manipulation",title:S.length>1?`Cancel order (${S.length} at this price)`:"Cancel order","aria-label":"Cancel order",children:"×"})]})]},g.price)})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold mb-2 text-sm sm:text-base text-red-600 dark:text-red-400",children:"No/Sell"}),e.jsx("div",{className:"space-y-1",children:f.length===0?e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No asks"}):ne.map(g=>{const M=g.cumulative/H*100,b=g.userOrders.length>0,S=g.userOrders.filter(v=>v.status==="open"||v.status==="partial"),u=b&&S.length>0,K=S.reduce((v,ee)=>v+(ee.contract_size??0),0),Z=b&&K>0&&g.orders.length>1;return e.jsxs("div",{className:`relative flex items-center justify-between text-xs sm:text-sm p-2 rounded transition-colors touch-manipulation h-12 ${b?"bg-red-100 dark:bg-red-900/40 border-2 border-primary-500 dark:border-primary-400":"bg-red-50 dark:bg-red-900/20 hover:bg-red-100 dark:hover:bg-red-900/30 cursor-pointer"}`,onClick:()=>!b&&p?.(g.price,"ask"),children:[e.jsx("div",{className:"absolute right-0 top-0 bottom-0 bg-red-200 dark:bg-red-800/40 rounded opacity-30",style:{width:`${M}%`}}),e.jsxs("div",{className:"relative z-10 flex items-center gap-1 flex-1",children:[b&&e.jsx("svg",{className:"w-3 h-3 sm:w-4 sm:h-4 text-primary-600 dark:text-primary-400 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",onClick:v=>{v.stopPropagation(),u&&de(g)},children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("span",{className:"font-medium",children:ae(g.price)})]}),e.jsxs("div",{className:"relative z-10 flex items-center gap-2",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[g.totalSize,Z&&e.jsxs("span",{className:"text-primary-600 dark:text-primary-400 ml-0.5",children:["(",K," mine)"]})]}),u&&e.jsx("button",{onClick:v=>{v.stopPropagation(),de(g)},className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 text-xs sm:text-sm font-bold px-1 py-0.5 rounded touch-manipulation",title:S.length>1?`Cancel order (${S.length} at this price)`:"Cancel order","aria-label":"Cancel order",children:"×"})]})]},g.price)})})]})]})})]})}const Ft='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])';function ar({isOpen:C,onClose:E,children:I,title:p}){const O=c.useRef(null),k=c.useRef(null),m=c.useRef(null),re=c.useCallback(()=>{const x=O.current,A=k.current;if(x&&A){const f=x.getBoundingClientRect(),L=A.getBoundingClientRect();if(f.width>0&&f.height>0)return x;if(L.width>0&&L.height>0)return A}return x??A},[]);return c.useEffect(()=>(C?(document.body.style.overflow="hidden",m.current=document.activeElement):(document.body.style.overflow="",m.current&&typeof m.current.focus=="function"&&(m.current.focus(),m.current=null)),()=>{document.body.style.overflow=""}),[C]),c.useEffect(()=>{if(!C)return;const x=A=>{if(A.key==="Escape"){E();return}if(A.key!=="Tab")return;const f=re();if(!f)return;const L=Array.from(f.querySelectorAll(Ft)).filter(H=>!H.hasAttribute("disabled")&&H.offsetParent!=null);if(L.length===0)return;const F=L[0],ne=L[L.length-1];A.shiftKey?document.activeElement===F&&(A.preventDefault(),ne.focus()):document.activeElement===ne&&(A.preventDefault(),F.focus())};return document.addEventListener("keydown",x),()=>document.removeEventListener("keydown",x)},[C,E,re]),c.useEffect(()=>{if(!C)return;const x=re();if(!x)return;const A=x.querySelector(Ft),f=requestAnimationFrame(()=>{A&&A.focus()});return()=>cancelAnimationFrame(f)},[C,re]),C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-40",onClick:E,"aria-hidden":"true"}),e.jsxs("div",{ref:O,className:"fixed bottom-0 left-0 right-0 z-50 md:hidden bg-white dark:bg-gray-800 rounded-t-2xl shadow-2xl max-h-[90vh] overflow-y-auto safe-area-bottom",role:"dialog","aria-modal":"true",children:[e.jsx("div",{className:"sticky top-0 bg-white dark:bg-gray-800 pt-2 pb-2 flex justify-center",children:e.jsx("div",{className:"w-12 h-1 bg-gray-300 dark:bg-gray-600 rounded-full"})}),p&&e.jsx("div",{className:"px-3 pb-2 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:p}),e.jsx("button",{onClick:E,className:"p-2 -mr-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 touch-manipulation min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"px-3 pt-3 pb-24",children:I})]}),e.jsx("div",{className:"hidden md:flex fixed inset-0 z-50 items-center justify-center p-4",children:e.jsxs("div",{ref:k,className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-md w-full max-h-[90vh] overflow-y-auto",onClick:x=>x.stopPropagation(),role:"dialog","aria-modal":"true",children:[p&&e.jsx("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700 sticky top-0 bg-white dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-gray-100",children:p}),e.jsx("button",{onClick:E,className:"p-2 -mr-2 text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 min-h-[44px] min-w-[44px] flex items-center justify-center","aria-label":"Close",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),e.jsx("div",{className:"px-6 py-4",children:I})]})})]}):null}function nr({tabs:C,activeTab:E,onTabChange:I,className:p=""}){return e.jsx("div",{className:`border-b border-gray-300 dark:border-gray-600 ${p}`,children:e.jsx("div",{className:"flex overflow-x-auto -mx-3 sm:mx-0 px-3 sm:px-0 scrollbar-hide",children:C.map(O=>{const k=E===O.id;return e.jsxs("button",{onClick:()=>I(O.id),className:`
                flex items-center gap-2 px-4 py-3 text-sm font-medium whitespace-nowrap
                border-b-2 transition-colors touch-manipulation min-h-[44px]
                ${k?"border-primary-600 dark:border-primary-400 text-primary-600 dark:text-primary-400":"border-transparent text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200 hover:border-gray-300 dark:hover:border-gray-600"}
              `,"aria-selected":k,role:"tab",children:[O.icon&&e.jsx("span",{className:"flex-shrink-0",children:O.icon}),e.jsx("span",{children:O.label})]},O.id)})})})}const zt="(min-width: 768px)";function ir(){const[C,E]=c.useState(()=>typeof window<"u"?window.matchMedia(zt).matches:!1);return c.useEffect(()=>{const I=window.matchMedia(zt),p=O=>E(O.matches);return E(I.matches),I.addEventListener("change",p),()=>I.removeEventListener("change",p)},[]),C}function pr(){const{id:C}=Gt(),E=Xt(),{toasts:I,showToast:p,removeToast:O}=er(),{user:k}=Jt(),[m,re]=c.useState(null),[x,A]=c.useState([]),[f,L]=c.useState(""),[F,ne]=c.useState({}),[H,de]=c.useState([]),[g,M]=c.useState([]),[b,S]=c.useState(!0),[u,K]=c.useState("bid"),[Z,v]=c.useState(""),[ee,ke]=c.useState(""),[Me,fe]=c.useState(""),[Oe,je]=c.useState(""),[$e,Be]=c.useState(!1),[We,G]=c.useState(null),[Ne,ue]=c.useState(!1),[pe,Ve]=c.useState(!1),[ce,It]=c.useState("outcomes"),[it,lt]=c.useState(null),[Ae,dt]=c.useState(!1),[He,ct]=c.useState(null),[Rt,ot]=c.useState(!1),[Tt,Ke]=c.useState(!1),[mt,xt]=c.useState(!1),[Dt,Qe]=c.useState(!1),[ut,pt]=c.useState(!1),[Q,ve]=c.useState({}),[gt,Ue]=c.useState({}),[ht,Et]=c.useState({}),[$,Ge]=c.useState({}),[Xe,_e]=c.useState(!1),bt=ir(),Je=c.useRef(null),Ze=c.useRef(0),yt=12e4;function qt(t,r,a,n){const s=t?.net_position??0,i=t?.price_basis??0,l=100,d=9900;let o=s,h=i;if(r==="bid")if(s<0){const _=Math.min(n,Math.abs(s)),N=n-_;o=s+_,N>0?(o+=N,h=a):o===0&&(h=0)}else o=s+n,h=s>0&&i>0?Math.round((s*i+n*a)/o):a;else if(s>0){const _=Math.min(n,s),N=n-_;o=s-_,N>0?(o-=N,h=a):o===0&&(h=0)}else o=s-n,h=s<0&&i>0?Math.round((Math.abs(s)*i+n*a)/Math.abs(o)):a;return o!==0&&h>0&&(h=Math.max(l,Math.min(d,h))),{net_position:o,price_basis:h}}function Ce(t,r){const a=t.indexOf(" Over ");if(a===-1)return r?t:e.jsx(e.Fragment,{children:t});const n=t.slice(0,a).trim(),s=t.slice(a+6).trim(),i=Q[n],l=Q[s],d=o=>e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",o,")"]});return r?`${n}${i!=null?` (${i})`:""} Over ${s}${l!=null?` (${l})`:""}`:e.jsxs(e.Fragment,{children:[n,i!=null&&d(i)," Over ",s,l!=null&&d(l)]})}c.useEffect(()=>{C&&q(!0)},[C]),c.useEffect(()=>{k&&!k.view_market_maker&&u==="market_maker"&&K("bid")},[k?.view_market_maker,u]),c.useEffect(()=>{Ne&&Je.current&&setTimeout(()=>{Je.current?.focus()},100)},[Ne]),c.useEffect(()=>{Ne&&C&&Date.now()-Ze.current>=yt&&q()},[Ne,C]),c.useEffect(()=>{const t=()=>{document.visibilityState==="visible"&&C&&Date.now()-Ze.current>=yt&&q()};return document.addEventListener("visibilitychange",t),()=>document.removeEventListener("visibilitychange",t)},[C]),c.useEffect(()=>{if(!Xe)return;const t=r=>{r.key==="Escape"&&_e(!1)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[Xe]);async function q(t=!1){if(C){S(!0);try{const r=await W.getMarket(C,t?{cacheBust:!0}:void 0);if(re(r?.market||null),A(r?.outcomes||[]),ne(r?.orderbook||{}),de(r?.trades??[]),M(r?.positions??[]),Et(r?.lastTradePriceByOutcome??{}),r?.market?.market_id==="market-individual-net-champion"||r?.market?.market_id==="market-h2h-matchups"?W.getHandicaps(2026).then(i=>{const l=("handicaps"in i?i.handicaps:{})??{};Object.keys(l).length>0?ve(l):W.getHandicaps(2025).then(d=>ve(("handicaps"in d?d.handicaps:{})??{})).catch(()=>ve({}))}).catch(()=>ve({})):ve({}),r?.market?.market_id==="market-individual-gross-champion"||r?.market?.market_id==="market-individual-net-champion"?W.getCurrentScores().then(i=>{const l={};for(const d of i.scores??[])l[d.name]={score_gross:d.score_gross,score_net:d.score_net,number_birdies:d.number_birdies};Ue(l)}).catch(()=>Ue({})):Ue({}),r?.market?.market_id?.includes("volatility")||r?.market?.short_name&&r.market.short_name.toLowerCase().includes("volatility")?W.getPlayerVolatility().then(i=>{Ge(i?.volatilityByPlayer??{})}).catch(()=>Ge({})):Ge({}),r.outcomes&&r.outcomes.length>0&&r.orderbook){const l=r.market?.market_id==="market-total-strokes"?[...r.outcomes]:[...r.outcomes].sort((d,o)=>{const h=r.orderbook[d.outcome_id],_=r.orderbook[o.outcome_id],N=h?.bids?.[0],w=h?.asks?.[0],y=_?.bids?.[0],j=_?.asks?.[0],P=N&&w?(N.price+w.price)/2:N?.price||0;return(y&&j?(y.price+j.price)/2:y?.price||0)-P});!f&&l.length>0&&L(l[0].outcome_id)}}catch(r){console.error("Failed to load market:",r),p("Failed to load market data","error")}finally{S(!1),Ze.current=Date.now()}}}async function kt(t){if(t.preventDefault(),!C||!f){p("Please select an outcome","error");return}const r=parseInt(ee,10);if(isNaN(r)||r<=0){p("Quantity must be at least 1","error");return}if(u==="market_maker"){const i=parseInt(Me,10),l=parseInt(Oe,10);if(isNaN(i)||i<1||i>99){p("Bid price must be a whole number between $1 and $99","error");return}if(isNaN(l)||l<1||l>99){p("Ask price must be a whole number between $1 and $99","error");return}if(i>=l){p("Bid price must be less than ask price","error");return}Be(!0);try{await W.placeOrder(C,{outcome_id:f,side:"bid",price:i*100,contract_size:r,tif:"GTC"}),await W.placeOrder(C,{outcome_id:f,side:"ask",price:l*100,contract_size:r,tif:"GTC"}),ke(""),fe(""),je(""),p("Bid and ask placed","success"),await new Promise(d=>setTimeout(d,200)),await q(!0),ue(!1)}catch(d){p(d?.message||"Failed to place orders","error"),await q(!0),p("Orderbook refreshed – please try again if needed.","info")}finally{Be(!1)}return}const a=parseInt(Z,10);if(isNaN(a)||a<1||a>99){p("Price must be a whole number between $1 and $99","error");return}const n=a*100,s=f&&F?.[f]||null;if(s&&k?.id){if(u==="bid"){if(s.asks.filter(l=>l.user_id===k.id&&(l.status==="open"||l.status==="partial")&&l.price<=n).length>0){p("Cannot place bid: You have existing sell orders at this price or better","error");return}}else if(s.bids.filter(l=>l.user_id===k.id&&(l.status==="open"||l.status==="partial")&&l.price>=n).length>0){p("Cannot place ask: You have existing buy orders at this price or better","error");return}}Be(!0);try{const i=await W.placeOrder(C,{outcome_id:f,side:u,price:n,contract_size:r,tif:"GTC"});v(""),ke(""),G(null),p("Order placed successfully!","success");const l=i?.order,d=i?.fills??[],o=i?.trades??[],h=f,_=k?.id;if(l&&h&&_!=null){const N=typeof l.id=="string"?parseInt(l.id,10):l.id,w=l.price_cents??l.price??n,y=l.qty_remaining??l.contract_size??l.qty_contracts??r,j=l.status??"open",P=l.side==="ask"?1:0,V={id:N,create_time:l.created_at??Math.floor(Date.now()/1e3),user_id:_,token:"",order_id:N,outcome:h,price:w,status:j,tif:"GTC",side:P,contract_size:y,remaining_size:y};ne(D=>{const X={...D},Se=X[h]??{bids:[],asks:[]},st=[...Se.bids??[]],at=[...Se.asks??[]],be=P===0?at:st;for(const te of d){const De=typeof te.maker_order_id=="string"?parseInt(te.maker_order_id,10):te.maker_order_id,se=te.qty_contracts??te.qty??0,ye=be.findIndex(Mt=>Mt.id===De);if(ye>=0){const nt=(be[ye].remaining_size??be[ye].contract_size??0)-se;nt<=0?be.splice(ye,1):be.splice(ye,1,{...be[ye],contract_size:nt,remaining_size:nt,status:"partial"})}}if(j==="open"||j==="partial"){const te=P===0?st:at,De=P===0?te.findIndex(se=>se.price<w||se.price===w&&se.create_time>V.create_time):te.findIndex(se=>se.price>w||se.price===w&&se.create_time>V.create_time);De===-1?te.push(V):te.splice(De,0,V)}return X[h]={bids:st,asks:at},X})}if(o.length>0&&h&&_!=null){let N=null;const w=(g??[]).find(y=>y.outcome===h);w&&(N={net_position:w.net_position,price_basis:w.price_basis});for(const y of o){const j=y.price_cents??y.price??0,P=y.qty_contracts??y.contracts??0;N=qt(N,u,j,P)}N!=null&&M(y=>{const j=y.findIndex(X=>X.outcome===h),P=w??{id:0,user_id:_,outcome:h,create_time:Math.floor(Date.now()/1e3),closed_profit:0,settled_profit:0,net_position:0,price_basis:0,is_settled:0,market_name:m?.short_name,outcome_name:x?.find(X=>X.outcome_id===h)?.name,outcome_ticker:x?.find(X=>X.outcome_id===h)?.ticker},V=[...y],D={...P,...N};return j>=0?V.splice(j,1,D):V.push(D),V})}if(o.length>0&&h){const N=x?.find(y=>y.outcome_id===h),w=o.map(y=>({id:typeof y.id=="string"?parseInt(y.id,10):y.id,token:y.token??"",price:y.price_cents??y.price??0,contracts:y.qty_contracts??y.contracts??0,create_time:y.created_at??y.create_time??Math.floor(Date.now()/1e3),risk_off_contracts_taker:0,risk_off_contracts_maker:0,risk_off_price_diff_taker:0,risk_off_price_diff_maker:0,outcome:h,outcome_name:N?.name??null,outcome_ticker:N?.ticker??null,side:u==="bid"?0:1,taker_side:u==="bid"?0:1}));de(y=>[...w,...y??[]])}q(!0)}catch(i){p(i.message||"Failed to place order","error"),q(!0),p("Orderbook refreshed – please try again if needed.","info")}finally{Be(!1)}}function ft(t,r){if(L(t),K("bid"),r){const a=Math.round(r/100),n=Math.max(1,Math.min(99,a));v(n.toString()),G("price"),setTimeout(()=>G(null),2e3)}ue(!0)}function jt(t,r){if(L(t),K("ask"),r){const a=Math.round(r/100),n=Math.max(1,Math.min(99,a));v(n.toString()),G("price"),setTimeout(()=>G(null),2e3)}ue(!0)}function ge(t){if(K(t),B){if(t==="bid"&&R){const r=Math.round(R.price/100),a=Math.max(1,Math.min(99,r));v(a.toString())}else if(t==="ask"&&T){const r=Math.round(T.price/100),a=Math.max(1,Math.min(99,r));v(a.toString())}else if(t==="market_maker"&&(R||T)){if(R){const r=Math.max(1,Math.min(99,Math.round(R.price/100)));fe(r.toString())}if(T){const r=Math.max(1,Math.min(99,Math.round(T.price/100)));je(r.toString())}}}}const Yt=(()=>{const t=m?.volume_contracts??(H||[]).reduce((a,n)=>a+(n.contracts||0),0),r=t*100;return{volume_contracts:t,volume_dollars:r}})(),Y=(()=>{const t=parseInt(Z,10)||0,r=parseInt(ee,10)||0,a=parseInt(Me,10)||0,n=parseInt(Oe,10)||0;return{totalCost:u==="market_maker"?0:u==="bid"?t*r:r*(100-t),price:t,qty:r,mmBidPrice:a,mmAskPrice:n}})(),B=f&&F?.[f]||null,R=B?.bids?.[0],T=B?.asks?.[0],we=c.useMemo(()=>{const t=ht;if(Object.keys(t).length>0)return t;const r={},a=[...H].sort((n,s)=>s.create_time-n.create_time);for(const n of a){const s=n.outcome??"";s&&r[s]===void 0&&(r[s]=n.price)}return r},[H,ht]),Nt=x.find(t=>t.outcome_id===f)?.name??"",ie=f?we[f]:void 0;function vt(t){const r=t.market_name??m?.short_name??"N/A",a=x?.find(s=>s.outcome_id===t.outcome),n=t.outcome_ticker??t.outcome_name??a?.name??a?.ticker??t.outcome;return{marketName:r,outcomeLabel:n}}const he=(g||[]).reduce((t,r)=>(t[r.outcome]={net_position:r.net_position,price_basis:r.price_basis,closed_profit:r.closed_profit,settled_profit:r.settled_profit},t),{}),Le=c.useMemo(()=>(g||[]).filter(t=>t.net_position!==0||(t.closed_profit??0)!==0||(t.settled_profit??0)!==0),[g]),oe=m?.market_id?.includes("volatility")||m?.short_name&&m.short_name.toLowerCase().includes("volatility"),Fe=m?.market_type==="team_champion"||m?.market_type==="individual_champion",ze=c.useMemo(()=>{if(!x?.length)return{sumNoSell:0,sumYesBuy:0};let t=0,r=0;for(const a of x){const n=F[a.outcome_id];n?.bids?.[0]&&(t+=n.bids[0].price),n?.asks?.[0]&&(r+=n.asks[0].price)}return{sumNoSell:Math.round(t/100),sumYesBuy:Math.round(r/100)}},[x,F]),me=c.useMemo(()=>{if(!x?.length)return[];const t=[],r={},a={};for(const s of x){const i=he[s.outcome_id],l=i?.net_position??0,d=i?.price_basis??0,o=-l*d,h=l*(1e4-d);r[s.outcome_id]=o,a[s.outcome_id]=h;const _=m?.market_id==="market-h2h-matchups"?Ce(s.name,!0):m?.market_id==="market-individual-net-champion"&&Q[s.name]!=null?`${s.name} (${Q[s.name]})`:oe&&$[s.name]?`${s.name} (${$[s.name].year} - ${$[s.name].volatility} strokes)`:s.name??s.ticker;t.push({outcomeLabel:_,position:l,priceBasisCents:l!==0?d:null,if0Cents:o,if100Cents:h,closedProfitCents:i?.closed_profit??0,marketRiskCents:0})}const n=Object.values(r).reduce((s,i)=>s+i,0);for(let s=0;s<x.length;s++){const i=x[s].outcome_id;t[s].marketRiskCents=(a[i]??0)+(n-(r[i]??0))}return t.sort((s,i)=>i.marketRiskCents-s.marketRiskCents),t},[x,he,m?.market_id,Q,oe,$]),Ie=c.useMemo(()=>{if(me.length===0)return{isBest:a=>!1,isWorst:a=>!1};const t=Math.max(...me.map(a=>a.marketRiskCents)),r=Math.min(...me.map(a=>a.marketRiskCents));return{isBest:a=>a.marketRiskCents===t&&t>r,isWorst:a=>a.marketRiskCents===r&&r<t}},[me]),Re=(t,r)=>`${t>=0?"+":""}${t} @ ${J(r)}`,Te=t=>t==null?"—":t===0?"E":t>0?`+${t}`:String(t),xe=m?.market_id==="market-individual-gross-champion"||m?.market_id==="market-individual-net-champion",Wt={"outcome-total-strokes-lt-6499":6500,"outcome-total-strokes-6500-6599":6550,"outcome-total-strokes-6600-6699":6650,"outcome-total-strokes-6700-6799":6750,"outcome-total-strokes-6800-6899":6850,"outcome-total-strokes-gt-6900":6e3},_t=c.useMemo(()=>{if(m?.market_id!=="market-total-strokes"||!x?.length)return null;let t=0,r=0;for(const a of x){const n=Wt[a.outcome_id];if(n==null)continue;const s=F?.[a.outcome_id],i=s?.bids?.[0],l=s?.asks?.[0],d=i&&l?(i.price+l.price)/2:i?.price??we[a.outcome_id]??0;if(d<=0)continue;const o=d/1e4;t+=n*o,r+=o}return r<=0?null:Math.round(t/r)},[m?.market_id,x,F,we]),Ct=(t,r)=>r===null?null:t.net_position<0?(1e4-r)*Math.abs(t.net_position):t.net_position*r,le=c.useMemo(()=>{if(!k?.id||!(ce==="orders"||bt))return[];const t=[];for(const r of Object.values(F))for(const a of[...r.bids||[],...r.asks||[]])a.user_id===k.id&&(a.status==="open"||a.status==="partial")&&t.push(a);return t},[ce,bt,F,k?.id]),Pe=c.useMemo(()=>!k?.id||!B?[]:[...B.bids||[],...B.asks||[]].filter(r=>r.user_id===k.id&&(r.status==="open"||r.status==="partial")),[k?.id,B]);async function Vt(t){lt(t);try{await W.cancelOrder(t),p("Order canceled successfully","success"),await q(!0)}catch(r){console.error("Failed to cancel order:",r),p(r.message||"Failed to cancel order","error")}finally{lt(null)}}function wt(t){ct(t)}async function Ht(){if(le.length!==0){dt(!0);try{for(const t of le)await W.cancelOrder(t.id);p("All orders in this market canceled","success"),await q(!0)}catch(t){console.error("Failed to cancel orders:",t),p(t.message||"Failed to cancel some orders","error")}finally{dt(!1)}}}function Pt(){ot(!0)}async function Kt(){if(Pe.length!==0){xt(!0),Ke(!1);try{for(const t of Pe)await W.cancelOrder(t.id);p(`Canceled ${Pe.length} order(s) for this outcome`,"success"),await q(!0)}catch(t){console.error("Failed to cancel orders for outcome:",t),p(t?.message||"Failed to cancel some orders","error")}finally{xt(!1)}}}function St(){Ke(!0)}async function Qt(){if(m?.market_id){pt(!0),Qe(!1);try{const t=await W.adminCancelAllOrders({marketId:m.market_id});p(`Canceled ${t.canceled} order(s) for this market`,"success"),await q(!0)}catch(t){console.error("Failed to cancel orders for market:",t),p(t?.message||"Failed to cancel orders","error")}finally{pt(!1)}}}function Ut(){Qe(!0)}const et=c.useMemo(()=>!x||x.length===0||!g||g.length===0||!x.some(r=>r.settled_price!=null)?0:g.reduce((r,a)=>{const n=x.find(h=>h.outcome_id===a.outcome);if(!n||n.settled_price==null)return r;const s=a.net_position??0,i=a.price_basis??0,l=n.settled_price;let d=0;s>0&&i>0?d=s*(l-i):s<0&&i>0&&(d=Math.abs(s)*(i-l));const o=a.closed_profit??0;return r+d+o},0),[g,x]);if(b)return e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(Ot,{variant:"text",width:"200px",height:"32px"}),e.jsx(Ot,{variant:"rectangular",height:"400px",className:"rounded-lg"})]});if(!m)return e.jsx("div",{className:"text-center py-8",children:"Market not found"});const tt=(x||[]).length>0?m?.market_id==="market-total-strokes"?[...x||[]]:[...x||[]].sort((t,r)=>{const a=F?.[t.outcome_id],n=F?.[r.outcome_id],s=a?.bids?.[0],i=a?.asks?.[0],l=n?.bids?.[0],d=n?.asks?.[0],o=s&&i?(s.price+i.price)/2:s?.price||0;return(l&&d?(l.price+d.price)/2:l?.price||0)-o}):[],rt=tt.some(t=>t.settled_price!=null);return e.jsx(rr,{onRefresh:()=>q(!0),children:e.jsxs("div",{className:"space-y-4 sm:space-y-6",children:[e.jsx(tr,{toasts:I,removeToast:O}),e.jsxs("nav",{className:"hidden md:flex items-baseline gap-2 text-sm font-medium text-gray-600 dark:text-gray-400","aria-label":"Breadcrumb",children:[e.jsx(Zt,{to:"/markets",className:"hover:text-primary-600 dark:hover:text-primary-400 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded text-inherit",children:"Markets"}),e.jsx("span",{"aria-hidden":"true",className:"text-gray-500 dark:text-gray-500 select-none",children:"/"}),e.jsx("span",{className:"text-gray-900 dark:text-gray-100 truncate max-w-[200px] sm:max-w-none","aria-current":"page",children:m.short_name})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-4 flex-wrap",children:[e.jsxs("button",{onClick:()=>E("/markets"),className:"flex items-center gap-2 px-3 sm:px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800 transition touch-manipulation focus:outline-none focus:ring-2 focus:ring-primary-500",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),e.jsx("span",{className:"hidden sm:inline",children:"Back to Markets"}),e.jsx("span",{className:"sm:hidden",children:"Back"})]}),Fe&&e.jsx("button",{type:"button",onClick:()=>_e(!0),disabled:!x?.length,className:"px-3 sm:px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-800 transition touch-manipulation focus:outline-none focus:ring-2 focus:ring-primary-500 disabled:opacity-50 disabled:pointer-events-none",children:"Potential outcomes"}),k?.admin&&e.jsx("button",{onClick:Ut,disabled:ut,className:"px-3 sm:px-4 py-2 text-sm font-medium text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 border border-red-300 dark:border-red-600 rounded-md hover:bg-red-50 dark:hover:bg-red-900/20 transition touch-manipulation focus:outline-none focus:ring-2 focus:ring-red-500 disabled:opacity-50 disabled:pointer-events-none",children:ut?"Canceling...":"Cancel all orders"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-2 sm:mb-3",children:m.short_name}),m.description&&e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 mb-2 sm:mb-3 max-w-2xl",children:m.description}),_t!=null&&e.jsxs("p",{className:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 sm:mb-4",children:["Forecast: ",_t.toLocaleString()," strokes"]}),rt&&g.length>0&&e.jsxs("div",{className:"inline-flex items-center gap-2 px-3 py-1.5 rounded-md bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 mb-3 sm:mb-4",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Your Settled P&L:"}),e.jsxs("span",{className:`text-sm font-semibold ${et>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[et>=0?"+":"",U(et)]})]})]}),e.jsx("div",{className:"md:hidden",children:e.jsx(nr,{tabs:[{id:"outcomes",label:"Outcomes"},{id:"orders",label:"Orders"},{id:"trades",label:"Trades"},{id:"positions",label:"Positions"}],activeTab:ce,onTabChange:t=>It(t)})}),e.jsxs("div",{className:"md:hidden",children:[ce==="outcomes"&&x&&x.length>0&&e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"w-full min-w-[320px] sm:min-w-[640px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[e.jsx("th",{className:"py-1.5 px-2 sm:py-2 sm:px-3 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:"Team"}),xe&&e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Current"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:rt?"Settled":"Chance"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"No/Sell"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Yes/Buy"})]})}),e.jsx("tbody",{children:tt.map((t,r)=>{const a=F[t.outcome_id],n=a?.bids?.[0],s=a?.asks?.[0],i=n?n.price:null,l=n&&s?(n.price+s.price)/2:i||0,d=l?Math.round(l/1e4*100):0,o=t.settled_price,h=f===t.outcome_id,_=gt[t.name],N=m?.market_id==="market-individual-gross-champion"?Te(_?.score_gross):Te(_?.score_net);return e.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer touch-manipulation transition-colors ${h?"bg-primary-50 dark:bg-primary-900/20 border-l-4 border-l-primary-600 dark:border-l-primary-400":""}`,onClick:()=>L(w=>w===t.outcome_id?"":t.outcome_id),children:[e.jsx("td",{className:"py-1.5 px-2 sm:py-2 sm:px-3",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 w-4 sm:w-6 flex-shrink-0",children:r+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100 truncate",children:m?.market_id==="market-h2h-matchups"?Ce(t.name,!1):e.jsxs(e.Fragment,{children:[t.name,m?.market_id==="market-individual-net-champion"&&Q[t.name]!=null&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",Q[t.name],")"]}),oe&&$[t.name]&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",$[t.name].year," - ",$[t.name].volatility," strokes)"]})]})}),he[t.outcome_id]&&(()=>{const w=he[t.outcome_id],{net_position:y,price_basis:j}=w,P=(w.closed_profit??0)+(w.settled_profit??0);if(y===0){if(P!==0){const D=P>=0;return e.jsxs("span",{className:`inline-block mt-0.5 px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-medium ${D?"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/20":"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20"}`,children:[D?"+":"",U(P)]})}return null}const V=y>0;return e.jsxs("span",{className:"inline-flex items-center gap-1.5 mt-0.5 flex-wrap",children:[e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-bold ${V?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:Re(y,j)}),P!==0&&e.jsxs("span",{className:`text-[10px] sm:text-xs font-medium ${P>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[P>=0?"+":"",U(P)]})]})})()]})]})}),xe&&e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:N})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:o!=null?`${Math.round(o/100)}%`:`${d}%`})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:o!=null?e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"-"}):e.jsxs("button",{onClick:w=>{w.stopPropagation(),jt(t.outcome_id,n?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 active:bg-purple-300 dark:active:bg-purple-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[n?z(n.price):"-",n?.contract_size!=null&&n.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",n.contract_size]})]})})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:o!=null?e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"-"}):e.jsxs("button",{onClick:w=>{w.stopPropagation(),ft(t.outcome_id,s?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 active:bg-blue-300 dark:active:bg-blue-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[s?z(s.price):"-",s?.contract_size!=null&&s.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",s.contract_size]})]})})})]},t.id)})}),k?.admin&&Fe&&e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{colSpan:xe?3:2,className:"py-1.5 px-2 sm:py-2 sm:px-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400",children:"Sum"}),e.jsxs("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-purple-600 dark:text-purple-400",children:[ze.sumNoSell,"%"]}),e.jsxs("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-blue-600 dark:text-blue-400",children:[ze.sumYesBuy,"%"]})]})})]})})})}),ce==="orders"&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("h2",{className:"text-base font-bold",children:"Your open orders"}),le.length>0&&e.jsx("button",{type:"button",onClick:Pt,disabled:Ae,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 disabled:opacity-50",children:Ae?"Canceling…":"Cancel all"})]}),le.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-8 text-center",children:"No open orders in this market. Place orders from the Outcomes tab."}):e.jsx("div",{className:"space-y-2",children:le.map(t=>{const r=x?.find(i=>i.outcome_id===t.outcome)?.name??t.outcome,a=t.side===0?"Yes/Buy":"No/Sell",n=t.remaining_size??t.contract_size??0,s=it===t.id;return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 border border-gray-200 dark:border-gray-600 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate min-w-0 flex-1",children:r}),e.jsx("span",{className:`flex-shrink-0 px-2 py-0.5 rounded text-xs font-bold ${t.side===0?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:a}),e.jsxs("span",{className:"flex-shrink-0 text-gray-600 dark:text-gray-400",children:[z(t.price)," × ",n]}),e.jsx("button",{type:"button",onClick:()=>wt(t.id),disabled:s,title:"Cancel order","aria-label":"Cancel order",className:"flex-shrink-0 px-2 py-1 text-lg font-bold text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded disabled:opacity-50 touch-manipulation",children:"×"})]},t.id)})})]}),ce==="trades"&&e.jsx("div",{className:"mt-4",children:b?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3].map(t=>e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"},t))}):H.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-8 text-center",children:"No recent trades"}):e.jsx("div",{className:"space-y-2",children:H.map(t=>{const r=t.taker_side??t.side,a=r===0,n=r===1,s=a?"Buy":n?"Sell":"—",i=a?"bg-green-600 text-white dark:bg-green-500 dark:text-white":n?"bg-red-600 text-white dark:bg-red-500 dark:text-white":"bg-gray-400 text-white dark:bg-gray-500 dark:text-white";return e.jsxs("div",{className:"flex items-center gap-3 p-3 border border-gray-300 dark:border-gray-600 rounded text-sm",children:[e.jsx("span",{className:`flex-shrink-0 px-3 py-1 rounded-md text-sm font-bold uppercase ${i}`,"aria-label":s!=="—"?s:"Unknown side",children:s}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(t.outcome_name??t.outcome_ticker)&&e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.outcome_name??t.outcome_ticker}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 flex-shrink-0",children:[t.contracts," @ ",ae(t.price)]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium flex-shrink-0",children:$t(t.price,t.contracts,t.taker_side??t.side??0)})]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs whitespace-nowrap flex-shrink-0",children:t.create_time?Lt(new Date(t.create_time*1e3),"M/d h:mm a"):"—"})]},t.id)})})}),ce==="positions"&&e.jsx("div",{className:"mt-4",children:b?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2].map(t=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded-lg"},t))}):Le.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-8 text-center",children:"No positions"}):e.jsx("div",{className:"space-y-3",children:Le.map(t=>{const r=t.net_position!==0,{marketName:a,outcomeLabel:n}=vt(t),s=t.current_price!==null&&t.current_price!==void 0?t.current_price:null,i=t.net_position*t.price_basis,l=r?Ct(t,s):null,d=r&&s!==null?t.net_position<0?(t.price_basis-s)*Math.abs(t.net_position):t.net_position*s-i:null,{riskCents:o,toProfitCents:h}=t.net_position<0?{riskCents:(1e4-t.price_basis)*Math.abs(t.net_position),toProfitCents:t.price_basis*Math.abs(t.net_position)}:{riskCents:t.price_basis*t.net_position,toProfitCents:(1e4-t.price_basis)*t.net_position};return e.jsx(Bt,{className:"mb-3",children:e.jsxs(At,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:a}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2",children:n}),r?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${t.net_position>0?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:Re(t.net_position,t.price_basis)}),(t.closed_profit??0)+(t.settled_profit??0)!==0&&e.jsxs("span",{className:`text-xs font-medium ${(t.closed_profit??0)+(t.settled_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[(t.closed_profit??0)+(t.settled_profit??0)>=0?"+":"",U((t.closed_profit??0)+(t.settled_profit??0))]})]}),e.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",e.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:J(o)})," | ","To Profit: ",e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:J(h)})]})]}):(()=>{const _=(t.closed_profit??0)+(t.settled_profit??0);if(_!==0){const N=_>=0;return e.jsxs("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-medium ${N?"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/20":"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20"}`,children:[N?"+":"",U(_)]})}return e.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700/50",children:"—"})})()]}),r&&e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:l!==null?Ee(l):Ee(i)}),e.jsx("div",{className:`text-sm sm:text-base font-semibold ${d!==null?d>0?"text-green-600 dark:text-green-400":d<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:d!==null?e.jsxs(e.Fragment,{children:[d>0?"↑":d<0?"↓":""," ",ae(Math.abs(d))]}):"—"})]})]}),e.jsxs("div",{className:"mt-3 -mx-2 sm:-mx-5 -mb-4 sm:-mb-5 px-2 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap items-center justify-between gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1",children:[e.jsxs("span",{children:["Closed profit: ",e.jsx("span",{className:`font-medium ${(t.closed_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:U(t.closed_profit??0)})]}),e.jsxs("span",{children:["Settled profit: ",e.jsx("span",{className:`font-medium ${(t.settled_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:U(t.settled_profit??0)})]})]}),e.jsx("div",{className:"text-right shrink-0",children:t.settled_price!=null?`Settled @ ${J(t.settled_price)}`:`Bid: ${t.best_bid!=null?J(t.best_bid):"—"} | Ask: ${t.best_ask!=null?J(t.best_ask):"—"}`})]})]})},t.id)})})})]}),e.jsxs("div",{className:"hidden md:block",children:[x&&x.length>0?e.jsx("div",{children:e.jsx("div",{className:"overflow-x-auto -mx-2 sm:mx-0",children:e.jsx("div",{className:"inline-block min-w-full align-middle",children:e.jsxs("table",{className:"w-full min-w-[320px] sm:min-w-[640px]",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-300 dark:border-gray-600",children:[e.jsx("th",{className:"py-1.5 px-2 sm:py-2 sm:px-3 text-left text-xs font-bold text-gray-600 dark:text-gray-400",children:"Team"}),xe&&e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Current"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:rt?"Settled":"Chance"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"No/Sell"}),e.jsx("th",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-gray-600 dark:text-gray-400",children:"Yes/Buy"})]})}),e.jsx("tbody",{children:tt.map((t,r)=>{const a=F[t.outcome_id],n=a?.bids?.[0],s=a?.asks?.[0],i=n?n.price:null,l=n&&s?(n.price+s.price)/2:i||0,d=l?Math.round(l/1e4*100):0,o=t.settled_price,h=f===t.outcome_id,_=gt[t.name],N=m?.market_id==="market-individual-gross-champion"?Te(_?.score_gross):Te(_?.score_net),w=xe?5:4,y=(a?.bids??[]).concat(a?.asks??[]).filter(j=>j.user_id===k?.id&&(j.status==="open"||j.status==="partial"));return e.jsxs(c.Fragment,{children:[e.jsxs("tr",{className:`border-b border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-800 cursor-pointer touch-manipulation transition-colors ${h?"bg-primary-50 dark:bg-primary-900/20 border-l-4 border-l-primary-600 dark:border-l-primary-400":""}`,onClick:()=>L(j=>j===t.outcome_id?"":t.outcome_id),children:[e.jsx("td",{className:"py-1.5 px-2 sm:py-2 sm:px-3",children:e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2",children:[e.jsx("span",{className:"text-xs font-medium text-gray-500 dark:text-gray-400 w-4 sm:w-6 flex-shrink-0",children:r+1}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("div",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100 truncate",children:m?.market_id==="market-h2h-matchups"?Ce(t.name,!1):e.jsxs(e.Fragment,{children:[t.name,m?.market_id==="market-individual-net-champion"&&Q[t.name]!=null&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",Q[t.name],")"]}),oe&&$[t.name]&&e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-500 dark:text-gray-400 font-normal",children:[" (",$[t.name].year," - ",$[t.name].volatility," strokes)"]})]})}),he[t.outcome_id]&&(()=>{const j=he[t.outcome_id],{net_position:P,price_basis:V}=j,D=(j.closed_profit??0)+(j.settled_profit??0);if(P===0){if(D!==0){const Se=D>=0;return e.jsxs("span",{className:`inline-block mt-0.5 px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-medium ${Se?"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/20":"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20"}`,children:[Se?"+":"",U(D)]})}return null}const X=P>0;return e.jsxs("span",{className:"inline-flex items-center gap-1.5 mt-0.5 flex-wrap",children:[e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-[10px] sm:text-xs font-bold ${X?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:Re(P,V)}),D!==0&&e.jsxs("span",{className:`text-[10px] sm:text-xs font-medium ${D>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[D>=0?"+":"",U(D)]})]})})()]})]})}),xe&&e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:N})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("span",{className:"font-medium text-xs sm:text-sm text-gray-900 dark:text-gray-100",children:o!=null?`${Math.round(o/100)}%`:`${d}%`})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:o!=null?e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"-"}):e.jsxs("button",{onClick:j=>{j.stopPropagation(),jt(t.outcome_id,n?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 hover:bg-purple-200 dark:hover:bg-purple-800 active:bg-purple-300 dark:active:bg-purple-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[n?z(n.price):"-",n?.contract_size!=null&&n.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",n.contract_size]})]})})}),e.jsx("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:o!=null?e.jsx("span",{className:"text-xs text-gray-400 dark:text-gray-500",children:"-"}):e.jsxs("button",{onClick:j=>{j.stopPropagation(),ft(t.outcome_id,s?.price||null)},className:"w-[60px] sm:w-[100px] px-1 sm:px-2 py-1 sm:py-1.5 rounded text-xs font-bold whitespace-nowrap bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 hover:bg-blue-200 dark:hover:bg-blue-800 active:bg-blue-300 dark:active:bg-blue-700 touch-manipulation min-h-[44px] flex flex-col items-center justify-center transition-colors",children:[s?z(s.price):"-",s?.contract_size!=null&&s.contract_size>0&&e.jsxs("span",{className:"text-[10px] sm:text-xs font-normal opacity-90 mt-0.5",children:["x ",s.contract_size]})]})})})]}),h&&a&&e.jsx("tr",{className:"bg-gray-50 dark:bg-gray-800/50 border-b border-gray-200 dark:border-gray-700",children:e.jsx("td",{colSpan:w,className:"p-0 align-top",children:e.jsxs("div",{className:"px-3 py-3 sm:px-4 sm:py-4 border-t border-gray-200 dark:border-gray-600",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-2",children:[e.jsxs("span",{className:"text-xs font-semibold text-gray-600 dark:text-gray-400 uppercase tracking-wide",children:["Orderbook — ",t.name,oe&&$[t.name]&&e.jsxs(e.Fragment,{children:[" (",$[t.name].year," - ",$[t.name].volatility," strokes)"]}),we[t.outcome_id]!=null&&e.jsxs(e.Fragment,{children:[" | Last: ",z(we[t.outcome_id])]})]}),y.length>0&&e.jsx("button",{type:"button",onClick:j=>{j.stopPropagation(),St()},disabled:mt,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 disabled:opacity-50 p-1 rounded touch-manipulation font-bold text-sm leading-none",title:"Cancel all your orders for this outcome","aria-label":"Cancel all your orders for this outcome",children:"Cancel all my orders"})]}),e.jsx("div",{className:"max-h-[280px] overflow-y-auto rounded-lg border border-gray-200 dark:border-gray-600 bg-white dark:bg-gray-800",children:e.jsx(Ye,{bids:a.bids,asks:a.asks,userId:k?.id,onPriceClick:(j,P)=>{const V=Math.round(j/100),D=Math.max(1,Math.min(99,V));v(D.toString()),K(P),G("price"),setTimeout(()=>G(null),2e3)},onCancelOrder:async j=>{try{await W.cancelOrder(j),p("Order canceled successfully","success"),await q(!0)}catch(P){console.error("Failed to cancel order:",P),p(P?.message||"Failed to cancel order","error")}}})})]})})})]},t.id)})}),k?.admin&&Fe&&e.jsx("tfoot",{children:e.jsxs("tr",{className:"border-t-2 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/50",children:[e.jsx("td",{colSpan:xe?3:2,className:"py-1.5 px-2 sm:py-2 sm:px-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400",children:"Sum"}),e.jsxs("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-purple-600 dark:text-purple-400",children:[ze.sumNoSell,"%"]}),e.jsxs("td",{className:"py-1.5 px-1 sm:py-2 sm:px-3 text-center text-xs font-bold text-blue-600 dark:text-blue-400",children:[ze.sumYesBuy,"%"]})]})})]})})})}):e.jsx("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:"No outcomes available for this market"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 sm:gap-6 mt-6",children:[e.jsxs("div",{className:"min-w-0 max-md:block md:hidden",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3 sm:mb-4",children:[e.jsxs("h2",{className:"text-base sm:text-lg font-bold",children:["Orderbook",f&&Nt&&e.jsxs(e.Fragment,{children:[" — ",Nt,ie!=null?` | Last: ${z(ie)}`:""]})]}),f&&B&&Pe.length>0&&e.jsx("button",{type:"button",onClick:St,disabled:mt,className:"text-red-600 dark:text-red-400 hover:text-red-700 dark:hover:text-red-300 disabled:opacity-50 p-1.5 rounded touch-manipulation font-bold text-lg leading-none",title:"Cancel all your orders for this outcome","aria-label":"Cancel all your orders for this outcome",children:"×"})]}),f&&B?e.jsx(Ye,{bids:B.bids,asks:B.asks,userId:k?.id,onPriceClick:(t,r)=>{const a=Math.round(t/100),n=Math.max(1,Math.min(99,a));v(n.toString()),K(r),G("price"),setTimeout(()=>G(null),2e3)},onCancelOrder:async t=>{try{await W.cancelOrder(t),p("Order canceled successfully","success"),await q(!0)}catch(r){console.error("Failed to cancel order:",r),p(r.message||"Failed to cancel order","error")}}}):e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"Select an outcome to view orderbook"})]}),e.jsxs("div",{className:"min-w-0 md:col-span-2",children:[e.jsx("button",{onClick:()=>ue(!0),className:`md:hidden fixed bottom-20 right-4 z-30 text-white rounded-full p-4 shadow-lg touch-manipulation min-h-[56px] min-w-[56px] flex items-center justify-center ${u==="ask"?"bg-purple-600 hover:bg-purple-700 active:bg-purple-800":u==="market_maker"?"bg-primary-600 hover:bg-primary-700 active:bg-primary-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,"aria-label":u==="market_maker"?"Place order":u==="ask"?"Place sell order":"Place buy order",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),e.jsxs("div",{className:"hidden md:block",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:u==="market_maker"?"Place Order":u==="ask"?"Place Sell Order":"Place Buy Order"}),e.jsxs("form",{onSubmit:kt,className:"space-y-3 sm:space-y-4",children:[x&&x.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Outcome"}),e.jsxs("select",{value:f,onChange:t=>L(t.target.value),required:!0,className:"w-full px-3 py-2.5 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 touch-manipulation",children:[e.jsx("option",{value:"",children:"Select an outcome"}),x.map(t=>e.jsx("option",{value:t.outcome_id,children:m?.market_id==="market-h2h-matchups"?Ce(t.name,!0):m?.market_id==="market-individual-net-champion"&&Q[t.name]!=null?`${t.name} (${Q[t.name]})`:oe&&$[t.name]?`${t.name} (${$[t.name].year} - ${$[t.name].volatility} strokes)`:t.name??t.ticker},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Side"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>ge("ask"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-sm sm:text-base min-h-[44px] touch-manipulation ${u==="ask"?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["No/Sell ",R?z(R.price):""]}),e.jsxs("button",{type:"button",onClick:()=>ge("bid"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-sm sm:text-base min-h-[44px] touch-manipulation ${u==="bid"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["Yes/Buy ",T?z(T.price):""]}),k?.view_market_maker&&e.jsx("button",{type:"button",onClick:()=>ge("market_maker"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-sm sm:text-base min-h-[44px] touch-manipulation ${u==="market_maker"?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:"Market Maker"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Quantity"}),e.jsx("input",{type:"tel",inputMode:"numeric",min:"1",value:ee,onChange:t=>ke(t.target.value),required:!0,className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px]"})]}),u==="market_maker"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Bid price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:Me,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&fe(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Ask price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:Oe,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&je(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1.5",children:"Price ($)"}),B&&(R||T||ie!=null)&&e.jsx("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-400",children:e.jsxs("span",{children:["Bid: ",R?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:z(R.price)})," × ",R.contract_size??"—"]}):"—"," | ","Ask: ",T?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:z(T.price)})," × ",T.contract_size??"—"]}):"—",ie!=null&&e.jsxs(e.Fragment,{children:[" "," | "," Last: ",e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:z(ie)})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",step:"1",min:"1",max:"99",value:Z,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&(v(r),G(null))},required:!0,className:`w-full pl-8 pr-4 py-3 text-base border rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 min-h-[44px] ${We==="price"?"border-primary-500 ring-2 ring-primary-200 dark:ring-primary-800":"border-gray-300 dark:border-gray-600"}`})]}),We==="price"&&e.jsx("div",{className:"text-xs text-primary-600 dark:text-primary-400 mt-1",children:"Auto-filled from table"})]}),f&&B&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>Ve(t=>!t),className:"text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1",children:[pe?"Hide orderbook":"View orderbook",e.jsx("svg",{className:`w-4 h-4 transition-transform ${pe?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),pe&&e.jsx("div",{className:"mt-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800/50 max-h-[200px] overflow-y-auto",children:e.jsx(Ye,{bids:B.bids,asks:B.asks,userId:k?.id,onPriceClick:(t,r)=>{const a=Math.round(t/100),n=Math.max(1,Math.min(99,a));v(n.toString()),K(r)},onCancelOrder:async t=>{try{await W.cancelOrder(t),p("Order canceled successfully","success"),await q(!0)}catch(r){p(r?.message||"Failed to cancel order","error")}}})})]}),u==="market_maker"?Y.qty>0&&Y.mmBidPrice>0&&Y.mmAskPrice>0&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Bid: $",Y.mmBidPrice," × ",Y.qty,", Ask: $",Y.mmAskPrice," × ",Y.qty]})}):Z&&ee&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Estimated Total:"}),e.jsx("span",{className:"text-lg font-semibold",children:ae(Y.totalCost*100)})]})}),e.jsx("button",{type:"submit",disabled:$e,className:`w-full text-white font-medium py-3 px-4 rounded-md disabled:opacity-50 min-h-[44px] text-base touch-manipulation ${u==="ask"?"bg-purple-600 hover:bg-purple-700 active:bg-purple-800":u==="market_maker"?"bg-primary-600 hover:bg-primary-700 active:bg-primary-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,children:$e?"Placing...":u==="market_maker"?"Place both":u==="ask"?"Place Sell Order":"Place Buy Order"})]})]})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 mb-3",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold",children:"Your open orders"}),le.length>0&&e.jsx("button",{type:"button",onClick:Pt,disabled:Ae,className:"px-3 py-1.5 text-sm font-medium text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded border border-red-300 dark:border-red-700 disabled:opacity-50",children:Ae?"Canceling…":"Cancel all"})]}),le.length===0?e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No open orders in this market."}):e.jsx("div",{className:"space-y-2",children:le.map(t=>{const r=x?.find(i=>i.outcome_id===t.outcome)?.name??t.outcome,a=t.side===0?"Yes/Buy":"No/Sell",n=t.remaining_size??t.contract_size??0,s=it===t.id;return e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 p-2 sm:p-3 border border-gray-200 dark:border-gray-600 rounded-lg text-sm",children:[e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate min-w-0 flex-1",children:r}),e.jsx("span",{className:`flex-shrink-0 px-2 py-0.5 rounded text-xs font-bold ${t.side===0?"bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-300":"bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-300"}`,children:a}),e.jsxs("span",{className:"flex-shrink-0 text-gray-600 dark:text-gray-400",children:[z(t.price)," × ",n]}),e.jsx("button",{type:"button",onClick:()=>wt(t.id),disabled:s,title:"Cancel order","aria-label":"Cancel order",className:"flex-shrink-0 px-2 py-1 text-lg font-bold text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded disabled:opacity-50",children:"×"})]},t.id)})})]}),Le.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"Your Positions"}),b?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2].map(t=>e.jsx("div",{className:"h-20 bg-gray-200 dark:bg-gray-700 rounded-lg"},t))}):e.jsx("div",{className:"space-y-3",children:Le.map(t=>{const r=t.net_position!==0,{marketName:a,outcomeLabel:n}=vt(t),s=t.current_price!==null&&t.current_price!==void 0?t.current_price:null,i=t.net_position*t.price_basis,l=r?Ct(t,s):null,d=r&&s!==null?t.net_position<0?(t.price_basis-s)*Math.abs(t.net_position):t.net_position*s-i:null,{riskCents:o,toProfitCents:h}=t.net_position<0?{riskCents:(1e4-t.price_basis)*Math.abs(t.net_position),toProfitCents:t.price_basis*Math.abs(t.net_position)}:{riskCents:t.price_basis*t.net_position,toProfitCents:(1e4-t.price_basis)*t.net_position};return e.jsx(Bt,{className:"mb-3",children:e.jsxs(At,{children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsx("h3",{className:"font-bold text-base sm:text-lg text-gray-900 dark:text-gray-100 mb-1",children:a}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 dark:text-gray-400 mb-2",children:n}),r?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"inline-flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-bold ${t.net_position>0?"bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400":"bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400"}`,children:Re(t.net_position,t.price_basis)}),(t.closed_profit??0)+(t.settled_profit??0)!==0&&e.jsxs("span",{className:`text-xs font-medium ${(t.closed_profit??0)+(t.settled_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:[(t.closed_profit??0)+(t.settled_profit??0)>=0?"+":"",U((t.closed_profit??0)+(t.settled_profit??0))]})]}),e.jsxs("p",{className:"mt-1.5 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:["Risk: ",e.jsx("span",{className:"font-medium text-red-600 dark:text-red-400",children:J(o)})," | ","To Profit: ",e.jsx("span",{className:"font-medium text-green-600 dark:text-green-400",children:J(h)})]})]}):(()=>{const _=(t.closed_profit??0)+(t.settled_profit??0);if(_!==0){const N=_>=0;return e.jsxs("span",{className:`inline-block px-1.5 py-0.5 rounded text-xs font-medium ${N?"text-green-600 dark:text-green-400 bg-green-100 dark:bg-green-900/20":"text-red-600 dark:text-red-400 bg-red-100 dark:bg-red-900/20"}`,children:[N?"+":"",U(_)]})}return e.jsx("span",{className:"inline-block px-1.5 py-0.5 rounded text-xs font-medium text-gray-500 dark:text-gray-400 bg-gray-100 dark:bg-gray-700/50",children:"—"})})()]}),r&&e.jsxs("div",{className:"flex flex-col items-end text-right",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold text-gray-900 dark:text-gray-100 mb-1",children:l!==null?Ee(l):Ee(i)}),e.jsx("div",{className:`text-sm sm:text-base font-semibold ${d!==null?d>0?"text-green-600 dark:text-green-400":d<0?"text-red-600 dark:text-red-400":"text-gray-600 dark:text-gray-400":"text-gray-600 dark:text-gray-400"}`,children:d!==null?e.jsxs(e.Fragment,{children:[d>0?"↑":d<0?"↓":""," ",ae(Math.abs(d))]}):"—"})]})]}),e.jsxs("div",{className:"mt-3 -mx-2 sm:-mx-5 -mb-4 sm:-mb-5 px-2 sm:px-5 py-2 rounded-b-lg bg-gray-100 dark:bg-gray-800/80 border-t border-gray-200 dark:border-gray-700 flex flex-wrap items-center justify-between gap-x-4 gap-y-1 text-xs sm:text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("div",{className:"flex flex-wrap gap-x-4 gap-y-1",children:[e.jsxs("span",{children:["Closed profit: ",e.jsx("span",{className:`font-medium ${(t.closed_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:U(t.closed_profit??0)})]}),e.jsxs("span",{children:["Settled profit: ",e.jsx("span",{className:`font-medium ${(t.settled_profit??0)>=0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"}`,children:U(t.settled_profit??0)})]})]}),e.jsx("div",{className:"text-right shrink-0",children:t.settled_price!=null?`Settled @ ${J(t.settled_price)}`:`Bid: ${t.best_bid!=null?J(t.best_bid):"—"} | Ask: ${t.best_ask!=null?J(t.best_ask):"—"}`})]})]})},t.id)})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h2",{className:"text-base sm:text-lg font-bold mb-3 sm:mb-4",children:"Recent Trades"}),b?e.jsx("div",{className:"animate-pulse space-y-2",children:[1,2,3].map(t=>e.jsx("div",{className:"h-12 bg-gray-200 dark:bg-gray-700 rounded"},t))}):!H||H.length===0?e.jsx("div",{className:"text-xs sm:text-sm text-gray-500 dark:text-gray-400 py-4 text-center",children:"No trades yet"}):e.jsx("div",{className:"space-y-2",children:H.map(t=>{const r=t.taker_side??t.side,a=r===0,n=r===1,s=a?"Buy":n?"Sell":"—",i=a?"bg-green-600 text-white dark:bg-green-500 dark:text-white":n?"bg-red-600 text-white dark:bg-red-500 dark:text-white":"bg-gray-400 text-white dark:bg-gray-500 dark:text-white";return e.jsxs("div",{className:"flex items-center gap-3 p-2 sm:p-3 border border-gray-300 dark:border-gray-600 rounded text-xs sm:text-sm",children:[e.jsx("span",{className:`flex-shrink-0 px-3 py-1 rounded-md text-xs sm:text-sm font-bold uppercase ${i}`,"aria-label":s!=="—"?s:"Unknown side",children:s}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[(t.outcome_name??t.outcome_ticker)&&e.jsx("span",{className:"font-medium text-gray-900 dark:text-gray-100 truncate",children:t.outcome_name??t.outcome_ticker}),e.jsxs("span",{className:"text-gray-600 dark:text-gray-400 flex-shrink-0",children:[t.contracts," @ ",ae(t.price)]}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-medium flex-shrink-0",children:$t(t.price,t.contracts,t.taker_side??t.side??0)})]}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400 text-xs whitespace-nowrap flex-shrink-0",children:t.create_time?Lt(new Date(t.create_time*1e3),"M/d h:mm a"):"—"})]},t.id)})})]})]})]}),e.jsx(ar,{isOpen:Ne,onClose:()=>{ue(!1),v(""),ke(""),fe(""),je(""),Ve(!1)},title:u==="market_maker"?"Place Order":u==="ask"?"Place Sell Order":"Place Buy Order",children:e.jsxs("form",{onSubmit:t=>{kt(t),ue(!1)},className:"space-y-4",children:[x&&x.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Outcome"}),e.jsxs("select",{value:f,onChange:t=>L(t.target.value),required:!0,className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 touch-manipulation min-h-[44px]",children:[e.jsx("option",{value:"",children:"Select an outcome"}),x.map(t=>e.jsx("option",{value:t.outcome_id,children:m?.market_id==="market-h2h-matchups"?Ce(t.name,!0):m?.market_id==="market-individual-net-champion"&&Q[t.name]!=null?`${t.name} (${Q[t.name]})`:oe&&$[t.name]?`${t.name} (${$[t.name].year} - ${$[t.name].volatility} strokes)`:t.name??t.ticker},t.outcome_id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Side"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>ge("ask"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-base min-h-[44px] touch-manipulation ${u==="ask"?"bg-purple-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["No/Sell ",R?z(R.price):""]}),e.jsxs("button",{type:"button",onClick:()=>ge("bid"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-base min-h-[44px] touch-manipulation ${u==="bid"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:["Yes/Buy ",T?z(T.price):""]}),k?.view_market_maker&&e.jsx("button",{type:"button",onClick:()=>ge("market_maker"),className:`flex-1 min-w-0 py-3 px-4 rounded font-medium text-base min-h-[44px] touch-manipulation ${u==="market_maker"?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200"}`,children:"Market Maker"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Quantity"}),e.jsx("input",{ref:Je,type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:"1",value:ee,onChange:t=>ke(t.target.value),required:!0,className:"w-full px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px]",placeholder:"Enter quantity"})]}),u==="market_maker"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Bid price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:Me,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&fe(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Ask price ($)"}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",min:1,max:99,value:Oe,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&je(r)},placeholder:"1-99",className:"w-full pl-8 pr-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px]"})]})]})]}):e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Price ($)"}),B&&(R||T||ie!=null)&&e.jsx("div",{className:"mb-2 text-xs text-gray-600 dark:text-gray-400",children:e.jsxs("span",{children:["Bid: ",R?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-blue-600 dark:text-blue-400",children:z(R.price)})," × ",R.contract_size??"—"]}):"—"," | ","Ask: ",T?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-medium text-purple-600 dark:text-purple-400",children:z(T.price)})," × ",T.contract_size??"—"]}):"—",ie!=null&&e.jsxs(e.Fragment,{children:[" "," | "," Last: ",e.jsx("span",{className:"font-medium text-gray-700 dark:text-gray-300",children:z(ie)})]})]})}),e.jsxs("div",{className:"relative",children:[e.jsx("span",{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-600 dark:text-gray-400",children:"$"}),e.jsx("input",{type:"tel",inputMode:"numeric",pattern:"[0-9]*",step:"1",min:"1",max:"99",value:Z,onChange:t=>{const r=t.target.value;(r===""||parseInt(r,10)>=1&&parseInt(r,10)<=99)&&(v(r),G(null))},required:!0,className:`w-full pl-8 pr-4 py-3 text-base border rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100 min-h-[44px] ${We==="price"?"border-primary-500 ring-2 ring-primary-500":"border-gray-300 dark:border-gray-600"}`,placeholder:"1-99"})]})]}),f&&B&&e.jsxs("div",{children:[e.jsxs("button",{type:"button",onClick:()=>Ve(t=>!t),className:"text-sm font-medium text-primary-600 dark:text-primary-400 hover:underline flex items-center gap-1",children:[pe?"Hide orderbook":"View orderbook",e.jsx("svg",{className:`w-4 h-4 transition-transform ${pe?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),pe&&e.jsx("div",{className:"mt-2 p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-gray-50 dark:bg-gray-800/50 max-h-[200px] overflow-y-auto",children:e.jsx(Ye,{bids:B.bids,asks:B.asks,userId:k?.id,onPriceClick:(t,r)=>{const a=Math.round(t/100),n=Math.max(1,Math.min(99,a));v(n.toString()),K(r)},onCancelOrder:async t=>{try{await W.cancelOrder(t),p("Order canceled successfully","success"),await q(!0)}catch(r){p(r?.message||"Failed to cancel order","error")}}})})]}),u==="market_maker"?Y.qty>0&&Y.mmBidPrice>0&&Y.mmAskPrice>0&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:["Bid: $",Y.mmBidPrice," × ",Y.qty,", Ask: $",Y.mmAskPrice," × ",Y.qty]})}):Z&&ee&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-4 rounded-lg",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Estimated Total:"}),e.jsx("span",{className:"text-lg font-semibold",children:ae(Y.totalCost*100)})]})}),e.jsx("button",{type:"submit",disabled:$e,className:`w-full text-white font-medium py-3 px-4 rounded-md disabled:opacity-50 min-h-[44px] text-base touch-manipulation ${u==="ask"?"bg-purple-600 hover:bg-purple-700 active:bg-purple-800":u==="market_maker"?"bg-primary-600 hover:bg-primary-700 active:bg-primary-800":"bg-blue-600 hover:bg-blue-700 active:bg-blue-800"}`,children:$e?"Placing...":u==="market_maker"?"Place both":u==="ask"?"Place Sell Order":"Place Buy Order"})]})}),e.jsx(qe,{isOpen:He!=null,onClose:()=>ct(null),onConfirm:()=>{He!=null&&Vt(He)},title:"Cancel order",message:"Are you sure you want to cancel this order?",confirmLabel:"Cancel order",cancelLabel:"Keep",variant:"danger"}),e.jsx(qe,{isOpen:Rt,onClose:()=>ot(!1),onConfirm:Ht,title:"Cancel all orders",message:"Are you sure you want to cancel all open orders in this market?",confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"}),e.jsx(qe,{isOpen:Tt,onClose:()=>Ke(!1),onConfirm:Kt,title:"Cancel all orders for this outcome",message:`Cancel all ${Pe.length} open order(s) for this outcome?`,confirmLabel:"Cancel all",cancelLabel:"Keep",variant:"danger"}),e.jsx(qe,{isOpen:Dt,onClose:()=>Qe(!1),onConfirm:Qt,title:"Cancel all orders for this market",message:"Are you sure you want to cancel ALL open orders from ALL users in this market? This action cannot be undone.",confirmLabel:"Cancel all orders",cancelLabel:"Keep",variant:"danger"}),Fe&&Xe&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50",onClick:()=>_e(!1),"aria-hidden":"true"}),e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"potential-outcomes-title",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden flex flex-col p-3 sm:p-4",onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 pb-2",children:[e.jsx("h2",{id:"potential-outcomes-title",className:"text-lg font-bold text-gray-900 dark:text-gray-100",children:"Potential outcomes"}),e.jsx("button",{type:"button",onClick:()=>_e(!1),className:"p-1.5 rounded text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-primary-500 touch-manipulation","aria-label":"Close potential outcomes",children:"×"})]}),e.jsx("div",{className:"overflow-y-auto flex-1 pb-3 sm:pb-4 min-h-0",children:me.length===0?e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"No outcomes in this market."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:hidden space-y-3",children:me.map((t,r)=>{const a=d=>{const o=Math.round(d/100);return o===0?"—":o>0?`+$${o}`:`-$${Math.abs(o)}`},n=t.priceBasisCents==null||t.priceBasisCents===0?"—":`$${Math.round(t.priceBasisCents/100)}`,s=t.position===0?"—":String(t.position),i=Ie.isBest(t),l=Ie.isWorst(t);return e.jsxs("div",{className:"rounded-lg border border-gray-200 dark:border-gray-600 bg-gray-50 dark:bg-gray-800/50 p-3",children:[e.jsx("div",{className:"font-semibold text-gray-900 dark:text-gray-100 text-center mb-2",children:t.outcomeLabel}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-4 gap-y-1.5 text-sm",children:[e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Position"}),e.jsx("span",{className:"text-right text-gray-900 dark:text-gray-100",children:s}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Price Basis"}),e.jsx("span",{className:"text-right text-gray-900 dark:text-gray-100",children:n}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"If 0"}),e.jsx("span",{className:`text-right font-medium ${t.if0Cents>0?"text-green-600 dark:text-green-400":t.if0Cents<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:a(t.if0Cents)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"If 100"}),e.jsx("span",{className:`text-right font-medium ${t.if100Cents>0?"text-green-600 dark:text-green-400":t.if100Cents<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:a(t.if100Cents)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Closed Profit"}),e.jsx("span",{className:`text-right font-medium ${t.closedProfitCents>0?"text-green-600 dark:text-green-400":t.closedProfitCents<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:a(t.closedProfitCents)}),e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:"Market Risk"}),e.jsx("span",{className:`text-right font-medium ${t.marketRiskCents>0?"text-green-600 dark:text-green-400":t.marketRiskCents<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"} ${i?"rounded bg-green-100 dark:bg-green-900/30 px-1":""} ${l?"rounded bg-red-100 dark:bg-red-900/30 px-1":""}`,children:a(t.marketRiskCents)})]})]},r)})}),e.jsx("div",{className:"hidden md:block overflow-x-auto",children:e.jsxs("table",{className:"w-full min-w-[480px] border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-gray-200 dark:border-gray-600",children:[e.jsx("th",{className:"py-2 px-2 text-center font-semibold text-gray-700 dark:text-gray-300",children:"Outcome"}),e.jsx("th",{className:"py-2 px-2 text-center font-semibold text-gray-700 dark:text-gray-300",children:"Position"}),e.jsx("th",{className:"py-2 px-2 text-center font-semibold text-gray-700 dark:text-gray-300",children:"Price Basis"}),e.jsx("th",{className:"py-2 px-2 text-center font-semibold text-gray-700 dark:text-gray-300",children:"If 0"}),e.jsx("th",{className:"py-2 px-2 text-center font-semibold text-gray-700 dark:text-gray-300",children:"If 100"}),e.jsx("th",{className:"py-2 px-2 text-center font-semibold text-gray-700 dark:text-gray-300",children:"Closed Profit"}),e.jsx("th",{className:"py-2 px-2 text-center font-semibold text-gray-700 dark:text-gray-300",children:"Market Risk"})]})}),e.jsx("tbody",{children:me.map((t,r)=>{const a=d=>{const o=Math.round(d/100);return o===0?"—":o>0?`+$${o}`:`-$${Math.abs(o)}`},n=t.priceBasisCents==null||t.priceBasisCents===0?"—":`$${Math.round(t.priceBasisCents/100)}`,s=t.position===0?"—":t.position,i=Ie.isBest(t),l=Ie.isWorst(t);return e.jsxs("tr",{className:"border-b border-gray-100 dark:border-gray-700",children:[e.jsx("td",{className:"py-2 px-2 text-center text-gray-900 dark:text-gray-100",children:t.outcomeLabel}),e.jsx("td",{className:"py-2 px-2 text-center text-gray-700 dark:text-gray-300",children:s}),e.jsx("td",{className:"py-2 px-2 text-center text-gray-700 dark:text-gray-300",children:n}),e.jsx("td",{className:`py-2 px-2 text-center font-medium ${t.if0Cents>0?"text-green-600 dark:text-green-400":t.if0Cents<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:a(t.if0Cents)}),e.jsx("td",{className:`py-2 px-2 text-center font-medium ${t.if100Cents>0?"text-green-600 dark:text-green-400":t.if100Cents<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:a(t.if100Cents)}),e.jsx("td",{className:`py-2 px-2 text-center font-medium ${t.closedProfitCents>0?"text-green-600 dark:text-green-400":t.closedProfitCents<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"}`,children:a(t.closedProfitCents)}),e.jsx("td",{className:`py-2 px-2 text-center font-medium ${t.marketRiskCents>0?"text-green-600 dark:text-green-400":t.marketRiskCents<0?"text-red-600 dark:text-red-400":"text-gray-500 dark:text-gray-400"} ${i?"bg-green-100 dark:bg-green-900/30":""} ${l?"bg-red-100 dark:bg-red-900/30":""}`,children:a(t.marketRiskCents)})]},r)})})]})})]})}),e.jsx("div",{className:"p-3 pt-0 sm:p-4 sm:pt-0 flex justify-end flex-shrink-0",children:e.jsx("button",{type:"button",onClick:()=>_e(!1),className:"px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700 transition touch-manipulation focus:outline-none focus:ring-2 focus:ring-primary-500 min-h-[44px]",children:"Close"})})]})})]}),e.jsx("div",{className:"flex justify-center pt-4 pb-2 md:pt-6 md:pb-4",children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1.5 rounded-full text-xs sm:text-sm font-medium bg-gray-100 dark:bg-gray-700/80 text-gray-600 dark:text-gray-400 border border-gray-200 dark:border-gray-600",children:[e.jsx("span",{children:"Trading volume"}),e.jsxs("span",{className:"font-semibold text-gray-900 dark:text-gray-200",children:["$",Yt.volume_dollars.toLocaleString()]})]})}),e.jsx("div",{className:"md:hidden h-24"})]})})}export{pr as MarketDetail};
